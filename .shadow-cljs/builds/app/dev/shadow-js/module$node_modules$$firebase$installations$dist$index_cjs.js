["^ ","~:resource-id",["~:shadow.build.npm/resource","node_modules/@firebase/installations/dist/index.cjs.js"],"~:js","shadow$provide.module$node_modules$$firebase$installations$dist$index_cjs=function(global,require,module,exports){function isServerError(error){return error instanceof util.FirebaseError&&error.code.includes(\"request-failed\")}function getInstallationsEndpoint(_a){return\"https://firebaseinstallations.googleapis.com/v1/projects/\"+_a.projectId+\"/installations\"}function extractAuthTokenInfoFromResponse(response){return{token:response.token,requestStatus:2,expiresIn:Number(response.expiresIn.replace(\"s\",\n\"000\")),creationTime:Date.now()}}function getErrorFromResponse(requestName,response){return tslib.__awaiter(this,void 0,void 0,function(){var responseJson,errorData;return tslib.__generator(this,function(_a){switch(_a.label){case 0:return[4,response.json()];case 1:return responseJson=_a.sent(),errorData=responseJson.error,[2,ERROR_FACTORY.create(\"request-failed\",{requestName,serverCode:errorData.code,serverMessage:errorData.message,serverStatus:errorData.status})]}})})}function getHeaders(_a){return new Headers({\"Content-Type\":\"application/json\",\nAccept:\"application/json\",\"x-goog-api-key\":_a.apiKey})}function getHeadersWithAuth(appConfig,_a){_a=_a.refreshToken;appConfig=getHeaders(appConfig);appConfig.append(\"Authorization\",\"FIS_v2 \"+_a);return appConfig}function retryIfServerError(fn){return tslib.__awaiter(this,void 0,void 0,function(){var result;return tslib.__generator(this,function(_a){switch(_a.label){case 0:return[4,fn()];case 1:return result=_a.sent(),500<=result.status&&600>result.status?[2,fn()]:[2,result]}})})}function createInstallationRequest(appConfig,\n_a){var fid=_a.fid;return tslib.__awaiter(this,void 0,void 0,function(){var endpoint,headers,body,request,response,responseValue,registeredInstallationEntry;return tslib.__generator(this,function(_b){switch(_b.label){case 0:return endpoint=getInstallationsEndpoint(appConfig),headers=getHeaders(appConfig),body={fid,authVersion:\"FIS_v2\",appId:appConfig.appId,sdkVersion:\"w:0.4.31\"},request={method:\"POST\",headers,body:JSON.stringify(body)},[4,retryIfServerError(function(){return fetch(endpoint,request)})];\ncase 1:return response=_b.sent(),response.ok?[4,response.json()]:[3,3];case 2:return responseValue=_b.sent(),registeredInstallationEntry={fid:responseValue.fid||fid,registrationStatus:2,refreshToken:responseValue.refreshToken,authToken:extractAuthTokenInfoFromResponse(responseValue.authToken)},[2,registeredInstallationEntry];case 3:return[4,getErrorFromResponse(\"Create Installation\",response)];case 4:throw _b.sent();}})})}function sleep(ms){return new Promise(function(resolve){setTimeout(resolve,\nms)})}function getKey(appConfig){return appConfig.appName+\"!\"+appConfig.appId}function addCallback(appConfig,callback){getBroadcastChannel();appConfig=getKey(appConfig);var callbackSet=fidChangeCallbacks.get(appConfig);callbackSet||(callbackSet=new Set,fidChangeCallbacks.set(appConfig,callbackSet));callbackSet.add(callback)}function callFidChangeCallbacks(key,fid){var _a;if(key=fidChangeCallbacks.get(key))try{for(var callbacks_1=tslib.__values(key),callbacks_1_1=callbacks_1.next();!callbacks_1_1.done;callbacks_1_1=\ncallbacks_1.next()){var callback=callbacks_1_1.value;callback(fid)}}catch(e_1_1){var e_1={error:e_1_1}}finally{try{callbacks_1_1&&!callbacks_1_1.done&&(_a=callbacks_1.return)&&_a.call(callbacks_1)}finally{if(e_1)throw e_1.error;}}}function broadcastFidChange(key,fid){var channel=getBroadcastChannel();channel&&channel.postMessage({key,fid});closeBroadcastChannel()}function getBroadcastChannel(){!broadcastChannel&&\"BroadcastChannel\"in self&&(broadcastChannel=new BroadcastChannel(\"[Firebase] FID Change\"),\nbroadcastChannel.onmessage=function(e){callFidChangeCallbacks(e.data.key,e.data.fid)});return broadcastChannel}function closeBroadcastChannel(){0===fidChangeCallbacks.size&&broadcastChannel&&(broadcastChannel.close(),broadcastChannel=null)}function getDbPromise(){dbPromise||(dbPromise=idb.openDb(\"firebase-installations-database\",1,function(upgradeDB){switch(upgradeDB.oldVersion){case 0:upgradeDB.createObjectStore(\"firebase-installations-store\")}}));return dbPromise}function set(appConfig,value){return tslib.__awaiter(this,\nvoid 0,void 0,function(){var key$jscomp$0,db,tx,objectStore,oldValue;return tslib.__generator(this,function(_a){switch(_a.label){case 0:return key$jscomp$0=getKey(appConfig),[4,getDbPromise()];case 1:return db=_a.sent(),tx=db.transaction(\"firebase-installations-store\",\"readwrite\"),objectStore=tx.objectStore(\"firebase-installations-store\"),[4,objectStore.get(key$jscomp$0)];case 2:return oldValue=_a.sent(),[4,objectStore.put(value,key$jscomp$0)];case 3:return _a.sent(),[4,tx.complete];case 4:_a.sent();\nif(!oldValue||oldValue.fid!==value.fid){_a=value.fid;var key=getKey(appConfig);callFidChangeCallbacks(key,_a);broadcastFidChange(key,_a)}return[2,value]}})})}function remove(appConfig){return tslib.__awaiter(this,void 0,void 0,function(){var key,db,tx;return tslib.__generator(this,function(_a){switch(_a.label){case 0:return key=getKey(appConfig),[4,getDbPromise()];case 1:return db=_a.sent(),tx=db.transaction(\"firebase-installations-store\",\"readwrite\"),[4,tx.objectStore(\"firebase-installations-store\").delete(key)];\ncase 2:return _a.sent(),[4,tx.complete];case 3:return _a.sent(),[2]}})})}function update(appConfig,updateFn){return tslib.__awaiter(this,void 0,void 0,function(){var key$jscomp$0,db,tx,store,oldValue,newValue;return tslib.__generator(this,function(_a){switch(_a.label){case 0:return key$jscomp$0=getKey(appConfig),[4,getDbPromise()];case 1:return db=_a.sent(),tx=db.transaction(\"firebase-installations-store\",\"readwrite\"),store=tx.objectStore(\"firebase-installations-store\"),[4,store.get(key$jscomp$0)];\ncase 2:return oldValue=_a.sent(),newValue=updateFn(oldValue),void 0!==newValue?[3,4]:[4,store.delete(key$jscomp$0)];case 3:return _a.sent(),[3,6];case 4:return[4,store.put(newValue,key$jscomp$0)];case 5:_a.sent(),_a.label=6;case 6:return[4,tx.complete];case 7:_a.sent();if(newValue&&(!oldValue||oldValue.fid!==newValue.fid)){_a=newValue.fid;var key=getKey(appConfig);callFidChangeCallbacks(key,_a);broadcastFidChange(key,_a)}return[2,newValue]}})})}function getInstallationEntry(appConfig){return tslib.__awaiter(this,\nvoid 0,void 0,function(){var registrationPromise,installationEntry,_a$jscomp$0;return tslib.__generator(this,function(_b){switch(_b.label){case 0:return[4,update(appConfig,function(oldEntry){if(!oldEntry){try{var fidByteArray=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(fidByteArray);fidByteArray[0]=112+fidByteArray[0]%16;var fid=btoa(String.fromCharCode.apply(String,tslib.__spreadArray([],tslib.__read(fidByteArray)))).replace(/\\+/g,\"-\").replace(/\\//g,\"_\").substr(0,22);var installationEntry=\nVALID_FID_PATTERN.test(fid)?fid:\"\"}catch(_a){installationEntry=\"\"}oldEntry={fid:installationEntry,registrationStatus:0}}installationEntry=clearTimedOutRequest(oldEntry);0===installationEntry.registrationStatus?navigator.onLine?(installationEntry={fid:installationEntry.fid,registrationStatus:1,registrationTime:Date.now()},fidByteArray=registerInstallation(appConfig,installationEntry),installationEntry={installationEntry,registrationPromise:fidByteArray}):(fidByteArray=Promise.reject(ERROR_FACTORY.create(\"app-offline\")),\ninstallationEntry={installationEntry,registrationPromise:fidByteArray}):installationEntry=1===installationEntry.registrationStatus?{installationEntry,registrationPromise:waitUntilFidRegistration(appConfig)}:{installationEntry};registrationPromise=installationEntry.registrationPromise;return installationEntry.installationEntry})];case 1:installationEntry=_b.sent();if(\"\"!==installationEntry.fid)return[3,3];_a$jscomp$0={};return[4,registrationPromise];case 2:return[2,(_a$jscomp$0.installationEntry=_b.sent(),\n_a$jscomp$0)];case 3:return[2,{installationEntry,registrationPromise}]}})})}function registerInstallation(appConfig,installationEntry){return tslib.__awaiter(this,void 0,void 0,function(){var registeredInstallationEntry,e_1;return tslib.__generator(this,function(_a){switch(_a.label){case 0:return _a.trys.push([0,2,,7]),[4,createInstallationRequest(appConfig,installationEntry)];case 1:return registeredInstallationEntry=_a.sent(),[2,set(appConfig,registeredInstallationEntry)];case 2:return e_1=_a.sent(),\nisServerError(e_1)&&409===e_1.customData.serverCode?[4,remove(appConfig)]:[3,4];case 3:return _a.sent(),[3,6];case 4:return[4,set(appConfig,{fid:installationEntry.fid,registrationStatus:0})];case 5:_a.sent(),_a.label=6;case 6:throw e_1;case 7:return[2]}})})}function waitUntilFidRegistration(appConfig){return tslib.__awaiter(this,void 0,void 0,function(){var entry,_a,installationEntry,registrationPromise;return tslib.__generator(this,function(_b){switch(_b.label){case 0:return[4,updateInstallationRequest(appConfig)];\ncase 1:entry=_b.sent(),_b.label=2;case 2:return 1!==entry.registrationStatus?[3,5]:[4,sleep(100)];case 3:return _b.sent(),[4,updateInstallationRequest(appConfig)];case 4:return entry=_b.sent(),[3,2];case 5:return 0!==entry.registrationStatus?[3,7]:[4,getInstallationEntry(appConfig)];case 6:return _a=_b.sent(),installationEntry=_a.installationEntry,(registrationPromise=_a.registrationPromise)?[2,registrationPromise]:[2,installationEntry];case 7:return[2,entry]}})})}function updateInstallationRequest(appConfig){return update(appConfig,\nfunction(oldEntry){if(!oldEntry)throw ERROR_FACTORY.create(\"installation-not-found\");return clearTimedOutRequest(oldEntry)})}function clearTimedOutRequest(entry){return 1===entry.registrationStatus&&entry.registrationTime+1E4<Date.now()?{fid:entry.fid,registrationStatus:0}:entry}function generateAuthTokenRequest(_a,installationEntry){var appConfig=_a.appConfig,platformLoggerProvider=_a.platformLoggerProvider;return tslib.__awaiter(this,void 0,void 0,function(){var endpoint,headers,platformLogger,\nbody,request,response,responseValue,completedAuthToken;return tslib.__generator(this,function(_b){switch(_b.label){case 0:return endpoint=getGenerateAuthTokenEndpoint(appConfig,installationEntry),headers=getHeadersWithAuth(appConfig,installationEntry),(platformLogger=platformLoggerProvider.getImmediate({optional:!0}))&&headers.append(\"x-firebase-client\",platformLogger.getPlatformInfoString()),body={installation:{sdkVersion:\"w:0.4.31\"}},request={method:\"POST\",headers,body:JSON.stringify(body)},[4,\nretryIfServerError(function(){return fetch(endpoint,request)})];case 1:return response=_b.sent(),response.ok?[4,response.json()]:[3,3];case 2:return responseValue=_b.sent(),completedAuthToken=extractAuthTokenInfoFromResponse(responseValue),[2,completedAuthToken];case 3:return[4,getErrorFromResponse(\"Generate Auth Token\",response)];case 4:throw _b.sent();}})})}function getGenerateAuthTokenEndpoint(appConfig,_a){_a=_a.fid;return getInstallationsEndpoint(appConfig)+\"/\"+_a+\"/authTokens:generate\"}function refreshAuthToken(dependencies,\nforceRefresh){void 0===forceRefresh&&(forceRefresh=!1);return tslib.__awaiter(this,void 0,void 0,function(){var tokenPromise,entry,authToken,_a;return tslib.__generator(this,function(_b){switch(_b.label){case 0:return[4,update(dependencies.appConfig,function(oldEntry){if(void 0===oldEntry||2!==oldEntry.registrationStatus)throw ERROR_FACTORY.create(\"not-registered\");var oldAuthToken=oldEntry.authToken,JSCompiler_temp;(JSCompiler_temp=forceRefresh)||(JSCompiler_temp=2!==oldAuthToken.requestStatus)||\n(JSCompiler_temp=Date.now(),JSCompiler_temp=JSCompiler_temp<oldAuthToken.creationTime||oldAuthToken.creationTime+oldAuthToken.expiresIn<JSCompiler_temp+36E5);if(JSCompiler_temp){if(1===oldAuthToken.requestStatus)return tokenPromise=waitUntilAuthTokenRequest(dependencies,forceRefresh),oldEntry;if(!navigator.onLine)throw ERROR_FACTORY.create(\"app-offline\");oldAuthToken={requestStatus:1,requestTime:Date.now()};oldEntry=tslib.__assign(tslib.__assign({},oldEntry),{authToken:oldAuthToken});tokenPromise=\nfetchAuthTokenFromServer(dependencies,oldEntry);return oldEntry}return oldEntry})];case 1:return entry=_b.sent(),tokenPromise?[4,tokenPromise]:[3,3];case 2:return _a=_b.sent(),[3,4];case 3:_a=entry.authToken,_b.label=4;case 4:return authToken=_a,[2,authToken]}})})}function waitUntilAuthTokenRequest(dependencies,forceRefresh){return tslib.__awaiter(this,void 0,void 0,function(){var entry,authToken;return tslib.__generator(this,function(_a){switch(_a.label){case 0:return[4,updateAuthTokenRequest(dependencies.appConfig)];\ncase 1:entry=_a.sent(),_a.label=2;case 2:return 1!==entry.authToken.requestStatus?[3,5]:[4,sleep(100)];case 3:return _a.sent(),[4,updateAuthTokenRequest(dependencies.appConfig)];case 4:return entry=_a.sent(),[3,2];case 5:return authToken=entry.authToken,0===authToken.requestStatus?[2,refreshAuthToken(dependencies,forceRefresh)]:[2,authToken]}})})}function updateAuthTokenRequest(appConfig){return update(appConfig,function(oldEntry){if(void 0===oldEntry||2!==oldEntry.registrationStatus)throw ERROR_FACTORY.create(\"not-registered\");\nvar oldAuthToken=oldEntry.authToken;return 1===oldAuthToken.requestStatus&&oldAuthToken.requestTime+1E4<Date.now()?tslib.__assign(tslib.__assign({},oldEntry),{authToken:{requestStatus:0}}):oldEntry})}function fetchAuthTokenFromServer(dependencies,installationEntry){return tslib.__awaiter(this,void 0,void 0,function(){var authToken,updatedInstallationEntry,e_1;return tslib.__generator(this,function(_a){switch(_a.label){case 0:return _a.trys.push([0,3,,8]),[4,generateAuthTokenRequest(dependencies,installationEntry)];\ncase 1:return authToken=_a.sent(),updatedInstallationEntry=tslib.__assign(tslib.__assign({},installationEntry),{authToken}),[4,set(dependencies.appConfig,updatedInstallationEntry)];case 2:return _a.sent(),[2,authToken];case 3:return e_1=_a.sent(),!isServerError(e_1)||401!==e_1.customData.serverCode&&404!==e_1.customData.serverCode?[3,5]:[4,remove(dependencies.appConfig)];case 4:return _a.sent(),[3,7];case 5:return updatedInstallationEntry=tslib.__assign(tslib.__assign({},installationEntry),{authToken:{requestStatus:0}}),\n[4,set(dependencies.appConfig,updatedInstallationEntry)];case 6:_a.sent(),_a.label=7;case 7:throw e_1;case 8:return[2]}})})}function getId(dependencies){return tslib.__awaiter(this,void 0,void 0,function(){var _a,installationEntry,registrationPromise;return tslib.__generator(this,function(_b){switch(_b.label){case 0:return[4,getInstallationEntry(dependencies.appConfig)];case 1:return _a=_b.sent(),installationEntry=_a.installationEntry,(registrationPromise=_a.registrationPromise)?registrationPromise.catch(console.error):\nrefreshAuthToken(dependencies).catch(console.error),[2,installationEntry.fid]}})})}function getToken(dependencies,forceRefresh){void 0===forceRefresh&&(forceRefresh=!1);return tslib.__awaiter(this,void 0,void 0,function(){var authToken;return tslib.__generator(this,function(_a){switch(_a.label){case 0:return[4,completeInstallationRegistration(dependencies.appConfig)];case 1:return _a.sent(),[4,refreshAuthToken(dependencies,forceRefresh)];case 2:return authToken=_a.sent(),[2,authToken.token]}})})}\nfunction completeInstallationRegistration(appConfig){return tslib.__awaiter(this,void 0,void 0,function(){var registrationPromise;return tslib.__generator(this,function(_a){switch(_a.label){case 0:return[4,getInstallationEntry(appConfig)];case 1:return(registrationPromise=_a.sent().registrationPromise)?[4,registrationPromise]:[3,3];case 2:_a.sent(),_a.label=3;case 3:return[2]}})})}function deleteInstallationRequest(appConfig,installationEntry){return tslib.__awaiter(this,void 0,void 0,function(){var endpoint,\nheaders,request,response;return tslib.__generator(this,function(_a){switch(_a.label){case 0:return endpoint=getDeleteEndpoint(appConfig,installationEntry),headers=getHeadersWithAuth(appConfig,installationEntry),request={method:\"DELETE\",headers},[4,retryIfServerError(function(){return fetch(endpoint,request)})];case 1:return response=_a.sent(),response.ok?[3,3]:[4,getErrorFromResponse(\"Delete Installation\",response)];case 2:throw _a.sent();case 3:return[2]}})})}function getDeleteEndpoint(appConfig,\n_a){_a=_a.fid;return getInstallationsEndpoint(appConfig)+\"/\"+_a}function deleteInstallation(dependencies){return tslib.__awaiter(this,void 0,void 0,function(){var appConfig,entry;return tslib.__generator(this,function(_a){switch(_a.label){case 0:return appConfig=dependencies.appConfig,[4,update(appConfig,function(oldEntry){if(!oldEntry||0!==oldEntry.registrationStatus)return oldEntry})];case 1:entry=_a.sent();if(!entry)return[3,6];if(1!==entry.registrationStatus)return[3,2];throw ERROR_FACTORY.create(\"delete-pending-registration\");\ncase 2:if(2!==entry.registrationStatus)return[3,6];if(navigator.onLine)return[3,3];throw ERROR_FACTORY.create(\"app-offline\");case 3:return[4,deleteInstallationRequest(appConfig,entry)];case 4:return _a.sent(),[4,remove(appConfig)];case 5:_a.sent(),_a.label=6;case 6:return[2]}})})}function onIdChange(_a,callback){var appConfig=_a.appConfig;addCallback(appConfig,callback);return function(){var key=getKey(appConfig),callbackSet=fidChangeCallbacks.get(key);callbackSet&&(callbackSet.delete(callback),0===\ncallbackSet.size&&fidChangeCallbacks.delete(key),closeBroadcastChannel())}}function extractAppConfig(app){var _a;if(!app||!app.options)throw getMissingValueError(\"App Configuration\");if(!app.name)throw getMissingValueError(\"App Name\");var configKeys=[\"projectId\",\"apiKey\",\"appId\"];try{for(var configKeys_1=tslib.__values(configKeys),configKeys_1_1=configKeys_1.next();!configKeys_1_1.done;configKeys_1_1=configKeys_1.next()){var keyName=configKeys_1_1.value;if(!app.options[keyName])throw getMissingValueError(keyName);\n}}catch(e_1_1){var e_1={error:e_1_1}}finally{try{configKeys_1_1&&!configKeys_1_1.done&&(_a=configKeys_1.return)&&_a.call(configKeys_1)}finally{if(e_1)throw e_1.error;}}return{appName:app.name,projectId:app.options.projectId,apiKey:app.options.apiKey,appId:app.options.appId}}function getMissingValueError(valueName){return ERROR_FACTORY.create(\"missing-app-config-values\",{valueName})}function registerInstallations(instance){instance.INTERNAL.registerComponent(new component.Component(\"installations\",\nfunction(container){var app=container.getProvider(\"app\").getImmediate(),appConfig=extractAppConfig(app);container=container.getProvider(\"platform-logger\");var dependencies={appConfig,platformLoggerProvider:container};return{app,getId:function(){return getId(dependencies)},getToken:function(forceRefresh){return getToken(dependencies,forceRefresh)},delete:function(){return deleteInstallation(dependencies)},onIdChange:function(callback){return onIdChange(dependencies,callback)}}},\"PUBLIC\"));instance.registerVersion(\"@firebase/installations\",\n\"0.4.31\")}Object.defineProperty(exports,\"__esModule\",{value:!0});global=require(\"module$node_modules$$firebase$app$dist$index_esm\");var component=require(\"module$node_modules$$firebase$component$dist$index_esm\"),tslib=require(\"module$node_modules$tslib$tslib\"),util=require(\"module$node_modules$$firebase$util$dist$index_esm\"),idb=require(\"module$node_modules$idb$build$idb\");require=global&&\"object\"===typeof global&&\"default\"in global?global:{\"default\":global};var _a;global=(_a={},_a[\"missing-app-config-values\"]=\n'Missing App configuration value: \"{$valueName}\"',_a[\"not-registered\"]=\"Firebase Installation is not registered.\",_a[\"installation-not-found\"]=\"Firebase Installation not found.\",_a[\"request-failed\"]='{$requestName} request failed with error \"{$serverCode} {$serverStatus}: {$serverMessage}\"',_a[\"app-offline\"]=\"Could not process request. Application offline.\",_a[\"delete-pending-registration\"]=\"Can't delete installation while there is a pending registration request.\",_a);var ERROR_FACTORY=new util.ErrorFactory(\"installations\",\n\"Installations\",global),VALID_FID_PATTERN=/^[cdef][\\w-]{21}$/,fidChangeCallbacks=new Map,broadcastChannel=null,dbPromise=null;registerInstallations(require[\"default\"]);exports.registerInstallations=registerInstallations}","~:source","shadow$provide[\"module$node_modules$$firebase$installations$dist$index_cjs\"] = function(global,require,module,exports) {\n'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nvar firebase = require('@firebase/app');\nvar component = require('@firebase/component');\nvar tslib = require('tslib');\nvar util = require('@firebase/util');\nvar idb = require('idb');\n\nfunction _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }\n\nvar firebase__default = /*#__PURE__*/_interopDefaultLegacy(firebase);\n\nvar name = \"@firebase/installations\";\nvar version = \"0.4.31\";\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar PENDING_TIMEOUT_MS = 10000;\r\nvar PACKAGE_VERSION = \"w:\" + version;\r\nvar INTERNAL_AUTH_VERSION = 'FIS_v2';\r\nvar INSTALLATIONS_API_URL = 'https://firebaseinstallations.googleapis.com/v1';\r\nvar TOKEN_EXPIRATION_BUFFER = 60 * 60 * 1000; // One hour\r\nvar SERVICE = 'installations';\r\nvar SERVICE_NAME = 'Installations';\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar _a;\r\nvar ERROR_DESCRIPTION_MAP = (_a = {},\r\n    _a[\"missing-app-config-values\" /* MISSING_APP_CONFIG_VALUES */] = 'Missing App configuration value: \"{$valueName}\"',\r\n    _a[\"not-registered\" /* NOT_REGISTERED */] = 'Firebase Installation is not registered.',\r\n    _a[\"installation-not-found\" /* INSTALLATION_NOT_FOUND */] = 'Firebase Installation not found.',\r\n    _a[\"request-failed\" /* REQUEST_FAILED */] = '{$requestName} request failed with error \"{$serverCode} {$serverStatus}: {$serverMessage}\"',\r\n    _a[\"app-offline\" /* APP_OFFLINE */] = 'Could not process request. Application offline.',\r\n    _a[\"delete-pending-registration\" /* DELETE_PENDING_REGISTRATION */] = \"Can't delete installation while there is a pending registration request.\",\r\n    _a);\r\nvar ERROR_FACTORY = new util.ErrorFactory(SERVICE, SERVICE_NAME, ERROR_DESCRIPTION_MAP);\r\n/** Returns true if error is a FirebaseError that is based on an error from the server. */\r\nfunction isServerError(error) {\r\n    return (error instanceof util.FirebaseError &&\r\n        error.code.includes(\"request-failed\" /* REQUEST_FAILED */));\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getInstallationsEndpoint(_a) {\r\n    var projectId = _a.projectId;\r\n    return INSTALLATIONS_API_URL + \"/projects/\" + projectId + \"/installations\";\r\n}\r\nfunction extractAuthTokenInfoFromResponse(response) {\r\n    return {\r\n        token: response.token,\r\n        requestStatus: 2 /* COMPLETED */,\r\n        expiresIn: getExpiresInFromResponseExpiresIn(response.expiresIn),\r\n        creationTime: Date.now()\r\n    };\r\n}\r\nfunction getErrorFromResponse(requestName, response) {\r\n    return tslib.__awaiter(this, void 0, void 0, function () {\r\n        var responseJson, errorData;\r\n        return tslib.__generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, response.json()];\r\n                case 1:\r\n                    responseJson = _a.sent();\r\n                    errorData = responseJson.error;\r\n                    return [2 /*return*/, ERROR_FACTORY.create(\"request-failed\" /* REQUEST_FAILED */, {\r\n                            requestName: requestName,\r\n                            serverCode: errorData.code,\r\n                            serverMessage: errorData.message,\r\n                            serverStatus: errorData.status\r\n                        })];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getHeaders(_a) {\r\n    var apiKey = _a.apiKey;\r\n    return new Headers({\r\n        'Content-Type': 'application/json',\r\n        Accept: 'application/json',\r\n        'x-goog-api-key': apiKey\r\n    });\r\n}\r\nfunction getHeadersWithAuth(appConfig, _a) {\r\n    var refreshToken = _a.refreshToken;\r\n    var headers = getHeaders(appConfig);\r\n    headers.append('Authorization', getAuthorizationHeader(refreshToken));\r\n    return headers;\r\n}\r\n/**\r\n * Calls the passed in fetch wrapper and returns the response.\r\n * If the returned response has a status of 5xx, re-runs the function once and\r\n * returns the response.\r\n */\r\nfunction retryIfServerError(fn) {\r\n    return tslib.__awaiter(this, void 0, void 0, function () {\r\n        var result;\r\n        return tslib.__generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, fn()];\r\n                case 1:\r\n                    result = _a.sent();\r\n                    if (result.status >= 500 && result.status < 600) {\r\n                        // Internal Server Error. Retry request.\r\n                        return [2 /*return*/, fn()];\r\n                    }\r\n                    return [2 /*return*/, result];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getExpiresInFromResponseExpiresIn(responseExpiresIn) {\r\n    // This works because the server will never respond with fractions of a second.\r\n    return Number(responseExpiresIn.replace('s', '000'));\r\n}\r\nfunction getAuthorizationHeader(refreshToken) {\r\n    return INTERNAL_AUTH_VERSION + \" \" + refreshToken;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction createInstallationRequest(appConfig, _a) {\r\n    var fid = _a.fid;\r\n    return tslib.__awaiter(this, void 0, void 0, function () {\r\n        var endpoint, headers, body, request, response, responseValue, registeredInstallationEntry;\r\n        return tslib.__generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0:\r\n                    endpoint = getInstallationsEndpoint(appConfig);\r\n                    headers = getHeaders(appConfig);\r\n                    body = {\r\n                        fid: fid,\r\n                        authVersion: INTERNAL_AUTH_VERSION,\r\n                        appId: appConfig.appId,\r\n                        sdkVersion: PACKAGE_VERSION\r\n                    };\r\n                    request = {\r\n                        method: 'POST',\r\n                        headers: headers,\r\n                        body: JSON.stringify(body)\r\n                    };\r\n                    return [4 /*yield*/, retryIfServerError(function () { return fetch(endpoint, request); })];\r\n                case 1:\r\n                    response = _b.sent();\r\n                    if (!response.ok) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, response.json()];\r\n                case 2:\r\n                    responseValue = _b.sent();\r\n                    registeredInstallationEntry = {\r\n                        fid: responseValue.fid || fid,\r\n                        registrationStatus: 2 /* COMPLETED */,\r\n                        refreshToken: responseValue.refreshToken,\r\n                        authToken: extractAuthTokenInfoFromResponse(responseValue.authToken)\r\n                    };\r\n                    return [2 /*return*/, registeredInstallationEntry];\r\n                case 3: return [4 /*yield*/, getErrorFromResponse('Create Installation', response)];\r\n                case 4: throw _b.sent();\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/** Returns a promise that resolves after given time passes. */\r\nfunction sleep(ms) {\r\n    return new Promise(function (resolve) {\r\n        setTimeout(resolve, ms);\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction bufferToBase64UrlSafe(array) {\r\n    var b64 = btoa(String.fromCharCode.apply(String, tslib.__spreadArray([], tslib.__read(array))));\r\n    return b64.replace(/\\+/g, '-').replace(/\\//g, '_');\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar VALID_FID_PATTERN = /^[cdef][\\w-]{21}$/;\r\nvar INVALID_FID = '';\r\n/**\r\n * Generates a new FID using random values from Web Crypto API.\r\n * Returns an empty string if FID generation fails for any reason.\r\n */\r\nfunction generateFid() {\r\n    try {\r\n        // A valid FID has exactly 22 base64 characters, which is 132 bits, or 16.5\r\n        // bytes. our implementation generates a 17 byte array instead.\r\n        var fidByteArray = new Uint8Array(17);\r\n        var crypto_1 = self.crypto || self.msCrypto;\r\n        crypto_1.getRandomValues(fidByteArray);\r\n        // Replace the first 4 random bits with the constant FID header of 0b0111.\r\n        fidByteArray[0] = 112 + (fidByteArray[0] % 16);\r\n        var fid = encode(fidByteArray);\r\n        return VALID_FID_PATTERN.test(fid) ? fid : INVALID_FID;\r\n    }\r\n    catch (_a) {\r\n        // FID generation errored\r\n        return INVALID_FID;\r\n    }\r\n}\r\n/** Converts a FID Uint8Array to a base64 string representation. */\r\nfunction encode(fidByteArray) {\r\n    var b64String = bufferToBase64UrlSafe(fidByteArray);\r\n    // Remove the 23rd character that was added because of the extra 4 bits at the\r\n    // end of our 17 byte array, and the '=' padding.\r\n    return b64String.substr(0, 22);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/** Returns a string key that can be used to identify the app. */\r\nfunction getKey(appConfig) {\r\n    return appConfig.appName + \"!\" + appConfig.appId;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar fidChangeCallbacks = new Map();\r\n/**\r\n * Calls the onIdChange callbacks with the new FID value, and broadcasts the\r\n * change to other tabs.\r\n */\r\nfunction fidChanged(appConfig, fid) {\r\n    var key = getKey(appConfig);\r\n    callFidChangeCallbacks(key, fid);\r\n    broadcastFidChange(key, fid);\r\n}\r\nfunction addCallback(appConfig, callback) {\r\n    // Open the broadcast channel if it's not already open,\r\n    // to be able to listen to change events from other tabs.\r\n    getBroadcastChannel();\r\n    var key = getKey(appConfig);\r\n    var callbackSet = fidChangeCallbacks.get(key);\r\n    if (!callbackSet) {\r\n        callbackSet = new Set();\r\n        fidChangeCallbacks.set(key, callbackSet);\r\n    }\r\n    callbackSet.add(callback);\r\n}\r\nfunction removeCallback(appConfig, callback) {\r\n    var key = getKey(appConfig);\r\n    var callbackSet = fidChangeCallbacks.get(key);\r\n    if (!callbackSet) {\r\n        return;\r\n    }\r\n    callbackSet.delete(callback);\r\n    if (callbackSet.size === 0) {\r\n        fidChangeCallbacks.delete(key);\r\n    }\r\n    // Close broadcast channel if there are no more callbacks.\r\n    closeBroadcastChannel();\r\n}\r\nfunction callFidChangeCallbacks(key, fid) {\r\n    var e_1, _a;\r\n    var callbacks = fidChangeCallbacks.get(key);\r\n    if (!callbacks) {\r\n        return;\r\n    }\r\n    try {\r\n        for (var callbacks_1 = tslib.__values(callbacks), callbacks_1_1 = callbacks_1.next(); !callbacks_1_1.done; callbacks_1_1 = callbacks_1.next()) {\r\n            var callback = callbacks_1_1.value;\r\n            callback(fid);\r\n        }\r\n    }\r\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\r\n    finally {\r\n        try {\r\n            if (callbacks_1_1 && !callbacks_1_1.done && (_a = callbacks_1.return)) _a.call(callbacks_1);\r\n        }\r\n        finally { if (e_1) throw e_1.error; }\r\n    }\r\n}\r\nfunction broadcastFidChange(key, fid) {\r\n    var channel = getBroadcastChannel();\r\n    if (channel) {\r\n        channel.postMessage({ key: key, fid: fid });\r\n    }\r\n    closeBroadcastChannel();\r\n}\r\nvar broadcastChannel = null;\r\n/** Opens and returns a BroadcastChannel if it is supported by the browser. */\r\nfunction getBroadcastChannel() {\r\n    if (!broadcastChannel && 'BroadcastChannel' in self) {\r\n        broadcastChannel = new BroadcastChannel('[Firebase] FID Change');\r\n        broadcastChannel.onmessage = function (e) {\r\n            callFidChangeCallbacks(e.data.key, e.data.fid);\r\n        };\r\n    }\r\n    return broadcastChannel;\r\n}\r\nfunction closeBroadcastChannel() {\r\n    if (fidChangeCallbacks.size === 0 && broadcastChannel) {\r\n        broadcastChannel.close();\r\n        broadcastChannel = null;\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar DATABASE_NAME = 'firebase-installations-database';\r\nvar DATABASE_VERSION = 1;\r\nvar OBJECT_STORE_NAME = 'firebase-installations-store';\r\nvar dbPromise = null;\r\nfunction getDbPromise() {\r\n    if (!dbPromise) {\r\n        dbPromise = idb.openDb(DATABASE_NAME, DATABASE_VERSION, function (upgradeDB) {\r\n            // We don't use 'break' in this switch statement, the fall-through\r\n            // behavior is what we want, because if there are multiple versions between\r\n            // the old version and the current version, we want ALL the migrations\r\n            // that correspond to those versions to run, not only the last one.\r\n            // eslint-disable-next-line default-case\r\n            switch (upgradeDB.oldVersion) {\r\n                case 0:\r\n                    upgradeDB.createObjectStore(OBJECT_STORE_NAME);\r\n            }\r\n        });\r\n    }\r\n    return dbPromise;\r\n}\r\n/** Assigns or overwrites the record for the given key with the given value. */\r\nfunction set(appConfig, value) {\r\n    return tslib.__awaiter(this, void 0, void 0, function () {\r\n        var key, db, tx, objectStore, oldValue;\r\n        return tslib.__generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(appConfig);\r\n                    return [4 /*yield*/, getDbPromise()];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n                    objectStore = tx.objectStore(OBJECT_STORE_NAME);\r\n                    return [4 /*yield*/, objectStore.get(key)];\r\n                case 2:\r\n                    oldValue = _a.sent();\r\n                    return [4 /*yield*/, objectStore.put(value, key)];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, tx.complete];\r\n                case 4:\r\n                    _a.sent();\r\n                    if (!oldValue || oldValue.fid !== value.fid) {\r\n                        fidChanged(appConfig, value.fid);\r\n                    }\r\n                    return [2 /*return*/, value];\r\n            }\r\n        });\r\n    });\r\n}\r\n/** Removes record(s) from the objectStore that match the given key. */\r\nfunction remove(appConfig) {\r\n    return tslib.__awaiter(this, void 0, void 0, function () {\r\n        var key, db, tx;\r\n        return tslib.__generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(appConfig);\r\n                    return [4 /*yield*/, getDbPromise()];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n                    return [4 /*yield*/, tx.objectStore(OBJECT_STORE_NAME).delete(key)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, tx.complete];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Atomically updates a record with the result of updateFn, which gets\r\n * called with the current value. If newValue is undefined, the record is\r\n * deleted instead.\r\n * @return Updated value\r\n */\r\nfunction update(appConfig, updateFn) {\r\n    return tslib.__awaiter(this, void 0, void 0, function () {\r\n        var key, db, tx, store, oldValue, newValue;\r\n        return tslib.__generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(appConfig);\r\n                    return [4 /*yield*/, getDbPromise()];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n                    store = tx.objectStore(OBJECT_STORE_NAME);\r\n                    return [4 /*yield*/, store.get(key)];\r\n                case 2:\r\n                    oldValue = _a.sent();\r\n                    newValue = updateFn(oldValue);\r\n                    if (!(newValue === undefined)) return [3 /*break*/, 4];\r\n                    return [4 /*yield*/, store.delete(key)];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [3 /*break*/, 6];\r\n                case 4: return [4 /*yield*/, store.put(newValue, key)];\r\n                case 5:\r\n                    _a.sent();\r\n                    _a.label = 6;\r\n                case 6: return [4 /*yield*/, tx.complete];\r\n                case 7:\r\n                    _a.sent();\r\n                    if (newValue && (!oldValue || oldValue.fid !== newValue.fid)) {\r\n                        fidChanged(appConfig, newValue.fid);\r\n                    }\r\n                    return [2 /*return*/, newValue];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Updates and returns the InstallationEntry from the database.\r\n * Also triggers a registration request if it is necessary and possible.\r\n */\r\nfunction getInstallationEntry(appConfig) {\r\n    return tslib.__awaiter(this, void 0, void 0, function () {\r\n        var registrationPromise, installationEntry;\r\n        var _a;\r\n        return tslib.__generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, update(appConfig, function (oldEntry) {\r\n                        var installationEntry = updateOrCreateInstallationEntry(oldEntry);\r\n                        var entryWithPromise = triggerRegistrationIfNecessary(appConfig, installationEntry);\r\n                        registrationPromise = entryWithPromise.registrationPromise;\r\n                        return entryWithPromise.installationEntry;\r\n                    })];\r\n                case 1:\r\n                    installationEntry = _b.sent();\r\n                    if (!(installationEntry.fid === INVALID_FID)) return [3 /*break*/, 3];\r\n                    _a = {};\r\n                    return [4 /*yield*/, registrationPromise];\r\n                case 2: \r\n                // FID generation failed. Waiting for the FID from the server.\r\n                return [2 /*return*/, (_a.installationEntry = _b.sent(), _a)];\r\n                case 3: return [2 /*return*/, {\r\n                        installationEntry: installationEntry,\r\n                        registrationPromise: registrationPromise\r\n                    }];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Creates a new Installation Entry if one does not exist.\r\n * Also clears timed out pending requests.\r\n */\r\nfunction updateOrCreateInstallationEntry(oldEntry) {\r\n    var entry = oldEntry || {\r\n        fid: generateFid(),\r\n        registrationStatus: 0 /* NOT_STARTED */\r\n    };\r\n    return clearTimedOutRequest(entry);\r\n}\r\n/**\r\n * If the Firebase Installation is not registered yet, this will trigger the\r\n * registration and return an InProgressInstallationEntry.\r\n *\r\n * If registrationPromise does not exist, the installationEntry is guaranteed\r\n * to be registered.\r\n */\r\nfunction triggerRegistrationIfNecessary(appConfig, installationEntry) {\r\n    if (installationEntry.registrationStatus === 0 /* NOT_STARTED */) {\r\n        if (!navigator.onLine) {\r\n            // Registration required but app is offline.\r\n            var registrationPromiseWithError = Promise.reject(ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */));\r\n            return {\r\n                installationEntry: installationEntry,\r\n                registrationPromise: registrationPromiseWithError\r\n            };\r\n        }\r\n        // Try registering. Change status to IN_PROGRESS.\r\n        var inProgressEntry = {\r\n            fid: installationEntry.fid,\r\n            registrationStatus: 1 /* IN_PROGRESS */,\r\n            registrationTime: Date.now()\r\n        };\r\n        var registrationPromise = registerInstallation(appConfig, inProgressEntry);\r\n        return { installationEntry: inProgressEntry, registrationPromise: registrationPromise };\r\n    }\r\n    else if (installationEntry.registrationStatus === 1 /* IN_PROGRESS */) {\r\n        return {\r\n            installationEntry: installationEntry,\r\n            registrationPromise: waitUntilFidRegistration(appConfig)\r\n        };\r\n    }\r\n    else {\r\n        return { installationEntry: installationEntry };\r\n    }\r\n}\r\n/** This will be executed only once for each new Firebase Installation. */\r\nfunction registerInstallation(appConfig, installationEntry) {\r\n    return tslib.__awaiter(this, void 0, void 0, function () {\r\n        var registeredInstallationEntry, e_1;\r\n        return tslib.__generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    _a.trys.push([0, 2, , 7]);\r\n                    return [4 /*yield*/, createInstallationRequest(appConfig, installationEntry)];\r\n                case 1:\r\n                    registeredInstallationEntry = _a.sent();\r\n                    return [2 /*return*/, set(appConfig, registeredInstallationEntry)];\r\n                case 2:\r\n                    e_1 = _a.sent();\r\n                    if (!(isServerError(e_1) && e_1.customData.serverCode === 409)) return [3 /*break*/, 4];\r\n                    // Server returned a \"FID can not be used\" error.\r\n                    // Generate a new ID next time.\r\n                    return [4 /*yield*/, remove(appConfig)];\r\n                case 3:\r\n                    // Server returned a \"FID can not be used\" error.\r\n                    // Generate a new ID next time.\r\n                    _a.sent();\r\n                    return [3 /*break*/, 6];\r\n                case 4: \r\n                // Registration failed. Set FID as not registered.\r\n                return [4 /*yield*/, set(appConfig, {\r\n                        fid: installationEntry.fid,\r\n                        registrationStatus: 0 /* NOT_STARTED */\r\n                    })];\r\n                case 5:\r\n                    // Registration failed. Set FID as not registered.\r\n                    _a.sent();\r\n                    _a.label = 6;\r\n                case 6: throw e_1;\r\n                case 7: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/** Call if FID registration is pending in another request. */\r\nfunction waitUntilFidRegistration(appConfig) {\r\n    return tslib.__awaiter(this, void 0, void 0, function () {\r\n        var entry, _a, installationEntry, registrationPromise;\r\n        return tslib.__generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, updateInstallationRequest(appConfig)];\r\n                case 1:\r\n                    entry = _b.sent();\r\n                    _b.label = 2;\r\n                case 2:\r\n                    if (!(entry.registrationStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 5];\r\n                    // createInstallation request still in progress.\r\n                    return [4 /*yield*/, sleep(100)];\r\n                case 3:\r\n                    // createInstallation request still in progress.\r\n                    _b.sent();\r\n                    return [4 /*yield*/, updateInstallationRequest(appConfig)];\r\n                case 4:\r\n                    entry = _b.sent();\r\n                    return [3 /*break*/, 2];\r\n                case 5:\r\n                    if (!(entry.registrationStatus === 0 /* NOT_STARTED */)) return [3 /*break*/, 7];\r\n                    return [4 /*yield*/, getInstallationEntry(appConfig)];\r\n                case 6:\r\n                    _a = _b.sent(), installationEntry = _a.installationEntry, registrationPromise = _a.registrationPromise;\r\n                    if (registrationPromise) {\r\n                        return [2 /*return*/, registrationPromise];\r\n                    }\r\n                    else {\r\n                        // if there is no registrationPromise, entry is registered.\r\n                        return [2 /*return*/, installationEntry];\r\n                    }\r\n                case 7: return [2 /*return*/, entry];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Called only if there is a CreateInstallation request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * CreateInstallation request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\r\nfunction updateInstallationRequest(appConfig) {\r\n    return update(appConfig, function (oldEntry) {\r\n        if (!oldEntry) {\r\n            throw ERROR_FACTORY.create(\"installation-not-found\" /* INSTALLATION_NOT_FOUND */);\r\n        }\r\n        return clearTimedOutRequest(oldEntry);\r\n    });\r\n}\r\nfunction clearTimedOutRequest(entry) {\r\n    if (hasInstallationRequestTimedOut(entry)) {\r\n        return {\r\n            fid: entry.fid,\r\n            registrationStatus: 0 /* NOT_STARTED */\r\n        };\r\n    }\r\n    return entry;\r\n}\r\nfunction hasInstallationRequestTimedOut(installationEntry) {\r\n    return (installationEntry.registrationStatus === 1 /* IN_PROGRESS */ &&\r\n        installationEntry.registrationTime + PENDING_TIMEOUT_MS < Date.now());\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction generateAuthTokenRequest(_a, installationEntry) {\r\n    var appConfig = _a.appConfig, platformLoggerProvider = _a.platformLoggerProvider;\r\n    return tslib.__awaiter(this, void 0, void 0, function () {\r\n        var endpoint, headers, platformLogger, body, request, response, responseValue, completedAuthToken;\r\n        return tslib.__generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0:\r\n                    endpoint = getGenerateAuthTokenEndpoint(appConfig, installationEntry);\r\n                    headers = getHeadersWithAuth(appConfig, installationEntry);\r\n                    platformLogger = platformLoggerProvider.getImmediate({\r\n                        optional: true\r\n                    });\r\n                    if (platformLogger) {\r\n                        headers.append('x-firebase-client', platformLogger.getPlatformInfoString());\r\n                    }\r\n                    body = {\r\n                        installation: {\r\n                            sdkVersion: PACKAGE_VERSION\r\n                        }\r\n                    };\r\n                    request = {\r\n                        method: 'POST',\r\n                        headers: headers,\r\n                        body: JSON.stringify(body)\r\n                    };\r\n                    return [4 /*yield*/, retryIfServerError(function () { return fetch(endpoint, request); })];\r\n                case 1:\r\n                    response = _b.sent();\r\n                    if (!response.ok) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, response.json()];\r\n                case 2:\r\n                    responseValue = _b.sent();\r\n                    completedAuthToken = extractAuthTokenInfoFromResponse(responseValue);\r\n                    return [2 /*return*/, completedAuthToken];\r\n                case 3: return [4 /*yield*/, getErrorFromResponse('Generate Auth Token', response)];\r\n                case 4: throw _b.sent();\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getGenerateAuthTokenEndpoint(appConfig, _a) {\r\n    var fid = _a.fid;\r\n    return getInstallationsEndpoint(appConfig) + \"/\" + fid + \"/authTokens:generate\";\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns a valid authentication token for the installation. Generates a new\r\n * token if one doesn't exist, is expired or about to expire.\r\n *\r\n * Should only be called if the Firebase Installation is registered.\r\n */\r\nfunction refreshAuthToken(dependencies, forceRefresh) {\r\n    if (forceRefresh === void 0) { forceRefresh = false; }\r\n    return tslib.__awaiter(this, void 0, void 0, function () {\r\n        var tokenPromise, entry, authToken, _a;\r\n        return tslib.__generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, update(dependencies.appConfig, function (oldEntry) {\r\n                        if (!isEntryRegistered(oldEntry)) {\r\n                            throw ERROR_FACTORY.create(\"not-registered\" /* NOT_REGISTERED */);\r\n                        }\r\n                        var oldAuthToken = oldEntry.authToken;\r\n                        if (!forceRefresh && isAuthTokenValid(oldAuthToken)) {\r\n                            // There is a valid token in the DB.\r\n                            return oldEntry;\r\n                        }\r\n                        else if (oldAuthToken.requestStatus === 1 /* IN_PROGRESS */) {\r\n                            // There already is a token request in progress.\r\n                            tokenPromise = waitUntilAuthTokenRequest(dependencies, forceRefresh);\r\n                            return oldEntry;\r\n                        }\r\n                        else {\r\n                            // No token or token expired.\r\n                            if (!navigator.onLine) {\r\n                                throw ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */);\r\n                            }\r\n                            var inProgressEntry = makeAuthTokenRequestInProgressEntry(oldEntry);\r\n                            tokenPromise = fetchAuthTokenFromServer(dependencies, inProgressEntry);\r\n                            return inProgressEntry;\r\n                        }\r\n                    })];\r\n                case 1:\r\n                    entry = _b.sent();\r\n                    if (!tokenPromise) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, tokenPromise];\r\n                case 2:\r\n                    _a = _b.sent();\r\n                    return [3 /*break*/, 4];\r\n                case 3:\r\n                    _a = entry.authToken;\r\n                    _b.label = 4;\r\n                case 4:\r\n                    authToken = _a;\r\n                    return [2 /*return*/, authToken];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Call only if FID is registered and Auth Token request is in progress.\r\n *\r\n * Waits until the current pending request finishes. If the request times out,\r\n * tries once in this thread as well.\r\n */\r\nfunction waitUntilAuthTokenRequest(dependencies, forceRefresh) {\r\n    return tslib.__awaiter(this, void 0, void 0, function () {\r\n        var entry, authToken;\r\n        return tslib.__generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, updateAuthTokenRequest(dependencies.appConfig)];\r\n                case 1:\r\n                    entry = _a.sent();\r\n                    _a.label = 2;\r\n                case 2:\r\n                    if (!(entry.authToken.requestStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 5];\r\n                    // generateAuthToken still in progress.\r\n                    return [4 /*yield*/, sleep(100)];\r\n                case 3:\r\n                    // generateAuthToken still in progress.\r\n                    _a.sent();\r\n                    return [4 /*yield*/, updateAuthTokenRequest(dependencies.appConfig)];\r\n                case 4:\r\n                    entry = _a.sent();\r\n                    return [3 /*break*/, 2];\r\n                case 5:\r\n                    authToken = entry.authToken;\r\n                    if (authToken.requestStatus === 0 /* NOT_STARTED */) {\r\n                        // The request timed out or failed in a different call. Try again.\r\n                        return [2 /*return*/, refreshAuthToken(dependencies, forceRefresh)];\r\n                    }\r\n                    else {\r\n                        return [2 /*return*/, authToken];\r\n                    }\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Called only if there is a GenerateAuthToken request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * GenerateAuthToken request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\r\nfunction updateAuthTokenRequest(appConfig) {\r\n    return update(appConfig, function (oldEntry) {\r\n        if (!isEntryRegistered(oldEntry)) {\r\n            throw ERROR_FACTORY.create(\"not-registered\" /* NOT_REGISTERED */);\r\n        }\r\n        var oldAuthToken = oldEntry.authToken;\r\n        if (hasAuthTokenRequestTimedOut(oldAuthToken)) {\r\n            return tslib.__assign(tslib.__assign({}, oldEntry), { authToken: { requestStatus: 0 /* NOT_STARTED */ } });\r\n        }\r\n        return oldEntry;\r\n    });\r\n}\r\nfunction fetchAuthTokenFromServer(dependencies, installationEntry) {\r\n    return tslib.__awaiter(this, void 0, void 0, function () {\r\n        var authToken, updatedInstallationEntry, e_1, updatedInstallationEntry;\r\n        return tslib.__generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    _a.trys.push([0, 3, , 8]);\r\n                    return [4 /*yield*/, generateAuthTokenRequest(dependencies, installationEntry)];\r\n                case 1:\r\n                    authToken = _a.sent();\r\n                    updatedInstallationEntry = tslib.__assign(tslib.__assign({}, installationEntry), { authToken: authToken });\r\n                    return [4 /*yield*/, set(dependencies.appConfig, updatedInstallationEntry)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [2 /*return*/, authToken];\r\n                case 3:\r\n                    e_1 = _a.sent();\r\n                    if (!(isServerError(e_1) &&\r\n                        (e_1.customData.serverCode === 401 || e_1.customData.serverCode === 404))) return [3 /*break*/, 5];\r\n                    // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\r\n                    // Generate a new ID next time.\r\n                    return [4 /*yield*/, remove(dependencies.appConfig)];\r\n                case 4:\r\n                    // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\r\n                    // Generate a new ID next time.\r\n                    _a.sent();\r\n                    return [3 /*break*/, 7];\r\n                case 5:\r\n                    updatedInstallationEntry = tslib.__assign(tslib.__assign({}, installationEntry), { authToken: { requestStatus: 0 /* NOT_STARTED */ } });\r\n                    return [4 /*yield*/, set(dependencies.appConfig, updatedInstallationEntry)];\r\n                case 6:\r\n                    _a.sent();\r\n                    _a.label = 7;\r\n                case 7: throw e_1;\r\n                case 8: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction isEntryRegistered(installationEntry) {\r\n    return (installationEntry !== undefined &&\r\n        installationEntry.registrationStatus === 2 /* COMPLETED */);\r\n}\r\nfunction isAuthTokenValid(authToken) {\r\n    return (authToken.requestStatus === 2 /* COMPLETED */ &&\r\n        !isAuthTokenExpired(authToken));\r\n}\r\nfunction isAuthTokenExpired(authToken) {\r\n    var now = Date.now();\r\n    return (now < authToken.creationTime ||\r\n        authToken.creationTime + authToken.expiresIn < now + TOKEN_EXPIRATION_BUFFER);\r\n}\r\n/** Returns an updated InstallationEntry with an InProgressAuthToken. */\r\nfunction makeAuthTokenRequestInProgressEntry(oldEntry) {\r\n    var inProgressAuthToken = {\r\n        requestStatus: 1 /* IN_PROGRESS */,\r\n        requestTime: Date.now()\r\n    };\r\n    return tslib.__assign(tslib.__assign({}, oldEntry), { authToken: inProgressAuthToken });\r\n}\r\nfunction hasAuthTokenRequestTimedOut(authToken) {\r\n    return (authToken.requestStatus === 1 /* IN_PROGRESS */ &&\r\n        authToken.requestTime + PENDING_TIMEOUT_MS < Date.now());\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getId(dependencies) {\r\n    return tslib.__awaiter(this, void 0, void 0, function () {\r\n        var _a, installationEntry, registrationPromise;\r\n        return tslib.__generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, getInstallationEntry(dependencies.appConfig)];\r\n                case 1:\r\n                    _a = _b.sent(), installationEntry = _a.installationEntry, registrationPromise = _a.registrationPromise;\r\n                    if (registrationPromise) {\r\n                        registrationPromise.catch(console.error);\r\n                    }\r\n                    else {\r\n                        // If the installation is already registered, update the authentication\r\n                        // token if needed.\r\n                        refreshAuthToken(dependencies).catch(console.error);\r\n                    }\r\n                    return [2 /*return*/, installationEntry.fid];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getToken(dependencies, forceRefresh) {\r\n    if (forceRefresh === void 0) { forceRefresh = false; }\r\n    return tslib.__awaiter(this, void 0, void 0, function () {\r\n        var authToken;\r\n        return tslib.__generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, completeInstallationRegistration(dependencies.appConfig)];\r\n                case 1:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, refreshAuthToken(dependencies, forceRefresh)];\r\n                case 2:\r\n                    authToken = _a.sent();\r\n                    return [2 /*return*/, authToken.token];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction completeInstallationRegistration(appConfig) {\r\n    return tslib.__awaiter(this, void 0, void 0, function () {\r\n        var registrationPromise;\r\n        return tslib.__generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, getInstallationEntry(appConfig)];\r\n                case 1:\r\n                    registrationPromise = (_a.sent()).registrationPromise;\r\n                    if (!registrationPromise) return [3 /*break*/, 3];\r\n                    // A createInstallation request is in progress. Wait until it finishes.\r\n                    return [4 /*yield*/, registrationPromise];\r\n                case 2:\r\n                    // A createInstallation request is in progress. Wait until it finishes.\r\n                    _a.sent();\r\n                    _a.label = 3;\r\n                case 3: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction deleteInstallationRequest(appConfig, installationEntry) {\r\n    return tslib.__awaiter(this, void 0, void 0, function () {\r\n        var endpoint, headers, request, response;\r\n        return tslib.__generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    endpoint = getDeleteEndpoint(appConfig, installationEntry);\r\n                    headers = getHeadersWithAuth(appConfig, installationEntry);\r\n                    request = {\r\n                        method: 'DELETE',\r\n                        headers: headers\r\n                    };\r\n                    return [4 /*yield*/, retryIfServerError(function () { return fetch(endpoint, request); })];\r\n                case 1:\r\n                    response = _a.sent();\r\n                    if (!!response.ok) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, getErrorFromResponse('Delete Installation', response)];\r\n                case 2: throw _a.sent();\r\n                case 3: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getDeleteEndpoint(appConfig, _a) {\r\n    var fid = _a.fid;\r\n    return getInstallationsEndpoint(appConfig) + \"/\" + fid;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction deleteInstallation(dependencies) {\r\n    return tslib.__awaiter(this, void 0, void 0, function () {\r\n        var appConfig, entry;\r\n        return tslib.__generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    appConfig = dependencies.appConfig;\r\n                    return [4 /*yield*/, update(appConfig, function (oldEntry) {\r\n                            if (oldEntry && oldEntry.registrationStatus === 0 /* NOT_STARTED */) {\r\n                                // Delete the unregistered entry without sending a deleteInstallation request.\r\n                                return undefined;\r\n                            }\r\n                            return oldEntry;\r\n                        })];\r\n                case 1:\r\n                    entry = _a.sent();\r\n                    if (!entry) return [3 /*break*/, 6];\r\n                    if (!(entry.registrationStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 2];\r\n                    // Can't delete while trying to register.\r\n                    throw ERROR_FACTORY.create(\"delete-pending-registration\" /* DELETE_PENDING_REGISTRATION */);\r\n                case 2:\r\n                    if (!(entry.registrationStatus === 2 /* COMPLETED */)) return [3 /*break*/, 6];\r\n                    if (!!navigator.onLine) return [3 /*break*/, 3];\r\n                    throw ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */);\r\n                case 3: return [4 /*yield*/, deleteInstallationRequest(appConfig, entry)];\r\n                case 4:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, remove(appConfig)];\r\n                case 5:\r\n                    _a.sent();\r\n                    _a.label = 6;\r\n                case 6: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Sets a new callback that will get called when Installation ID changes.\r\n * Returns an unsubscribe function that will remove the callback when called.\r\n */\r\nfunction onIdChange(_a, callback) {\r\n    var appConfig = _a.appConfig;\r\n    addCallback(appConfig, callback);\r\n    return function () {\r\n        removeCallback(appConfig, callback);\r\n    };\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction extractAppConfig(app) {\r\n    var e_1, _a;\r\n    if (!app || !app.options) {\r\n        throw getMissingValueError('App Configuration');\r\n    }\r\n    if (!app.name) {\r\n        throw getMissingValueError('App Name');\r\n    }\r\n    // Required app config keys\r\n    var configKeys = [\r\n        'projectId',\r\n        'apiKey',\r\n        'appId'\r\n    ];\r\n    try {\r\n        for (var configKeys_1 = tslib.__values(configKeys), configKeys_1_1 = configKeys_1.next(); !configKeys_1_1.done; configKeys_1_1 = configKeys_1.next()) {\r\n            var keyName = configKeys_1_1.value;\r\n            if (!app.options[keyName]) {\r\n                throw getMissingValueError(keyName);\r\n            }\r\n        }\r\n    }\r\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\r\n    finally {\r\n        try {\r\n            if (configKeys_1_1 && !configKeys_1_1.done && (_a = configKeys_1.return)) _a.call(configKeys_1);\r\n        }\r\n        finally { if (e_1) throw e_1.error; }\r\n    }\r\n    return {\r\n        appName: app.name,\r\n        projectId: app.options.projectId,\r\n        apiKey: app.options.apiKey,\r\n        appId: app.options.appId\r\n    };\r\n}\r\nfunction getMissingValueError(valueName) {\r\n    return ERROR_FACTORY.create(\"missing-app-config-values\" /* MISSING_APP_CONFIG_VALUES */, {\r\n        valueName: valueName\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction registerInstallations(instance) {\r\n    var installationsName = 'installations';\r\n    instance.INTERNAL.registerComponent(new component.Component(installationsName, function (container) {\r\n        var app = container.getProvider('app').getImmediate();\r\n        // Throws if app isn't configured properly.\r\n        var appConfig = extractAppConfig(app);\r\n        var platformLoggerProvider = container.getProvider('platform-logger');\r\n        var dependencies = {\r\n            appConfig: appConfig,\r\n            platformLoggerProvider: platformLoggerProvider\r\n        };\r\n        var installations = {\r\n            app: app,\r\n            getId: function () { return getId(dependencies); },\r\n            getToken: function (forceRefresh) {\r\n                return getToken(dependencies, forceRefresh);\r\n            },\r\n            delete: function () { return deleteInstallation(dependencies); },\r\n            onIdChange: function (callback) {\r\n                return onIdChange(dependencies, callback);\r\n            }\r\n        };\r\n        return installations;\r\n    }, \"PUBLIC\" /* PUBLIC */));\r\n    instance.registerVersion(name, version);\r\n}\r\nregisterInstallations(firebase__default['default']);\n\nexports.registerInstallations = registerInstallations;\n//# sourceMappingURL=index.cjs.js.map\n\n};","~:removed-requires",["~#set",[]],"~:actual-requires",["^5",["~$module$node_modules$$firebase$util$dist$index_esm","~$module$node_modules$tslib$tslib","~$module$node_modules$idb$build$idb","~$shadow.js","~$module$node_modules$$firebase$app$dist$index_esm","~$module$node_modules$$firebase$component$dist$index_esm"]],"~:properties",["^5",["serverStatus","installationEntry","serverMessage","token","optional","body","installation","delete","registrationTime","serverCode","platformLoggerProvider","registerInstallations","label","method","key","__esModule","onIdChange","error","refreshToken","requestTime","appName","requestStatus","value","authToken","fid","appConfig","authVersion","getId","registrationStatus","apiKey","getToken","appId","app","requestName","creationTime","valueName","projectId","registrationPromise","Accept","sdkVersion","expiresIn","onmessage","headers"]],"~:compiled-at",1627830407980,"~:source-map-json","{\n\"version\":3,\n\"file\":\"module$node_modules$$firebase$installations$dist$index_cjs.js\",\n\"lineCount\":39,\n\"mappings\":\"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\",\n\"sources\":[\"node_modules/@firebase/installations/dist/index.cjs.js\"],\n\"sourcesContent\":[\"shadow$provide[\\\"module$node_modules$$firebase$installations$dist$index_cjs\\\"] = function(global,require,module,exports) {\\n'use strict';\\n\\nObject.defineProperty(exports, '__esModule', { value: true });\\n\\nvar firebase = require('@firebase/app');\\nvar component = require('@firebase/component');\\nvar tslib = require('tslib');\\nvar util = require('@firebase/util');\\nvar idb = require('idb');\\n\\nfunction _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }\\n\\nvar firebase__default = /*#__PURE__*/_interopDefaultLegacy(firebase);\\n\\nvar name = \\\"@firebase/installations\\\";\\nvar version = \\\"0.4.31\\\";\\n\\n/**\\r\\n * @license\\r\\n * Copyright 2019 Google LLC\\r\\n *\\r\\n * Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\\r\\n * you may not use this file except in compliance with the License.\\r\\n * You may obtain a copy of the License at\\r\\n *\\r\\n *   http://www.apache.org/licenses/LICENSE-2.0\\r\\n *\\r\\n * Unless required by applicable law or agreed to in writing, software\\r\\n * distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\r\\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\r\\n * See the License for the specific language governing permissions and\\r\\n * limitations under the License.\\r\\n */\\r\\nvar PENDING_TIMEOUT_MS = 10000;\\r\\nvar PACKAGE_VERSION = \\\"w:\\\" + version;\\r\\nvar INTERNAL_AUTH_VERSION = 'FIS_v2';\\r\\nvar INSTALLATIONS_API_URL = 'https://firebaseinstallations.googleapis.com/v1';\\r\\nvar TOKEN_EXPIRATION_BUFFER = 60 * 60 * 1000; // One hour\\r\\nvar SERVICE = 'installations';\\r\\nvar SERVICE_NAME = 'Installations';\\n\\n/**\\r\\n * @license\\r\\n * Copyright 2019 Google LLC\\r\\n *\\r\\n * Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\\r\\n * you may not use this file except in compliance with the License.\\r\\n * You may obtain a copy of the License at\\r\\n *\\r\\n *   http://www.apache.org/licenses/LICENSE-2.0\\r\\n *\\r\\n * Unless required by applicable law or agreed to in writing, software\\r\\n * distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\r\\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\r\\n * See the License for the specific language governing permissions and\\r\\n * limitations under the License.\\r\\n */\\r\\nvar _a;\\r\\nvar ERROR_DESCRIPTION_MAP = (_a = {},\\r\\n    _a[\\\"missing-app-config-values\\\" /* MISSING_APP_CONFIG_VALUES */] = 'Missing App configuration value: \\\"{$valueName}\\\"',\\r\\n    _a[\\\"not-registered\\\" /* NOT_REGISTERED */] = 'Firebase Installation is not registered.',\\r\\n    _a[\\\"installation-not-found\\\" /* INSTALLATION_NOT_FOUND */] = 'Firebase Installation not found.',\\r\\n    _a[\\\"request-failed\\\" /* REQUEST_FAILED */] = '{$requestName} request failed with error \\\"{$serverCode} {$serverStatus}: {$serverMessage}\\\"',\\r\\n    _a[\\\"app-offline\\\" /* APP_OFFLINE */] = 'Could not process request. Application offline.',\\r\\n    _a[\\\"delete-pending-registration\\\" /* DELETE_PENDING_REGISTRATION */] = \\\"Can't delete installation while there is a pending registration request.\\\",\\r\\n    _a);\\r\\nvar ERROR_FACTORY = new util.ErrorFactory(SERVICE, SERVICE_NAME, ERROR_DESCRIPTION_MAP);\\r\\n/** Returns true if error is a FirebaseError that is based on an error from the server. */\\r\\nfunction isServerError(error) {\\r\\n    return (error instanceof util.FirebaseError &&\\r\\n        error.code.includes(\\\"request-failed\\\" /* REQUEST_FAILED */));\\r\\n}\\n\\n/**\\r\\n * @license\\r\\n * Copyright 2019 Google LLC\\r\\n *\\r\\n * Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\\r\\n * you may not use this file except in compliance with the License.\\r\\n * You may obtain a copy of the License at\\r\\n *\\r\\n *   http://www.apache.org/licenses/LICENSE-2.0\\r\\n *\\r\\n * Unless required by applicable law or agreed to in writing, software\\r\\n * distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\r\\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\r\\n * See the License for the specific language governing permissions and\\r\\n * limitations under the License.\\r\\n */\\r\\nfunction getInstallationsEndpoint(_a) {\\r\\n    var projectId = _a.projectId;\\r\\n    return INSTALLATIONS_API_URL + \\\"/projects/\\\" + projectId + \\\"/installations\\\";\\r\\n}\\r\\nfunction extractAuthTokenInfoFromResponse(response) {\\r\\n    return {\\r\\n        token: response.token,\\r\\n        requestStatus: 2 /* COMPLETED */,\\r\\n        expiresIn: getExpiresInFromResponseExpiresIn(response.expiresIn),\\r\\n        creationTime: Date.now()\\r\\n    };\\r\\n}\\r\\nfunction getErrorFromResponse(requestName, response) {\\r\\n    return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n        var responseJson, errorData;\\r\\n        return tslib.__generator(this, function (_a) {\\r\\n            switch (_a.label) {\\r\\n                case 0: return [4 /*yield*/, response.json()];\\r\\n                case 1:\\r\\n                    responseJson = _a.sent();\\r\\n                    errorData = responseJson.error;\\r\\n                    return [2 /*return*/, ERROR_FACTORY.create(\\\"request-failed\\\" /* REQUEST_FAILED */, {\\r\\n                            requestName: requestName,\\r\\n                            serverCode: errorData.code,\\r\\n                            serverMessage: errorData.message,\\r\\n                            serverStatus: errorData.status\\r\\n                        })];\\r\\n            }\\r\\n        });\\r\\n    });\\r\\n}\\r\\nfunction getHeaders(_a) {\\r\\n    var apiKey = _a.apiKey;\\r\\n    return new Headers({\\r\\n        'Content-Type': 'application/json',\\r\\n        Accept: 'application/json',\\r\\n        'x-goog-api-key': apiKey\\r\\n    });\\r\\n}\\r\\nfunction getHeadersWithAuth(appConfig, _a) {\\r\\n    var refreshToken = _a.refreshToken;\\r\\n    var headers = getHeaders(appConfig);\\r\\n    headers.append('Authorization', getAuthorizationHeader(refreshToken));\\r\\n    return headers;\\r\\n}\\r\\n/**\\r\\n * Calls the passed in fetch wrapper and returns the response.\\r\\n * If the returned response has a status of 5xx, re-runs the function once and\\r\\n * returns the response.\\r\\n */\\r\\nfunction retryIfServerError(fn) {\\r\\n    return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n        var result;\\r\\n        return tslib.__generator(this, function (_a) {\\r\\n            switch (_a.label) {\\r\\n                case 0: return [4 /*yield*/, fn()];\\r\\n                case 1:\\r\\n                    result = _a.sent();\\r\\n                    if (result.status >= 500 && result.status < 600) {\\r\\n                        // Internal Server Error. Retry request.\\r\\n                        return [2 /*return*/, fn()];\\r\\n                    }\\r\\n                    return [2 /*return*/, result];\\r\\n            }\\r\\n        });\\r\\n    });\\r\\n}\\r\\nfunction getExpiresInFromResponseExpiresIn(responseExpiresIn) {\\r\\n    // This works because the server will never respond with fractions of a second.\\r\\n    return Number(responseExpiresIn.replace('s', '000'));\\r\\n}\\r\\nfunction getAuthorizationHeader(refreshToken) {\\r\\n    return INTERNAL_AUTH_VERSION + \\\" \\\" + refreshToken;\\r\\n}\\n\\n/**\\r\\n * @license\\r\\n * Copyright 2019 Google LLC\\r\\n *\\r\\n * Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\\r\\n * you may not use this file except in compliance with the License.\\r\\n * You may obtain a copy of the License at\\r\\n *\\r\\n *   http://www.apache.org/licenses/LICENSE-2.0\\r\\n *\\r\\n * Unless required by applicable law or agreed to in writing, software\\r\\n * distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\r\\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\r\\n * See the License for the specific language governing permissions and\\r\\n * limitations under the License.\\r\\n */\\r\\nfunction createInstallationRequest(appConfig, _a) {\\r\\n    var fid = _a.fid;\\r\\n    return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n        var endpoint, headers, body, request, response, responseValue, registeredInstallationEntry;\\r\\n        return tslib.__generator(this, function (_b) {\\r\\n            switch (_b.label) {\\r\\n                case 0:\\r\\n                    endpoint = getInstallationsEndpoint(appConfig);\\r\\n                    headers = getHeaders(appConfig);\\r\\n                    body = {\\r\\n                        fid: fid,\\r\\n                        authVersion: INTERNAL_AUTH_VERSION,\\r\\n                        appId: appConfig.appId,\\r\\n                        sdkVersion: PACKAGE_VERSION\\r\\n                    };\\r\\n                    request = {\\r\\n                        method: 'POST',\\r\\n                        headers: headers,\\r\\n                        body: JSON.stringify(body)\\r\\n                    };\\r\\n                    return [4 /*yield*/, retryIfServerError(function () { return fetch(endpoint, request); })];\\r\\n                case 1:\\r\\n                    response = _b.sent();\\r\\n                    if (!response.ok) return [3 /*break*/, 3];\\r\\n                    return [4 /*yield*/, response.json()];\\r\\n                case 2:\\r\\n                    responseValue = _b.sent();\\r\\n                    registeredInstallationEntry = {\\r\\n                        fid: responseValue.fid || fid,\\r\\n                        registrationStatus: 2 /* COMPLETED */,\\r\\n                        refreshToken: responseValue.refreshToken,\\r\\n                        authToken: extractAuthTokenInfoFromResponse(responseValue.authToken)\\r\\n                    };\\r\\n                    return [2 /*return*/, registeredInstallationEntry];\\r\\n                case 3: return [4 /*yield*/, getErrorFromResponse('Create Installation', response)];\\r\\n                case 4: throw _b.sent();\\r\\n            }\\r\\n        });\\r\\n    });\\r\\n}\\n\\n/**\\r\\n * @license\\r\\n * Copyright 2020 Google LLC\\r\\n *\\r\\n * Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\\r\\n * you may not use this file except in compliance with the License.\\r\\n * You may obtain a copy of the License at\\r\\n *\\r\\n *   http://www.apache.org/licenses/LICENSE-2.0\\r\\n *\\r\\n * Unless required by applicable law or agreed to in writing, software\\r\\n * distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\r\\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\r\\n * See the License for the specific language governing permissions and\\r\\n * limitations under the License.\\r\\n */\\r\\n/** Returns a promise that resolves after given time passes. */\\r\\nfunction sleep(ms) {\\r\\n    return new Promise(function (resolve) {\\r\\n        setTimeout(resolve, ms);\\r\\n    });\\r\\n}\\n\\n/**\\r\\n * @license\\r\\n * Copyright 2019 Google LLC\\r\\n *\\r\\n * Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\\r\\n * you may not use this file except in compliance with the License.\\r\\n * You may obtain a copy of the License at\\r\\n *\\r\\n *   http://www.apache.org/licenses/LICENSE-2.0\\r\\n *\\r\\n * Unless required by applicable law or agreed to in writing, software\\r\\n * distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\r\\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\r\\n * See the License for the specific language governing permissions and\\r\\n * limitations under the License.\\r\\n */\\r\\nfunction bufferToBase64UrlSafe(array) {\\r\\n    var b64 = btoa(String.fromCharCode.apply(String, tslib.__spreadArray([], tslib.__read(array))));\\r\\n    return b64.replace(/\\\\+/g, '-').replace(/\\\\//g, '_');\\r\\n}\\n\\n/**\\r\\n * @license\\r\\n * Copyright 2019 Google LLC\\r\\n *\\r\\n * Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\\r\\n * you may not use this file except in compliance with the License.\\r\\n * You may obtain a copy of the License at\\r\\n *\\r\\n *   http://www.apache.org/licenses/LICENSE-2.0\\r\\n *\\r\\n * Unless required by applicable law or agreed to in writing, software\\r\\n * distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\r\\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\r\\n * See the License for the specific language governing permissions and\\r\\n * limitations under the License.\\r\\n */\\r\\nvar VALID_FID_PATTERN = /^[cdef][\\\\w-]{21}$/;\\r\\nvar INVALID_FID = '';\\r\\n/**\\r\\n * Generates a new FID using random values from Web Crypto API.\\r\\n * Returns an empty string if FID generation fails for any reason.\\r\\n */\\r\\nfunction generateFid() {\\r\\n    try {\\r\\n        // A valid FID has exactly 22 base64 characters, which is 132 bits, or 16.5\\r\\n        // bytes. our implementation generates a 17 byte array instead.\\r\\n        var fidByteArray = new Uint8Array(17);\\r\\n        var crypto_1 = self.crypto || self.msCrypto;\\r\\n        crypto_1.getRandomValues(fidByteArray);\\r\\n        // Replace the first 4 random bits with the constant FID header of 0b0111.\\r\\n        fidByteArray[0] = 112 + (fidByteArray[0] % 16);\\r\\n        var fid = encode(fidByteArray);\\r\\n        return VALID_FID_PATTERN.test(fid) ? fid : INVALID_FID;\\r\\n    }\\r\\n    catch (_a) {\\r\\n        // FID generation errored\\r\\n        return INVALID_FID;\\r\\n    }\\r\\n}\\r\\n/** Converts a FID Uint8Array to a base64 string representation. */\\r\\nfunction encode(fidByteArray) {\\r\\n    var b64String = bufferToBase64UrlSafe(fidByteArray);\\r\\n    // Remove the 23rd character that was added because of the extra 4 bits at the\\r\\n    // end of our 17 byte array, and the '=' padding.\\r\\n    return b64String.substr(0, 22);\\r\\n}\\n\\n/**\\r\\n * @license\\r\\n * Copyright 2019 Google LLC\\r\\n *\\r\\n * Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\\r\\n * you may not use this file except in compliance with the License.\\r\\n * You may obtain a copy of the License at\\r\\n *\\r\\n *   http://www.apache.org/licenses/LICENSE-2.0\\r\\n *\\r\\n * Unless required by applicable law or agreed to in writing, software\\r\\n * distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\r\\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\r\\n * See the License for the specific language governing permissions and\\r\\n * limitations under the License.\\r\\n */\\r\\n/** Returns a string key that can be used to identify the app. */\\r\\nfunction getKey(appConfig) {\\r\\n    return appConfig.appName + \\\"!\\\" + appConfig.appId;\\r\\n}\\n\\n/**\\r\\n * @license\\r\\n * Copyright 2019 Google LLC\\r\\n *\\r\\n * Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\\r\\n * you may not use this file except in compliance with the License.\\r\\n * You may obtain a copy of the License at\\r\\n *\\r\\n *   http://www.apache.org/licenses/LICENSE-2.0\\r\\n *\\r\\n * Unless required by applicable law or agreed to in writing, software\\r\\n * distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\r\\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\r\\n * See the License for the specific language governing permissions and\\r\\n * limitations under the License.\\r\\n */\\r\\nvar fidChangeCallbacks = new Map();\\r\\n/**\\r\\n * Calls the onIdChange callbacks with the new FID value, and broadcasts the\\r\\n * change to other tabs.\\r\\n */\\r\\nfunction fidChanged(appConfig, fid) {\\r\\n    var key = getKey(appConfig);\\r\\n    callFidChangeCallbacks(key, fid);\\r\\n    broadcastFidChange(key, fid);\\r\\n}\\r\\nfunction addCallback(appConfig, callback) {\\r\\n    // Open the broadcast channel if it's not already open,\\r\\n    // to be able to listen to change events from other tabs.\\r\\n    getBroadcastChannel();\\r\\n    var key = getKey(appConfig);\\r\\n    var callbackSet = fidChangeCallbacks.get(key);\\r\\n    if (!callbackSet) {\\r\\n        callbackSet = new Set();\\r\\n        fidChangeCallbacks.set(key, callbackSet);\\r\\n    }\\r\\n    callbackSet.add(callback);\\r\\n}\\r\\nfunction removeCallback(appConfig, callback) {\\r\\n    var key = getKey(appConfig);\\r\\n    var callbackSet = fidChangeCallbacks.get(key);\\r\\n    if (!callbackSet) {\\r\\n        return;\\r\\n    }\\r\\n    callbackSet.delete(callback);\\r\\n    if (callbackSet.size === 0) {\\r\\n        fidChangeCallbacks.delete(key);\\r\\n    }\\r\\n    // Close broadcast channel if there are no more callbacks.\\r\\n    closeBroadcastChannel();\\r\\n}\\r\\nfunction callFidChangeCallbacks(key, fid) {\\r\\n    var e_1, _a;\\r\\n    var callbacks = fidChangeCallbacks.get(key);\\r\\n    if (!callbacks) {\\r\\n        return;\\r\\n    }\\r\\n    try {\\r\\n        for (var callbacks_1 = tslib.__values(callbacks), callbacks_1_1 = callbacks_1.next(); !callbacks_1_1.done; callbacks_1_1 = callbacks_1.next()) {\\r\\n            var callback = callbacks_1_1.value;\\r\\n            callback(fid);\\r\\n        }\\r\\n    }\\r\\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\\r\\n    finally {\\r\\n        try {\\r\\n            if (callbacks_1_1 && !callbacks_1_1.done && (_a = callbacks_1.return)) _a.call(callbacks_1);\\r\\n        }\\r\\n        finally { if (e_1) throw e_1.error; }\\r\\n    }\\r\\n}\\r\\nfunction broadcastFidChange(key, fid) {\\r\\n    var channel = getBroadcastChannel();\\r\\n    if (channel) {\\r\\n        channel.postMessage({ key: key, fid: fid });\\r\\n    }\\r\\n    closeBroadcastChannel();\\r\\n}\\r\\nvar broadcastChannel = null;\\r\\n/** Opens and returns a BroadcastChannel if it is supported by the browser. */\\r\\nfunction getBroadcastChannel() {\\r\\n    if (!broadcastChannel && 'BroadcastChannel' in self) {\\r\\n        broadcastChannel = new BroadcastChannel('[Firebase] FID Change');\\r\\n        broadcastChannel.onmessage = function (e) {\\r\\n            callFidChangeCallbacks(e.data.key, e.data.fid);\\r\\n        };\\r\\n    }\\r\\n    return broadcastChannel;\\r\\n}\\r\\nfunction closeBroadcastChannel() {\\r\\n    if (fidChangeCallbacks.size === 0 && broadcastChannel) {\\r\\n        broadcastChannel.close();\\r\\n        broadcastChannel = null;\\r\\n    }\\r\\n}\\n\\n/**\\r\\n * @license\\r\\n * Copyright 2019 Google LLC\\r\\n *\\r\\n * Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\\r\\n * you may not use this file except in compliance with the License.\\r\\n * You may obtain a copy of the License at\\r\\n *\\r\\n *   http://www.apache.org/licenses/LICENSE-2.0\\r\\n *\\r\\n * Unless required by applicable law or agreed to in writing, software\\r\\n * distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\r\\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\r\\n * See the License for the specific language governing permissions and\\r\\n * limitations under the License.\\r\\n */\\r\\nvar DATABASE_NAME = 'firebase-installations-database';\\r\\nvar DATABASE_VERSION = 1;\\r\\nvar OBJECT_STORE_NAME = 'firebase-installations-store';\\r\\nvar dbPromise = null;\\r\\nfunction getDbPromise() {\\r\\n    if (!dbPromise) {\\r\\n        dbPromise = idb.openDb(DATABASE_NAME, DATABASE_VERSION, function (upgradeDB) {\\r\\n            // We don't use 'break' in this switch statement, the fall-through\\r\\n            // behavior is what we want, because if there are multiple versions between\\r\\n            // the old version and the current version, we want ALL the migrations\\r\\n            // that correspond to those versions to run, not only the last one.\\r\\n            // eslint-disable-next-line default-case\\r\\n            switch (upgradeDB.oldVersion) {\\r\\n                case 0:\\r\\n                    upgradeDB.createObjectStore(OBJECT_STORE_NAME);\\r\\n            }\\r\\n        });\\r\\n    }\\r\\n    return dbPromise;\\r\\n}\\r\\n/** Assigns or overwrites the record for the given key with the given value. */\\r\\nfunction set(appConfig, value) {\\r\\n    return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n        var key, db, tx, objectStore, oldValue;\\r\\n        return tslib.__generator(this, function (_a) {\\r\\n            switch (_a.label) {\\r\\n                case 0:\\r\\n                    key = getKey(appConfig);\\r\\n                    return [4 /*yield*/, getDbPromise()];\\r\\n                case 1:\\r\\n                    db = _a.sent();\\r\\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\\r\\n                    objectStore = tx.objectStore(OBJECT_STORE_NAME);\\r\\n                    return [4 /*yield*/, objectStore.get(key)];\\r\\n                case 2:\\r\\n                    oldValue = _a.sent();\\r\\n                    return [4 /*yield*/, objectStore.put(value, key)];\\r\\n                case 3:\\r\\n                    _a.sent();\\r\\n                    return [4 /*yield*/, tx.complete];\\r\\n                case 4:\\r\\n                    _a.sent();\\r\\n                    if (!oldValue || oldValue.fid !== value.fid) {\\r\\n                        fidChanged(appConfig, value.fid);\\r\\n                    }\\r\\n                    return [2 /*return*/, value];\\r\\n            }\\r\\n        });\\r\\n    });\\r\\n}\\r\\n/** Removes record(s) from the objectStore that match the given key. */\\r\\nfunction remove(appConfig) {\\r\\n    return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n        var key, db, tx;\\r\\n        return tslib.__generator(this, function (_a) {\\r\\n            switch (_a.label) {\\r\\n                case 0:\\r\\n                    key = getKey(appConfig);\\r\\n                    return [4 /*yield*/, getDbPromise()];\\r\\n                case 1:\\r\\n                    db = _a.sent();\\r\\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\\r\\n                    return [4 /*yield*/, tx.objectStore(OBJECT_STORE_NAME).delete(key)];\\r\\n                case 2:\\r\\n                    _a.sent();\\r\\n                    return [4 /*yield*/, tx.complete];\\r\\n                case 3:\\r\\n                    _a.sent();\\r\\n                    return [2 /*return*/];\\r\\n            }\\r\\n        });\\r\\n    });\\r\\n}\\r\\n/**\\r\\n * Atomically updates a record with the result of updateFn, which gets\\r\\n * called with the current value. If newValue is undefined, the record is\\r\\n * deleted instead.\\r\\n * @return Updated value\\r\\n */\\r\\nfunction update(appConfig, updateFn) {\\r\\n    return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n        var key, db, tx, store, oldValue, newValue;\\r\\n        return tslib.__generator(this, function (_a) {\\r\\n            switch (_a.label) {\\r\\n                case 0:\\r\\n                    key = getKey(appConfig);\\r\\n                    return [4 /*yield*/, getDbPromise()];\\r\\n                case 1:\\r\\n                    db = _a.sent();\\r\\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\\r\\n                    store = tx.objectStore(OBJECT_STORE_NAME);\\r\\n                    return [4 /*yield*/, store.get(key)];\\r\\n                case 2:\\r\\n                    oldValue = _a.sent();\\r\\n                    newValue = updateFn(oldValue);\\r\\n                    if (!(newValue === undefined)) return [3 /*break*/, 4];\\r\\n                    return [4 /*yield*/, store.delete(key)];\\r\\n                case 3:\\r\\n                    _a.sent();\\r\\n                    return [3 /*break*/, 6];\\r\\n                case 4: return [4 /*yield*/, store.put(newValue, key)];\\r\\n                case 5:\\r\\n                    _a.sent();\\r\\n                    _a.label = 6;\\r\\n                case 6: return [4 /*yield*/, tx.complete];\\r\\n                case 7:\\r\\n                    _a.sent();\\r\\n                    if (newValue && (!oldValue || oldValue.fid !== newValue.fid)) {\\r\\n                        fidChanged(appConfig, newValue.fid);\\r\\n                    }\\r\\n                    return [2 /*return*/, newValue];\\r\\n            }\\r\\n        });\\r\\n    });\\r\\n}\\n\\n/**\\r\\n * @license\\r\\n * Copyright 2019 Google LLC\\r\\n *\\r\\n * Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\\r\\n * you may not use this file except in compliance with the License.\\r\\n * You may obtain a copy of the License at\\r\\n *\\r\\n *   http://www.apache.org/licenses/LICENSE-2.0\\r\\n *\\r\\n * Unless required by applicable law or agreed to in writing, software\\r\\n * distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\r\\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\r\\n * See the License for the specific language governing permissions and\\r\\n * limitations under the License.\\r\\n */\\r\\n/**\\r\\n * Updates and returns the InstallationEntry from the database.\\r\\n * Also triggers a registration request if it is necessary and possible.\\r\\n */\\r\\nfunction getInstallationEntry(appConfig) {\\r\\n    return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n        var registrationPromise, installationEntry;\\r\\n        var _a;\\r\\n        return tslib.__generator(this, function (_b) {\\r\\n            switch (_b.label) {\\r\\n                case 0: return [4 /*yield*/, update(appConfig, function (oldEntry) {\\r\\n                        var installationEntry = updateOrCreateInstallationEntry(oldEntry);\\r\\n                        var entryWithPromise = triggerRegistrationIfNecessary(appConfig, installationEntry);\\r\\n                        registrationPromise = entryWithPromise.registrationPromise;\\r\\n                        return entryWithPromise.installationEntry;\\r\\n                    })];\\r\\n                case 1:\\r\\n                    installationEntry = _b.sent();\\r\\n                    if (!(installationEntry.fid === INVALID_FID)) return [3 /*break*/, 3];\\r\\n                    _a = {};\\r\\n                    return [4 /*yield*/, registrationPromise];\\r\\n                case 2: \\r\\n                // FID generation failed. Waiting for the FID from the server.\\r\\n                return [2 /*return*/, (_a.installationEntry = _b.sent(), _a)];\\r\\n                case 3: return [2 /*return*/, {\\r\\n                        installationEntry: installationEntry,\\r\\n                        registrationPromise: registrationPromise\\r\\n                    }];\\r\\n            }\\r\\n        });\\r\\n    });\\r\\n}\\r\\n/**\\r\\n * Creates a new Installation Entry if one does not exist.\\r\\n * Also clears timed out pending requests.\\r\\n */\\r\\nfunction updateOrCreateInstallationEntry(oldEntry) {\\r\\n    var entry = oldEntry || {\\r\\n        fid: generateFid(),\\r\\n        registrationStatus: 0 /* NOT_STARTED */\\r\\n    };\\r\\n    return clearTimedOutRequest(entry);\\r\\n}\\r\\n/**\\r\\n * If the Firebase Installation is not registered yet, this will trigger the\\r\\n * registration and return an InProgressInstallationEntry.\\r\\n *\\r\\n * If registrationPromise does not exist, the installationEntry is guaranteed\\r\\n * to be registered.\\r\\n */\\r\\nfunction triggerRegistrationIfNecessary(appConfig, installationEntry) {\\r\\n    if (installationEntry.registrationStatus === 0 /* NOT_STARTED */) {\\r\\n        if (!navigator.onLine) {\\r\\n            // Registration required but app is offline.\\r\\n            var registrationPromiseWithError = Promise.reject(ERROR_FACTORY.create(\\\"app-offline\\\" /* APP_OFFLINE */));\\r\\n            return {\\r\\n                installationEntry: installationEntry,\\r\\n                registrationPromise: registrationPromiseWithError\\r\\n            };\\r\\n        }\\r\\n        // Try registering. Change status to IN_PROGRESS.\\r\\n        var inProgressEntry = {\\r\\n            fid: installationEntry.fid,\\r\\n            registrationStatus: 1 /* IN_PROGRESS */,\\r\\n            registrationTime: Date.now()\\r\\n        };\\r\\n        var registrationPromise = registerInstallation(appConfig, inProgressEntry);\\r\\n        return { installationEntry: inProgressEntry, registrationPromise: registrationPromise };\\r\\n    }\\r\\n    else if (installationEntry.registrationStatus === 1 /* IN_PROGRESS */) {\\r\\n        return {\\r\\n            installationEntry: installationEntry,\\r\\n            registrationPromise: waitUntilFidRegistration(appConfig)\\r\\n        };\\r\\n    }\\r\\n    else {\\r\\n        return { installationEntry: installationEntry };\\r\\n    }\\r\\n}\\r\\n/** This will be executed only once for each new Firebase Installation. */\\r\\nfunction registerInstallation(appConfig, installationEntry) {\\r\\n    return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n        var registeredInstallationEntry, e_1;\\r\\n        return tslib.__generator(this, function (_a) {\\r\\n            switch (_a.label) {\\r\\n                case 0:\\r\\n                    _a.trys.push([0, 2, , 7]);\\r\\n                    return [4 /*yield*/, createInstallationRequest(appConfig, installationEntry)];\\r\\n                case 1:\\r\\n                    registeredInstallationEntry = _a.sent();\\r\\n                    return [2 /*return*/, set(appConfig, registeredInstallationEntry)];\\r\\n                case 2:\\r\\n                    e_1 = _a.sent();\\r\\n                    if (!(isServerError(e_1) && e_1.customData.serverCode === 409)) return [3 /*break*/, 4];\\r\\n                    // Server returned a \\\"FID can not be used\\\" error.\\r\\n                    // Generate a new ID next time.\\r\\n                    return [4 /*yield*/, remove(appConfig)];\\r\\n                case 3:\\r\\n                    // Server returned a \\\"FID can not be used\\\" error.\\r\\n                    // Generate a new ID next time.\\r\\n                    _a.sent();\\r\\n                    return [3 /*break*/, 6];\\r\\n                case 4: \\r\\n                // Registration failed. Set FID as not registered.\\r\\n                return [4 /*yield*/, set(appConfig, {\\r\\n                        fid: installationEntry.fid,\\r\\n                        registrationStatus: 0 /* NOT_STARTED */\\r\\n                    })];\\r\\n                case 5:\\r\\n                    // Registration failed. Set FID as not registered.\\r\\n                    _a.sent();\\r\\n                    _a.label = 6;\\r\\n                case 6: throw e_1;\\r\\n                case 7: return [2 /*return*/];\\r\\n            }\\r\\n        });\\r\\n    });\\r\\n}\\r\\n/** Call if FID registration is pending in another request. */\\r\\nfunction waitUntilFidRegistration(appConfig) {\\r\\n    return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n        var entry, _a, installationEntry, registrationPromise;\\r\\n        return tslib.__generator(this, function (_b) {\\r\\n            switch (_b.label) {\\r\\n                case 0: return [4 /*yield*/, updateInstallationRequest(appConfig)];\\r\\n                case 1:\\r\\n                    entry = _b.sent();\\r\\n                    _b.label = 2;\\r\\n                case 2:\\r\\n                    if (!(entry.registrationStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 5];\\r\\n                    // createInstallation request still in progress.\\r\\n                    return [4 /*yield*/, sleep(100)];\\r\\n                case 3:\\r\\n                    // createInstallation request still in progress.\\r\\n                    _b.sent();\\r\\n                    return [4 /*yield*/, updateInstallationRequest(appConfig)];\\r\\n                case 4:\\r\\n                    entry = _b.sent();\\r\\n                    return [3 /*break*/, 2];\\r\\n                case 5:\\r\\n                    if (!(entry.registrationStatus === 0 /* NOT_STARTED */)) return [3 /*break*/, 7];\\r\\n                    return [4 /*yield*/, getInstallationEntry(appConfig)];\\r\\n                case 6:\\r\\n                    _a = _b.sent(), installationEntry = _a.installationEntry, registrationPromise = _a.registrationPromise;\\r\\n                    if (registrationPromise) {\\r\\n                        return [2 /*return*/, registrationPromise];\\r\\n                    }\\r\\n                    else {\\r\\n                        // if there is no registrationPromise, entry is registered.\\r\\n                        return [2 /*return*/, installationEntry];\\r\\n                    }\\r\\n                case 7: return [2 /*return*/, entry];\\r\\n            }\\r\\n        });\\r\\n    });\\r\\n}\\r\\n/**\\r\\n * Called only if there is a CreateInstallation request in progress.\\r\\n *\\r\\n * Updates the InstallationEntry in the DB based on the status of the\\r\\n * CreateInstallation request.\\r\\n *\\r\\n * Returns the updated InstallationEntry.\\r\\n */\\r\\nfunction updateInstallationRequest(appConfig) {\\r\\n    return update(appConfig, function (oldEntry) {\\r\\n        if (!oldEntry) {\\r\\n            throw ERROR_FACTORY.create(\\\"installation-not-found\\\" /* INSTALLATION_NOT_FOUND */);\\r\\n        }\\r\\n        return clearTimedOutRequest(oldEntry);\\r\\n    });\\r\\n}\\r\\nfunction clearTimedOutRequest(entry) {\\r\\n    if (hasInstallationRequestTimedOut(entry)) {\\r\\n        return {\\r\\n            fid: entry.fid,\\r\\n            registrationStatus: 0 /* NOT_STARTED */\\r\\n        };\\r\\n    }\\r\\n    return entry;\\r\\n}\\r\\nfunction hasInstallationRequestTimedOut(installationEntry) {\\r\\n    return (installationEntry.registrationStatus === 1 /* IN_PROGRESS */ &&\\r\\n        installationEntry.registrationTime + PENDING_TIMEOUT_MS < Date.now());\\r\\n}\\n\\n/**\\r\\n * @license\\r\\n * Copyright 2019 Google LLC\\r\\n *\\r\\n * Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\\r\\n * you may not use this file except in compliance with the License.\\r\\n * You may obtain a copy of the License at\\r\\n *\\r\\n *   http://www.apache.org/licenses/LICENSE-2.0\\r\\n *\\r\\n * Unless required by applicable law or agreed to in writing, software\\r\\n * distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\r\\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\r\\n * See the License for the specific language governing permissions and\\r\\n * limitations under the License.\\r\\n */\\r\\nfunction generateAuthTokenRequest(_a, installationEntry) {\\r\\n    var appConfig = _a.appConfig, platformLoggerProvider = _a.platformLoggerProvider;\\r\\n    return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n        var endpoint, headers, platformLogger, body, request, response, responseValue, completedAuthToken;\\r\\n        return tslib.__generator(this, function (_b) {\\r\\n            switch (_b.label) {\\r\\n                case 0:\\r\\n                    endpoint = getGenerateAuthTokenEndpoint(appConfig, installationEntry);\\r\\n                    headers = getHeadersWithAuth(appConfig, installationEntry);\\r\\n                    platformLogger = platformLoggerProvider.getImmediate({\\r\\n                        optional: true\\r\\n                    });\\r\\n                    if (platformLogger) {\\r\\n                        headers.append('x-firebase-client', platformLogger.getPlatformInfoString());\\r\\n                    }\\r\\n                    body = {\\r\\n                        installation: {\\r\\n                            sdkVersion: PACKAGE_VERSION\\r\\n                        }\\r\\n                    };\\r\\n                    request = {\\r\\n                        method: 'POST',\\r\\n                        headers: headers,\\r\\n                        body: JSON.stringify(body)\\r\\n                    };\\r\\n                    return [4 /*yield*/, retryIfServerError(function () { return fetch(endpoint, request); })];\\r\\n                case 1:\\r\\n                    response = _b.sent();\\r\\n                    if (!response.ok) return [3 /*break*/, 3];\\r\\n                    return [4 /*yield*/, response.json()];\\r\\n                case 2:\\r\\n                    responseValue = _b.sent();\\r\\n                    completedAuthToken = extractAuthTokenInfoFromResponse(responseValue);\\r\\n                    return [2 /*return*/, completedAuthToken];\\r\\n                case 3: return [4 /*yield*/, getErrorFromResponse('Generate Auth Token', response)];\\r\\n                case 4: throw _b.sent();\\r\\n            }\\r\\n        });\\r\\n    });\\r\\n}\\r\\nfunction getGenerateAuthTokenEndpoint(appConfig, _a) {\\r\\n    var fid = _a.fid;\\r\\n    return getInstallationsEndpoint(appConfig) + \\\"/\\\" + fid + \\\"/authTokens:generate\\\";\\r\\n}\\n\\n/**\\r\\n * @license\\r\\n * Copyright 2019 Google LLC\\r\\n *\\r\\n * Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\\r\\n * you may not use this file except in compliance with the License.\\r\\n * You may obtain a copy of the License at\\r\\n *\\r\\n *   http://www.apache.org/licenses/LICENSE-2.0\\r\\n *\\r\\n * Unless required by applicable law or agreed to in writing, software\\r\\n * distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\r\\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\r\\n * See the License for the specific language governing permissions and\\r\\n * limitations under the License.\\r\\n */\\r\\n/**\\r\\n * Returns a valid authentication token for the installation. Generates a new\\r\\n * token if one doesn't exist, is expired or about to expire.\\r\\n *\\r\\n * Should only be called if the Firebase Installation is registered.\\r\\n */\\r\\nfunction refreshAuthToken(dependencies, forceRefresh) {\\r\\n    if (forceRefresh === void 0) { forceRefresh = false; }\\r\\n    return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n        var tokenPromise, entry, authToken, _a;\\r\\n        return tslib.__generator(this, function (_b) {\\r\\n            switch (_b.label) {\\r\\n                case 0: return [4 /*yield*/, update(dependencies.appConfig, function (oldEntry) {\\r\\n                        if (!isEntryRegistered(oldEntry)) {\\r\\n                            throw ERROR_FACTORY.create(\\\"not-registered\\\" /* NOT_REGISTERED */);\\r\\n                        }\\r\\n                        var oldAuthToken = oldEntry.authToken;\\r\\n                        if (!forceRefresh && isAuthTokenValid(oldAuthToken)) {\\r\\n                            // There is a valid token in the DB.\\r\\n                            return oldEntry;\\r\\n                        }\\r\\n                        else if (oldAuthToken.requestStatus === 1 /* IN_PROGRESS */) {\\r\\n                            // There already is a token request in progress.\\r\\n                            tokenPromise = waitUntilAuthTokenRequest(dependencies, forceRefresh);\\r\\n                            return oldEntry;\\r\\n                        }\\r\\n                        else {\\r\\n                            // No token or token expired.\\r\\n                            if (!navigator.onLine) {\\r\\n                                throw ERROR_FACTORY.create(\\\"app-offline\\\" /* APP_OFFLINE */);\\r\\n                            }\\r\\n                            var inProgressEntry = makeAuthTokenRequestInProgressEntry(oldEntry);\\r\\n                            tokenPromise = fetchAuthTokenFromServer(dependencies, inProgressEntry);\\r\\n                            return inProgressEntry;\\r\\n                        }\\r\\n                    })];\\r\\n                case 1:\\r\\n                    entry = _b.sent();\\r\\n                    if (!tokenPromise) return [3 /*break*/, 3];\\r\\n                    return [4 /*yield*/, tokenPromise];\\r\\n                case 2:\\r\\n                    _a = _b.sent();\\r\\n                    return [3 /*break*/, 4];\\r\\n                case 3:\\r\\n                    _a = entry.authToken;\\r\\n                    _b.label = 4;\\r\\n                case 4:\\r\\n                    authToken = _a;\\r\\n                    return [2 /*return*/, authToken];\\r\\n            }\\r\\n        });\\r\\n    });\\r\\n}\\r\\n/**\\r\\n * Call only if FID is registered and Auth Token request is in progress.\\r\\n *\\r\\n * Waits until the current pending request finishes. If the request times out,\\r\\n * tries once in this thread as well.\\r\\n */\\r\\nfunction waitUntilAuthTokenRequest(dependencies, forceRefresh) {\\r\\n    return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n        var entry, authToken;\\r\\n        return tslib.__generator(this, function (_a) {\\r\\n            switch (_a.label) {\\r\\n                case 0: return [4 /*yield*/, updateAuthTokenRequest(dependencies.appConfig)];\\r\\n                case 1:\\r\\n                    entry = _a.sent();\\r\\n                    _a.label = 2;\\r\\n                case 2:\\r\\n                    if (!(entry.authToken.requestStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 5];\\r\\n                    // generateAuthToken still in progress.\\r\\n                    return [4 /*yield*/, sleep(100)];\\r\\n                case 3:\\r\\n                    // generateAuthToken still in progress.\\r\\n                    _a.sent();\\r\\n                    return [4 /*yield*/, updateAuthTokenRequest(dependencies.appConfig)];\\r\\n                case 4:\\r\\n                    entry = _a.sent();\\r\\n                    return [3 /*break*/, 2];\\r\\n                case 5:\\r\\n                    authToken = entry.authToken;\\r\\n                    if (authToken.requestStatus === 0 /* NOT_STARTED */) {\\r\\n                        // The request timed out or failed in a different call. Try again.\\r\\n                        return [2 /*return*/, refreshAuthToken(dependencies, forceRefresh)];\\r\\n                    }\\r\\n                    else {\\r\\n                        return [2 /*return*/, authToken];\\r\\n                    }\\r\\n            }\\r\\n        });\\r\\n    });\\r\\n}\\r\\n/**\\r\\n * Called only if there is a GenerateAuthToken request in progress.\\r\\n *\\r\\n * Updates the InstallationEntry in the DB based on the status of the\\r\\n * GenerateAuthToken request.\\r\\n *\\r\\n * Returns the updated InstallationEntry.\\r\\n */\\r\\nfunction updateAuthTokenRequest(appConfig) {\\r\\n    return update(appConfig, function (oldEntry) {\\r\\n        if (!isEntryRegistered(oldEntry)) {\\r\\n            throw ERROR_FACTORY.create(\\\"not-registered\\\" /* NOT_REGISTERED */);\\r\\n        }\\r\\n        var oldAuthToken = oldEntry.authToken;\\r\\n        if (hasAuthTokenRequestTimedOut(oldAuthToken)) {\\r\\n            return tslib.__assign(tslib.__assign({}, oldEntry), { authToken: { requestStatus: 0 /* NOT_STARTED */ } });\\r\\n        }\\r\\n        return oldEntry;\\r\\n    });\\r\\n}\\r\\nfunction fetchAuthTokenFromServer(dependencies, installationEntry) {\\r\\n    return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n        var authToken, updatedInstallationEntry, e_1, updatedInstallationEntry;\\r\\n        return tslib.__generator(this, function (_a) {\\r\\n            switch (_a.label) {\\r\\n                case 0:\\r\\n                    _a.trys.push([0, 3, , 8]);\\r\\n                    return [4 /*yield*/, generateAuthTokenRequest(dependencies, installationEntry)];\\r\\n                case 1:\\r\\n                    authToken = _a.sent();\\r\\n                    updatedInstallationEntry = tslib.__assign(tslib.__assign({}, installationEntry), { authToken: authToken });\\r\\n                    return [4 /*yield*/, set(dependencies.appConfig, updatedInstallationEntry)];\\r\\n                case 2:\\r\\n                    _a.sent();\\r\\n                    return [2 /*return*/, authToken];\\r\\n                case 3:\\r\\n                    e_1 = _a.sent();\\r\\n                    if (!(isServerError(e_1) &&\\r\\n                        (e_1.customData.serverCode === 401 || e_1.customData.serverCode === 404))) return [3 /*break*/, 5];\\r\\n                    // Server returned a \\\"FID not found\\\" or a \\\"Invalid authentication\\\" error.\\r\\n                    // Generate a new ID next time.\\r\\n                    return [4 /*yield*/, remove(dependencies.appConfig)];\\r\\n                case 4:\\r\\n                    // Server returned a \\\"FID not found\\\" or a \\\"Invalid authentication\\\" error.\\r\\n                    // Generate a new ID next time.\\r\\n                    _a.sent();\\r\\n                    return [3 /*break*/, 7];\\r\\n                case 5:\\r\\n                    updatedInstallationEntry = tslib.__assign(tslib.__assign({}, installationEntry), { authToken: { requestStatus: 0 /* NOT_STARTED */ } });\\r\\n                    return [4 /*yield*/, set(dependencies.appConfig, updatedInstallationEntry)];\\r\\n                case 6:\\r\\n                    _a.sent();\\r\\n                    _a.label = 7;\\r\\n                case 7: throw e_1;\\r\\n                case 8: return [2 /*return*/];\\r\\n            }\\r\\n        });\\r\\n    });\\r\\n}\\r\\nfunction isEntryRegistered(installationEntry) {\\r\\n    return (installationEntry !== undefined &&\\r\\n        installationEntry.registrationStatus === 2 /* COMPLETED */);\\r\\n}\\r\\nfunction isAuthTokenValid(authToken) {\\r\\n    return (authToken.requestStatus === 2 /* COMPLETED */ &&\\r\\n        !isAuthTokenExpired(authToken));\\r\\n}\\r\\nfunction isAuthTokenExpired(authToken) {\\r\\n    var now = Date.now();\\r\\n    return (now < authToken.creationTime ||\\r\\n        authToken.creationTime + authToken.expiresIn < now + TOKEN_EXPIRATION_BUFFER);\\r\\n}\\r\\n/** Returns an updated InstallationEntry with an InProgressAuthToken. */\\r\\nfunction makeAuthTokenRequestInProgressEntry(oldEntry) {\\r\\n    var inProgressAuthToken = {\\r\\n        requestStatus: 1 /* IN_PROGRESS */,\\r\\n        requestTime: Date.now()\\r\\n    };\\r\\n    return tslib.__assign(tslib.__assign({}, oldEntry), { authToken: inProgressAuthToken });\\r\\n}\\r\\nfunction hasAuthTokenRequestTimedOut(authToken) {\\r\\n    return (authToken.requestStatus === 1 /* IN_PROGRESS */ &&\\r\\n        authToken.requestTime + PENDING_TIMEOUT_MS < Date.now());\\r\\n}\\n\\n/**\\r\\n * @license\\r\\n * Copyright 2019 Google LLC\\r\\n *\\r\\n * Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\\r\\n * you may not use this file except in compliance with the License.\\r\\n * You may obtain a copy of the License at\\r\\n *\\r\\n *   http://www.apache.org/licenses/LICENSE-2.0\\r\\n *\\r\\n * Unless required by applicable law or agreed to in writing, software\\r\\n * distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\r\\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\r\\n * See the License for the specific language governing permissions and\\r\\n * limitations under the License.\\r\\n */\\r\\nfunction getId(dependencies) {\\r\\n    return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n        var _a, installationEntry, registrationPromise;\\r\\n        return tslib.__generator(this, function (_b) {\\r\\n            switch (_b.label) {\\r\\n                case 0: return [4 /*yield*/, getInstallationEntry(dependencies.appConfig)];\\r\\n                case 1:\\r\\n                    _a = _b.sent(), installationEntry = _a.installationEntry, registrationPromise = _a.registrationPromise;\\r\\n                    if (registrationPromise) {\\r\\n                        registrationPromise.catch(console.error);\\r\\n                    }\\r\\n                    else {\\r\\n                        // If the installation is already registered, update the authentication\\r\\n                        // token if needed.\\r\\n                        refreshAuthToken(dependencies).catch(console.error);\\r\\n                    }\\r\\n                    return [2 /*return*/, installationEntry.fid];\\r\\n            }\\r\\n        });\\r\\n    });\\r\\n}\\n\\n/**\\r\\n * @license\\r\\n * Copyright 2019 Google LLC\\r\\n *\\r\\n * Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\\r\\n * you may not use this file except in compliance with the License.\\r\\n * You may obtain a copy of the License at\\r\\n *\\r\\n *   http://www.apache.org/licenses/LICENSE-2.0\\r\\n *\\r\\n * Unless required by applicable law or agreed to in writing, software\\r\\n * distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\r\\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\r\\n * See the License for the specific language governing permissions and\\r\\n * limitations under the License.\\r\\n */\\r\\nfunction getToken(dependencies, forceRefresh) {\\r\\n    if (forceRefresh === void 0) { forceRefresh = false; }\\r\\n    return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n        var authToken;\\r\\n        return tslib.__generator(this, function (_a) {\\r\\n            switch (_a.label) {\\r\\n                case 0: return [4 /*yield*/, completeInstallationRegistration(dependencies.appConfig)];\\r\\n                case 1:\\r\\n                    _a.sent();\\r\\n                    return [4 /*yield*/, refreshAuthToken(dependencies, forceRefresh)];\\r\\n                case 2:\\r\\n                    authToken = _a.sent();\\r\\n                    return [2 /*return*/, authToken.token];\\r\\n            }\\r\\n        });\\r\\n    });\\r\\n}\\r\\nfunction completeInstallationRegistration(appConfig) {\\r\\n    return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n        var registrationPromise;\\r\\n        return tslib.__generator(this, function (_a) {\\r\\n            switch (_a.label) {\\r\\n                case 0: return [4 /*yield*/, getInstallationEntry(appConfig)];\\r\\n                case 1:\\r\\n                    registrationPromise = (_a.sent()).registrationPromise;\\r\\n                    if (!registrationPromise) return [3 /*break*/, 3];\\r\\n                    // A createInstallation request is in progress. Wait until it finishes.\\r\\n                    return [4 /*yield*/, registrationPromise];\\r\\n                case 2:\\r\\n                    // A createInstallation request is in progress. Wait until it finishes.\\r\\n                    _a.sent();\\r\\n                    _a.label = 3;\\r\\n                case 3: return [2 /*return*/];\\r\\n            }\\r\\n        });\\r\\n    });\\r\\n}\\n\\n/**\\r\\n * @license\\r\\n * Copyright 2019 Google LLC\\r\\n *\\r\\n * Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\\r\\n * you may not use this file except in compliance with the License.\\r\\n * You may obtain a copy of the License at\\r\\n *\\r\\n *   http://www.apache.org/licenses/LICENSE-2.0\\r\\n *\\r\\n * Unless required by applicable law or agreed to in writing, software\\r\\n * distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\r\\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\r\\n * See the License for the specific language governing permissions and\\r\\n * limitations under the License.\\r\\n */\\r\\nfunction deleteInstallationRequest(appConfig, installationEntry) {\\r\\n    return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n        var endpoint, headers, request, response;\\r\\n        return tslib.__generator(this, function (_a) {\\r\\n            switch (_a.label) {\\r\\n                case 0:\\r\\n                    endpoint = getDeleteEndpoint(appConfig, installationEntry);\\r\\n                    headers = getHeadersWithAuth(appConfig, installationEntry);\\r\\n                    request = {\\r\\n                        method: 'DELETE',\\r\\n                        headers: headers\\r\\n                    };\\r\\n                    return [4 /*yield*/, retryIfServerError(function () { return fetch(endpoint, request); })];\\r\\n                case 1:\\r\\n                    response = _a.sent();\\r\\n                    if (!!response.ok) return [3 /*break*/, 3];\\r\\n                    return [4 /*yield*/, getErrorFromResponse('Delete Installation', response)];\\r\\n                case 2: throw _a.sent();\\r\\n                case 3: return [2 /*return*/];\\r\\n            }\\r\\n        });\\r\\n    });\\r\\n}\\r\\nfunction getDeleteEndpoint(appConfig, _a) {\\r\\n    var fid = _a.fid;\\r\\n    return getInstallationsEndpoint(appConfig) + \\\"/\\\" + fid;\\r\\n}\\n\\n/**\\r\\n * @license\\r\\n * Copyright 2019 Google LLC\\r\\n *\\r\\n * Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\\r\\n * you may not use this file except in compliance with the License.\\r\\n * You may obtain a copy of the License at\\r\\n *\\r\\n *   http://www.apache.org/licenses/LICENSE-2.0\\r\\n *\\r\\n * Unless required by applicable law or agreed to in writing, software\\r\\n * distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\r\\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\r\\n * See the License for the specific language governing permissions and\\r\\n * limitations under the License.\\r\\n */\\r\\nfunction deleteInstallation(dependencies) {\\r\\n    return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n        var appConfig, entry;\\r\\n        return tslib.__generator(this, function (_a) {\\r\\n            switch (_a.label) {\\r\\n                case 0:\\r\\n                    appConfig = dependencies.appConfig;\\r\\n                    return [4 /*yield*/, update(appConfig, function (oldEntry) {\\r\\n                            if (oldEntry && oldEntry.registrationStatus === 0 /* NOT_STARTED */) {\\r\\n                                // Delete the unregistered entry without sending a deleteInstallation request.\\r\\n                                return undefined;\\r\\n                            }\\r\\n                            return oldEntry;\\r\\n                        })];\\r\\n                case 1:\\r\\n                    entry = _a.sent();\\r\\n                    if (!entry) return [3 /*break*/, 6];\\r\\n                    if (!(entry.registrationStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 2];\\r\\n                    // Can't delete while trying to register.\\r\\n                    throw ERROR_FACTORY.create(\\\"delete-pending-registration\\\" /* DELETE_PENDING_REGISTRATION */);\\r\\n                case 2:\\r\\n                    if (!(entry.registrationStatus === 2 /* COMPLETED */)) return [3 /*break*/, 6];\\r\\n                    if (!!navigator.onLine) return [3 /*break*/, 3];\\r\\n                    throw ERROR_FACTORY.create(\\\"app-offline\\\" /* APP_OFFLINE */);\\r\\n                case 3: return [4 /*yield*/, deleteInstallationRequest(appConfig, entry)];\\r\\n                case 4:\\r\\n                    _a.sent();\\r\\n                    return [4 /*yield*/, remove(appConfig)];\\r\\n                case 5:\\r\\n                    _a.sent();\\r\\n                    _a.label = 6;\\r\\n                case 6: return [2 /*return*/];\\r\\n            }\\r\\n        });\\r\\n    });\\r\\n}\\n\\n/**\\r\\n * @license\\r\\n * Copyright 2019 Google LLC\\r\\n *\\r\\n * Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\\r\\n * you may not use this file except in compliance with the License.\\r\\n * You may obtain a copy of the License at\\r\\n *\\r\\n *   http://www.apache.org/licenses/LICENSE-2.0\\r\\n *\\r\\n * Unless required by applicable law or agreed to in writing, software\\r\\n * distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\r\\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\r\\n * See the License for the specific language governing permissions and\\r\\n * limitations under the License.\\r\\n */\\r\\n/**\\r\\n * Sets a new callback that will get called when Installation ID changes.\\r\\n * Returns an unsubscribe function that will remove the callback when called.\\r\\n */\\r\\nfunction onIdChange(_a, callback) {\\r\\n    var appConfig = _a.appConfig;\\r\\n    addCallback(appConfig, callback);\\r\\n    return function () {\\r\\n        removeCallback(appConfig, callback);\\r\\n    };\\r\\n}\\n\\n/**\\r\\n * @license\\r\\n * Copyright 2019 Google LLC\\r\\n *\\r\\n * Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\\r\\n * you may not use this file except in compliance with the License.\\r\\n * You may obtain a copy of the License at\\r\\n *\\r\\n *   http://www.apache.org/licenses/LICENSE-2.0\\r\\n *\\r\\n * Unless required by applicable law or agreed to in writing, software\\r\\n * distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\r\\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\r\\n * See the License for the specific language governing permissions and\\r\\n * limitations under the License.\\r\\n */\\r\\nfunction extractAppConfig(app) {\\r\\n    var e_1, _a;\\r\\n    if (!app || !app.options) {\\r\\n        throw getMissingValueError('App Configuration');\\r\\n    }\\r\\n    if (!app.name) {\\r\\n        throw getMissingValueError('App Name');\\r\\n    }\\r\\n    // Required app config keys\\r\\n    var configKeys = [\\r\\n        'projectId',\\r\\n        'apiKey',\\r\\n        'appId'\\r\\n    ];\\r\\n    try {\\r\\n        for (var configKeys_1 = tslib.__values(configKeys), configKeys_1_1 = configKeys_1.next(); !configKeys_1_1.done; configKeys_1_1 = configKeys_1.next()) {\\r\\n            var keyName = configKeys_1_1.value;\\r\\n            if (!app.options[keyName]) {\\r\\n                throw getMissingValueError(keyName);\\r\\n            }\\r\\n        }\\r\\n    }\\r\\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\\r\\n    finally {\\r\\n        try {\\r\\n            if (configKeys_1_1 && !configKeys_1_1.done && (_a = configKeys_1.return)) _a.call(configKeys_1);\\r\\n        }\\r\\n        finally { if (e_1) throw e_1.error; }\\r\\n    }\\r\\n    return {\\r\\n        appName: app.name,\\r\\n        projectId: app.options.projectId,\\r\\n        apiKey: app.options.apiKey,\\r\\n        appId: app.options.appId\\r\\n    };\\r\\n}\\r\\nfunction getMissingValueError(valueName) {\\r\\n    return ERROR_FACTORY.create(\\\"missing-app-config-values\\\" /* MISSING_APP_CONFIG_VALUES */, {\\r\\n        valueName: valueName\\r\\n    });\\r\\n}\\n\\n/**\\r\\n * @license\\r\\n * Copyright 2019 Google LLC\\r\\n *\\r\\n * Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\\r\\n * you may not use this file except in compliance with the License.\\r\\n * You may obtain a copy of the License at\\r\\n *\\r\\n *   http://www.apache.org/licenses/LICENSE-2.0\\r\\n *\\r\\n * Unless required by applicable law or agreed to in writing, software\\r\\n * distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\r\\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\r\\n * See the License for the specific language governing permissions and\\r\\n * limitations under the License.\\r\\n */\\r\\nfunction registerInstallations(instance) {\\r\\n    var installationsName = 'installations';\\r\\n    instance.INTERNAL.registerComponent(new component.Component(installationsName, function (container) {\\r\\n        var app = container.getProvider('app').getImmediate();\\r\\n        // Throws if app isn't configured properly.\\r\\n        var appConfig = extractAppConfig(app);\\r\\n        var platformLoggerProvider = container.getProvider('platform-logger');\\r\\n        var dependencies = {\\r\\n            appConfig: appConfig,\\r\\n            platformLoggerProvider: platformLoggerProvider\\r\\n        };\\r\\n        var installations = {\\r\\n            app: app,\\r\\n            getId: function () { return getId(dependencies); },\\r\\n            getToken: function (forceRefresh) {\\r\\n                return getToken(dependencies, forceRefresh);\\r\\n            },\\r\\n            delete: function () { return deleteInstallation(dependencies); },\\r\\n            onIdChange: function (callback) {\\r\\n                return onIdChange(dependencies, callback);\\r\\n            }\\r\\n        };\\r\\n        return installations;\\r\\n    }, \\\"PUBLIC\\\" /* PUBLIC */));\\r\\n    instance.registerVersion(name, version);\\r\\n}\\r\\nregisterInstallations(firebase__default['default']);\\n\\nexports.registerInstallations = registerInstallations;\\n//# sourceMappingURL=index.cjs.js.map\\n\\n};\"],\n\"names\":[\"shadow$provide\",\"global\",\"require\",\"module\",\"exports\",\"isServerError\",\"error\",\"util\",\"FirebaseError\",\"code\",\"includes\",\"getInstallationsEndpoint\",\"_a\",\"projectId\",\"extractAuthTokenInfoFromResponse\",\"response\",\"token\",\"requestStatus\",\"expiresIn\",\"Number\",\"replace\",\"creationTime\",\"Date\",\"now\",\"getErrorFromResponse\",\"requestName\",\"tslib\",\"__awaiter\",\"responseJson\",\"errorData\",\"__generator\",\"label\",\"json\",\"sent\",\"ERROR_FACTORY\",\"create\",\"serverCode\",\"serverMessage\",\"message\",\"serverStatus\",\"status\",\"getHeaders\",\"Headers\",\"Accept\",\"apiKey\",\"getHeadersWithAuth\",\"appConfig\",\"refreshToken\",\"headers\",\"append\",\"retryIfServerError\",\"fn\",\"result\",\"createInstallationRequest\",\"fid\",\"endpoint\",\"body\",\"request\",\"responseValue\",\"registeredInstallationEntry\",\"_b\",\"authVersion\",\"INTERNAL_AUTH_VERSION\",\"appId\",\"sdkVersion\",\"PACKAGE_VERSION\",\"method\",\"JSON\",\"stringify\",\"fetch\",\"ok\",\"registrationStatus\",\"authToken\",\"sleep\",\"ms\",\"Promise\",\"resolve\",\"setTimeout\",\"getKey\",\"appName\",\"addCallback\",\"callback\",\"getBroadcastChannel\",\"key\",\"callbackSet\",\"fidChangeCallbacks\",\"get\",\"Set\",\"set\",\"add\",\"callFidChangeCallbacks\",\"callbacks\",\"callbacks_1\",\"__values\",\"callbacks_1_1\",\"next\",\"done\",\"value\",\"e_1_1\",\"e_1\",\"return\",\"call\",\"broadcastFidChange\",\"channel\",\"postMessage\",\"closeBroadcastChannel\",\"broadcastChannel\",\"self\",\"BroadcastChannel\",\"onmessage\",\"broadcastChannel.onmessage\",\"e\",\"data\",\"size\",\"close\",\"getDbPromise\",\"dbPromise\",\"idb\",\"openDb\",\"DATABASE_NAME\",\"DATABASE_VERSION\",\"upgradeDB\",\"oldVersion\",\"createObjectStore\",\"OBJECT_STORE_NAME\",\"db\",\"tx\",\"objectStore\",\"oldValue\",\"transaction\",\"put\",\"complete\",\"remove\",\"delete\",\"update\",\"updateFn\",\"store\",\"newValue\",\"undefined\",\"getInstallationEntry\",\"registrationPromise\",\"installationEntry\",\"oldEntry\",\"fidByteArray\",\"Uint8Array\",\"getRandomValues\",\"crypto\",\"msCrypto\",\"btoa\",\"b64\",\"String\",\"fromCharCode\",\"apply\",\"__spreadArray\",\"__read\",\"b64String\",\"substr\",\"VALID_FID_PATTERN\",\"test\",\"INVALID_FID\",\"clearTimedOutRequest\",\"entry\",\"navigator\",\"onLine\",\"inProgressEntry\",\"registrationTime\",\"registerInstallation\",\"registrationPromiseWithError\",\"reject\",\"waitUntilFidRegistration\",\"entryWithPromise\",\"trys\",\"push\",\"customData\",\"updateInstallationRequest\",\"PENDING_TIMEOUT_MS\",\"generateAuthTokenRequest\",\"platformLoggerProvider\",\"platformLogger\",\"completedAuthToken\",\"getGenerateAuthTokenEndpoint\",\"getImmediate\",\"optional\",\"getPlatformInfoString\",\"installation\",\"refreshAuthToken\",\"dependencies\",\"forceRefresh\",\"tokenPromise\",\"oldAuthToken\",\"TOKEN_EXPIRATION_BUFFER\",\"waitUntilAuthTokenRequest\",\"inProgressAuthToken\",\"requestTime\",\"__assign\",\"fetchAuthTokenFromServer\",\"updateAuthTokenRequest\",\"updatedInstallationEntry\",\"getId\",\"catch\",\"console\",\"getToken\",\"completeInstallationRegistration\",\"deleteInstallationRequest\",\"getDeleteEndpoint\",\"deleteInstallation\",\"onIdChange\",\"extractAppConfig\",\"app\",\"options\",\"getMissingValueError\",\"name\",\"configKeys\",\"configKeys_1\",\"configKeys_1_1\",\"keyName\",\"valueName\",\"registerInstallations\",\"instance\",\"INTERNAL\",\"registerComponent\",\"component\",\"Component\",\"installationsName\",\"container\",\"getProvider\",\"installations\",\"registerVersion\",\"version\",\"Object\",\"defineProperty\",\"firebase\",\"firebase__default\",\"ERROR_DESCRIPTION_MAP\",\"ErrorFactory\",\"SERVICE\",\"SERVICE_NAME\",\"Map\"]\n}\n"]