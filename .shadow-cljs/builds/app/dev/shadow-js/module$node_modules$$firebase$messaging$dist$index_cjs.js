["^ ","~:resource-id",["~:shadow.build.npm/resource","node_modules/@firebase/messaging/dist/index.cjs.js"],"~:js","shadow$provide.module$node_modules$$firebase$messaging$dist$index_cjs=function(global,require,module,exports){function arrayToBase64(array){array=new Uint8Array(array);return btoa(String.fromCharCode.apply(String,tslib.__spreadArray([],tslib.__read(array)))).replace(/=/g,\"\").replace(/\\+/g,\"-\").replace(/\\//g,\"_\")}function migrateOldDatabase(senderId){return tslib.__awaiter(this,void 0,void 0,function(){var databases,dbNames,tokenDetails,db$jscomp$0,_this=this;return tslib.__generator(this,function(_a$jscomp$0){switch(_a$jscomp$0.label){case 0:return\"databases\"in\nindexedDB?[4,indexedDB.databases()]:[3,2];case 1:databases=_a$jscomp$0.sent();dbNames=databases.map(function(db){return db.name});if(!dbNames.includes(\"fcm_token_details_db\"))return[2,null];_a$jscomp$0.label=2;case 2:return tokenDetails=null,[4,idb.openDb(\"fcm_token_details_db\",5,function(db){return tslib.__awaiter(_this,void 0,void 0,function(){var objectStore,value,oldDetails,_a;return tslib.__generator(this,function(_b){switch(_b.label){case 0:if(2>db.oldVersion||!db.objectStoreNames.contains(\"fcm_token_object_Store\"))return[2];\nobjectStore=db.transaction.objectStore(\"fcm_token_object_Store\");return[4,objectStore.index(\"fcmSenderId\").get(senderId)];case 1:return value=_b.sent(),[4,objectStore.clear()];case 2:_b.sent();if(!value)return[2];if(2===db.oldVersion){oldDetails=value;if(!oldDetails.auth||!oldDetails.p256dh||!oldDetails.endpoint)return[2];tokenDetails={token:oldDetails.fcmToken,createTime:null!==(_a=oldDetails.createTime)&&void 0!==_a?_a:Date.now(),subscriptionOptions:{auth:oldDetails.auth,p256dh:oldDetails.p256dh,\nendpoint:oldDetails.endpoint,swScope:oldDetails.swScope,vapidKey:\"string\"===typeof oldDetails.vapidKey?oldDetails.vapidKey:arrayToBase64(oldDetails.vapidKey)}}}else 3===db.oldVersion?(oldDetails=value,tokenDetails={token:oldDetails.fcmToken,createTime:oldDetails.createTime,subscriptionOptions:{auth:arrayToBase64(oldDetails.auth),p256dh:arrayToBase64(oldDetails.p256dh),endpoint:oldDetails.endpoint,swScope:oldDetails.swScope,vapidKey:arrayToBase64(oldDetails.vapidKey)}}):4===db.oldVersion&&(oldDetails=\nvalue,tokenDetails={token:oldDetails.fcmToken,createTime:oldDetails.createTime,subscriptionOptions:{auth:arrayToBase64(oldDetails.auth),p256dh:arrayToBase64(oldDetails.p256dh),endpoint:oldDetails.endpoint,swScope:oldDetails.swScope,vapidKey:arrayToBase64(oldDetails.vapidKey)}});return[2]}})})})];case 3:return db$jscomp$0=_a$jscomp$0.sent(),db$jscomp$0.close(),[4,idb.deleteDb(\"fcm_token_details_db\")];case 4:return _a$jscomp$0.sent(),[4,idb.deleteDb(\"fcm_vapid_details_db\")];case 5:return _a$jscomp$0.sent(),\n[4,idb.deleteDb(\"undefined\")];case 6:return _a$jscomp$0.sent(),[2,checkTokenDetails(tokenDetails)?tokenDetails:null]}})})}function checkTokenDetails(tokenDetails){if(!tokenDetails||!tokenDetails.subscriptionOptions)return!1;var subscriptionOptions=tokenDetails.subscriptionOptions;return\"number\"===typeof tokenDetails.createTime&&0<tokenDetails.createTime&&\"string\"===typeof tokenDetails.token&&0<tokenDetails.token.length&&\"string\"===typeof subscriptionOptions.auth&&0<subscriptionOptions.auth.length&&\n\"string\"===typeof subscriptionOptions.p256dh&&0<subscriptionOptions.p256dh.length&&\"string\"===typeof subscriptionOptions.endpoint&&0<subscriptionOptions.endpoint.length&&\"string\"===typeof subscriptionOptions.swScope&&0<subscriptionOptions.swScope.length&&\"string\"===typeof subscriptionOptions.vapidKey&&0<subscriptionOptions.vapidKey.length}function getDbPromise(){dbPromise||(dbPromise=idb.openDb(\"firebase-messaging-database\",1,function(upgradeDb){switch(upgradeDb.oldVersion){case 0:upgradeDb.createObjectStore(\"firebase-messaging-store\")}}));\nreturn dbPromise}function dbGet(firebaseDependencies){return tslib.__awaiter(this,void 0,void 0,function(){var key,db,tokenDetails,oldTokenDetails;return tslib.__generator(this,function(_a){switch(_a.label){case 0:return key=firebaseDependencies.appConfig.appId,[4,getDbPromise()];case 1:return db=_a.sent(),[4,db.transaction(\"firebase-messaging-store\").objectStore(\"firebase-messaging-store\").get(key)];case 2:return(tokenDetails=_a.sent())?[2,tokenDetails]:[3,3];case 3:return[4,migrateOldDatabase(firebaseDependencies.appConfig.senderId)];\ncase 4:return(oldTokenDetails=_a.sent())?[4,dbSet(firebaseDependencies,oldTokenDetails)]:[3,6];case 5:return _a.sent(),[2,oldTokenDetails];case 6:return[2]}})})}function dbSet(firebaseDependencies,tokenDetails){return tslib.__awaiter(this,void 0,void 0,function(){var key,db,tx;return tslib.__generator(this,function(_a){switch(_a.label){case 0:return key=firebaseDependencies.appConfig.appId,[4,getDbPromise()];case 1:return db=_a.sent(),tx=db.transaction(\"firebase-messaging-store\",\"readwrite\"),[4,tx.objectStore(\"firebase-messaging-store\").put(tokenDetails,\nkey)];case 2:return _a.sent(),[4,tx.complete];case 3:return _a.sent(),[2,tokenDetails]}})})}function dbRemove(firebaseDependencies){return tslib.__awaiter(this,void 0,void 0,function(){var key,db,tx;return tslib.__generator(this,function(_a){switch(_a.label){case 0:return key=firebaseDependencies.appConfig.appId,[4,getDbPromise()];case 1:return db=_a.sent(),tx=db.transaction(\"firebase-messaging-store\",\"readwrite\"),[4,tx.objectStore(\"firebase-messaging-store\").delete(key)];case 2:return _a.sent(),\n[4,tx.complete];case 3:return _a.sent(),[2]}})})}function requestGetToken(firebaseDependencies,subscriptionOptions){return tslib.__awaiter(this,void 0,void 0,function(){var headers,body,subscribeOptions,responseData,response,err_1,message;return tslib.__generator(this,function(_a){switch(_a.label){case 0:return[4,getHeaders(firebaseDependencies)];case 1:headers=_a.sent(),body=getBody(subscriptionOptions),subscribeOptions={method:\"POST\",headers,body:JSON.stringify(body)},_a.label=2;case 2:return _a.trys.push([2,\n5,,6]),[4,fetch(getEndpoint(firebaseDependencies.appConfig),subscribeOptions)];case 3:return response=_a.sent(),[4,response.json()];case 4:return responseData=_a.sent(),[3,6];case 5:throw err_1=_a.sent(),ERROR_FACTORY.create(\"token-subscribe-failed\",{errorInfo:err_1});case 6:if(responseData.error)throw message=responseData.error.message,ERROR_FACTORY.create(\"token-subscribe-failed\",{errorInfo:message});if(!responseData.token)throw ERROR_FACTORY.create(\"token-subscribe-no-token\");return[2,responseData.token]}})})}\nfunction requestUpdateToken(firebaseDependencies,tokenDetails){return tslib.__awaiter(this,void 0,void 0,function(){var headers,body,updateOptions,responseData,response,err_2,message;return tslib.__generator(this,function(_a){switch(_a.label){case 0:return[4,getHeaders(firebaseDependencies)];case 1:headers=_a.sent(),body=getBody(tokenDetails.subscriptionOptions),updateOptions={method:\"PATCH\",headers,body:JSON.stringify(body)},_a.label=2;case 2:return _a.trys.push([2,5,,6]),[4,fetch(getEndpoint(firebaseDependencies.appConfig)+\n\"/\"+tokenDetails.token,updateOptions)];case 3:return response=_a.sent(),[4,response.json()];case 4:return responseData=_a.sent(),[3,6];case 5:throw err_2=_a.sent(),ERROR_FACTORY.create(\"token-update-failed\",{errorInfo:err_2});case 6:if(responseData.error)throw message=responseData.error.message,ERROR_FACTORY.create(\"token-update-failed\",{errorInfo:message});if(!responseData.token)throw ERROR_FACTORY.create(\"token-update-no-token\");return[2,responseData.token]}})})}function requestDeleteToken(firebaseDependencies,\ntoken){return tslib.__awaiter(this,void 0,void 0,function(){var headers,unsubscribeOptions,response,responseData,message,err_3;return tslib.__generator(this,function(_a){switch(_a.label){case 0:return[4,getHeaders(firebaseDependencies)];case 1:headers=_a.sent(),unsubscribeOptions={method:\"DELETE\",headers},_a.label=2;case 2:return _a.trys.push([2,5,,6]),[4,fetch(getEndpoint(firebaseDependencies.appConfig)+\"/\"+token,unsubscribeOptions)];case 3:return response=_a.sent(),[4,response.json()];case 4:responseData=\n_a.sent();if(responseData.error)throw message=responseData.error.message,ERROR_FACTORY.create(\"token-unsubscribe-failed\",{errorInfo:message});return[3,6];case 5:throw err_3=_a.sent(),ERROR_FACTORY.create(\"token-unsubscribe-failed\",{errorInfo:err_3});case 6:return[2]}})})}function getEndpoint(_a){return\"https://fcmregistrations.googleapis.com/v1/projects/\"+_a.projectId+\"/registrations\"}function getHeaders(_a){var appConfig=_a.appConfig,installations=_a.installations;return tslib.__awaiter(this,void 0,\nvoid 0,function(){var authToken;return tslib.__generator(this,function(_b){switch(_b.label){case 0:return[4,installations.getToken()];case 1:return authToken=_b.sent(),[2,new Headers({\"Content-Type\":\"application/json\",Accept:\"application/json\",\"x-goog-api-key\":appConfig.apiKey,\"x-goog-firebase-installations-auth\":\"FIS \"+authToken})]}})})}function getBody(_a){var vapidKey=_a.vapidKey;_a={web:{endpoint:_a.endpoint,auth:_a.auth,p256dh:_a.p256dh}};\"BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4\"!==\nvapidKey&&(_a.web.applicationPubKey=vapidKey);return _a}function getToken(firebaseDependencies,swRegistration,vapidKey){return tslib.__awaiter(this,void 0,void 0,function(){var pushSubscription,tokenDetails,subscriptionOptions,e_1;return tslib.__generator(this,function(_a){switch(_a.label){case 0:if(\"granted\"!==Notification.permission)throw ERROR_FACTORY.create(\"permission-blocked\");return[4,getPushSubscription(swRegistration,vapidKey)];case 1:return pushSubscription=_a.sent(),[4,dbGet(firebaseDependencies)];\ncase 2:return tokenDetails=_a.sent(),subscriptionOptions={vapidKey,swScope:swRegistration.scope,endpoint:pushSubscription.endpoint,auth:arrayToBase64(pushSubscription.getKey(\"auth\")),p256dh:arrayToBase64(pushSubscription.getKey(\"p256dh\"))},tokenDetails?[3,3]:[2,getNewToken(firebaseDependencies,subscriptionOptions)];case 3:var dbOptions=tokenDetails.subscriptionOptions,isEndpointEqual=subscriptionOptions.endpoint===dbOptions.endpoint,isAuthEqual=subscriptionOptions.auth===dbOptions.auth,isP256dhEqual=\nsubscriptionOptions.p256dh===dbOptions.p256dh;if(subscriptionOptions.vapidKey===dbOptions.vapidKey&&isEndpointEqual&&isAuthEqual&&isP256dhEqual)return[3,8];_a.label=4;case 4:return _a.trys.push([4,6,,7]),[4,requestDeleteToken(firebaseDependencies,tokenDetails.token)];case 5:return _a.sent(),[3,7];case 6:return e_1=_a.sent(),console.warn(e_1),[3,7];case 7:return[2,getNewToken(firebaseDependencies,subscriptionOptions)];case 8:return Date.now()>=tokenDetails.createTime+6048E5?[2,updateToken({token:tokenDetails.token,\ncreateTime:Date.now(),subscriptionOptions},firebaseDependencies,swRegistration)]:[2,tokenDetails.token];case 9:return[2]}})})}function deleteToken(firebaseDependencies,swRegistration){return tslib.__awaiter(this,void 0,void 0,function(){var tokenDetails,pushSubscription;return tslib.__generator(this,function(_a){switch(_a.label){case 0:return[4,dbGet(firebaseDependencies)];case 1:return(tokenDetails=_a.sent())?[4,requestDeleteToken(firebaseDependencies,tokenDetails.token)]:[3,4];case 2:return _a.sent(),\n[4,dbRemove(firebaseDependencies)];case 3:_a.sent(),_a.label=4;case 4:return[4,swRegistration.pushManager.getSubscription()];case 5:return(pushSubscription=_a.sent())?[2,pushSubscription.unsubscribe()]:[2,!0]}})})}function updateToken(tokenDetails,firebaseDependencies,swRegistration){return tslib.__awaiter(this,void 0,void 0,function(){var updatedToken,updatedTokenDetails,e_2;return tslib.__generator(this,function(_a){switch(_a.label){case 0:return _a.trys.push([0,3,,5]),[4,requestUpdateToken(firebaseDependencies,\ntokenDetails)];case 1:return updatedToken=_a.sent(),updatedTokenDetails=tslib.__assign(tslib.__assign({},tokenDetails),{token:updatedToken,createTime:Date.now()}),[4,dbSet(firebaseDependencies,updatedTokenDetails)];case 2:return _a.sent(),[2,updatedToken];case 3:return e_2=_a.sent(),[4,deleteToken(firebaseDependencies,swRegistration)];case 4:throw _a.sent(),e_2;case 5:return[2]}})})}function getNewToken(firebaseDependencies,subscriptionOptions){return tslib.__awaiter(this,void 0,void 0,function(){var token,\ntokenDetails;return tslib.__generator(this,function(_a){switch(_a.label){case 0:return[4,requestGetToken(firebaseDependencies,subscriptionOptions)];case 1:return token=_a.sent(),tokenDetails={token,createTime:Date.now(),subscriptionOptions},[4,dbSet(firebaseDependencies,tokenDetails)];case 2:return _a.sent(),[2,tokenDetails.token]}})})}function getPushSubscription(swRegistration,vapidKey){return tslib.__awaiter(this,void 0,void 0,function(){var subscription;return tslib.__generator(this,function(_a){switch(_a.label){case 0:return[4,\nswRegistration.pushManager.getSubscription()];case 1:if(subscription=_a.sent())return[2,subscription];_a=swRegistration.pushManager;var JSCompiler_temp_const=_a.subscribe,padding=\"\\x3d\".repeat((4-vapidKey.length%4)%4);padding=(vapidKey+padding).replace(/\\-/g,\"+\").replace(/_/g,\"/\");padding=atob(padding);for(var outputArray=new Uint8Array(padding.length),i=0;i<padding.length;++i)outputArray[i]=padding.charCodeAt(i);return[2,JSCompiler_temp_const.call(_a,{userVisibleOnly:!0,applicationServerKey:outputArray})]}})})}\nfunction isConsoleMessage(data){return\"object\"===typeof data&&!!data&&\"google.c.a.c_id\"in data}function sleep(ms){return new Promise(function(resolve){setTimeout(resolve,ms)})}function getWindowClient(url){return tslib.__awaiter(this,void 0,void 0,function(){var clientList,clientList_1,clientList_1_1,client,clientUrl,e_1,_a;return tslib.__generator(this,function(_b){switch(_b.label){case 0:return[4,getClientList()];case 1:clientList=_b.sent();try{for(clientList_1=tslib.__values(clientList),clientList_1_1=\nclientList_1.next();!clientList_1_1.done;clientList_1_1=clientList_1.next())if(client=clientList_1_1.value,clientUrl=new URL(client.url,self.location.href),url.host===clientUrl.host)return[2,client]}catch(e_1_1){e_1={error:e_1_1}}finally{try{clientList_1_1&&!clientList_1_1.done&&(_a=clientList_1.return)&&_a.call(clientList_1)}finally{if(e_1)throw e_1.error;}}return[2,null]}})})}function hasVisibleClients(clientList){return clientList.some(function(client){return\"visible\"===client.visibilityState&&\n!client.url.startsWith(\"chrome-extension://\")})}function getClientList(){return self.clients.matchAll({type:\"window\",includeUncontrolled:!0})}function getMissingValueError(valueName){return ERROR_FACTORY.create(\"missing-app-config-values\",{valueName})}function isSupported(){return self&&\"ServiceWorkerGlobalScope\"in self?\"indexedDB\"in self&&null!==indexedDB&&\"PushManager\"in self&&\"Notification\"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty(\"showNotification\")&&PushSubscription.prototype.hasOwnProperty(\"getKey\"):\n\"indexedDB\"in window&&null!==indexedDB&&navigator.cookieEnabled&&\"serviceWorker\"in navigator&&\"PushManager\"in window&&\"Notification\"in window&&\"fetch\"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty(\"showNotification\")&&PushSubscription.prototype.hasOwnProperty(\"getKey\")}require(\"module$node_modules$$firebase$installations$dist$index_cjs\");global=require(\"module$node_modules$$firebase$component$dist$index_esm\");module=require(\"module$node_modules$$firebase$util$dist$index_esm\");var tslib=\nrequire(\"module$node_modules$tslib$tslib\"),idb=require(\"module$node_modules$idb$build$idb\");require=(require=require(\"module$node_modules$$firebase$app$dist$index_esm\"))&&\"object\"===typeof require&&\"default\"in require?require:{\"default\":require};var _a$jscomp$1;exports=(_a$jscomp$1={},_a$jscomp$1[\"missing-app-config-values\"]='Missing App configuration value: \"{$valueName}\"',_a$jscomp$1[\"only-available-in-window\"]=\"This method is available in a Window context.\",_a$jscomp$1[\"only-available-in-sw\"]=\n\"This method is available in a service worker context.\",_a$jscomp$1[\"permission-default\"]=\"The notification permission was not granted and dismissed instead.\",_a$jscomp$1[\"permission-blocked\"]=\"The notification permission was not granted and blocked instead.\",_a$jscomp$1[\"unsupported-browser\"]=\"This browser doesn't support the API's required to use the firebase SDK.\",_a$jscomp$1[\"failed-service-worker-registration\"]=\"We are unable to register the default service worker. {$browserErrorMessage}\",_a$jscomp$1[\"token-subscribe-failed\"]=\n\"A problem occurred while subscribing the user to FCM: {$errorInfo}\",_a$jscomp$1[\"token-subscribe-no-token\"]=\"FCM returned no token when subscribing the user to push.\",_a$jscomp$1[\"token-unsubscribe-failed\"]=\"A problem occurred while unsubscribing the user from FCM: {$errorInfo}\",_a$jscomp$1[\"token-update-failed\"]=\"A problem occurred while updating the user from FCM: {$errorInfo}\",_a$jscomp$1[\"token-update-no-token\"]=\"FCM returned no token when updating the user to push.\",_a$jscomp$1[\"use-sw-after-get-token\"]=\n\"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.\",_a$jscomp$1[\"invalid-sw-registration\"]=\"The input to useServiceWorker() must be a ServiceWorkerRegistration.\",_a$jscomp$1[\"invalid-bg-handler\"]=\"The input to setBackgroundMessageHandler() must be a function.\",_a$jscomp$1[\"invalid-vapid-key\"]=\"The public VAPID key must be a string.\",_a$jscomp$1[\"use-vapid-key-after-get-token\"]=\"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used.\",\n_a$jscomp$1);var ERROR_FACTORY=new module.ErrorFactory(\"messaging\",\"Messaging\",exports),MessageType;(function(MessageType){MessageType.PUSH_RECEIVED=\"push-received\";MessageType.NOTIFICATION_CLICKED=\"notification-clicked\"})(MessageType||(MessageType={}));var dbPromise=null,SwController=function(){function SwController(firebaseDependencies){var _this=this;this.firebaseDependencies=firebaseDependencies;this.bgMessageHandler=this.vapidKey=this.isOnBackgroundMessageUsed=null;self.addEventListener(\"push\",\nfunction(e){e.waitUntil(_this.onPush(e))});self.addEventListener(\"pushsubscriptionchange\",function(e){e.waitUntil(_this.onSubChange(e))});self.addEventListener(\"notificationclick\",function(e){e.waitUntil(_this.onNotificationClick(e))})}Object.defineProperty(SwController.prototype,\"app\",{get:function(){return this.firebaseDependencies.app},enumerable:!1,configurable:!0});SwController.prototype.setBackgroundMessageHandler=function(callback){this.isOnBackgroundMessageUsed=!1;if(!callback||\"function\"!==\ntypeof callback)throw ERROR_FACTORY.create(\"invalid-bg-handler\");this.bgMessageHandler=callback};SwController.prototype.onBackgroundMessage=function(nextOrObserver){var _this=this;this.isOnBackgroundMessageUsed=!0;this.bgMessageHandler=nextOrObserver;return function(){_this.bgMessageHandler=null}};SwController.prototype.getToken=function(){var _a,_b;return tslib.__awaiter(this,void 0,void 0,function(){var tokenDetails;return tslib.__generator(this,function(_c){switch(_c.label){case 0:return this.vapidKey?\n[3,2]:[4,dbGet(this.firebaseDependencies)];case 1:tokenDetails=_c.sent(),this.vapidKey=null!==(_b=null===(_a=null===tokenDetails||void 0===tokenDetails?void 0:tokenDetails.subscriptionOptions)||void 0===_a?void 0:_a.vapidKey)&&void 0!==_b?_b:\"BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4\",_c.label=2;case 2:return[2,getToken(this.firebaseDependencies,self.registration,this.vapidKey)]}})})};SwController.prototype.deleteToken=function(){return deleteToken(this.firebaseDependencies,\nself.registration)};SwController.prototype.requestPermission=function(){throw ERROR_FACTORY.create(\"only-available-in-window\");};SwController.prototype.usePublicVapidKey=function(vapidKey){if(null!==this.vapidKey)throw ERROR_FACTORY.create(\"use-vapid-key-after-get-token\");if(\"string\"!==typeof vapidKey||0===vapidKey.length)throw ERROR_FACTORY.create(\"invalid-vapid-key\");this.vapidKey=vapidKey};SwController.prototype.useServiceWorker=function(){throw ERROR_FACTORY.create(\"only-available-in-window\");\n};SwController.prototype.onMessage=function(){throw ERROR_FACTORY.create(\"only-available-in-window\");};SwController.prototype.onTokenRefresh=function(){throw ERROR_FACTORY.create(\"only-available-in-window\");};SwController.prototype.onPush=function(event){return tslib.__awaiter(this,void 0,void 0,function(){var internalPayload$jscomp$0,clientList,isNotificationShown,payload;return tslib.__generator(this,function(_a$jscomp$0){switch(_a$jscomp$0.label){case 0:var data=event.data;if(data)try{internalPayload$jscomp$0=\ndata.json()}catch(err){internalPayload$jscomp$0=null}else internalPayload$jscomp$0=null;return internalPayload$jscomp$0?[4,getClientList()]:(console.debug(\"FirebaseMessaging: failed to get parsed MessagePayload from the PushEvent. Skip handling the push.\"),[2]);case 1:clientList=_a$jscomp$0.sent();if(hasVisibleClients(clientList)){data=clientList;var internalPayload=internalPayload$jscomp$0,_a;internalPayload.isFirebaseMessaging=!0;internalPayload.messageType=MessageType.PUSH_RECEIVED;try{for(var clientList_2=\ntslib.__values(data),clientList_2_1=clientList_2.next();!clientList_2_1.done;clientList_2_1=clientList_2.next())clientList_2_1.value.postMessage(internalPayload)}catch(e_2_1){var e_2={error:e_2_1}}finally{try{clientList_2_1&&!clientList_2_1.done&&(_a=clientList_2.return)&&_a.call(clientList_2)}finally{if(e_2)throw e_2.error;}}return[2,void 0]}isNotificationShown=!1;if(!internalPayload$jscomp$0.notification)return[3,3];_a=internalPayload$jscomp$0;e_2=tslib.__assign({},_a.notification);e_2.data=(internalPayload=\n{},internalPayload.FCM_MSG=_a,internalPayload);_a=e_2.actions;clientList_2=Notification.maxActions;_a&&clientList_2&&_a.length>clientList_2&&console.warn(\"This browser only supports \"+clientList_2+\" actions. The remaining actions will not be displayed.\");return[4,self.registration.showNotification(null!==(data=e_2.title)&&void 0!==data?data:\"\",e_2)];case 2:_a$jscomp$0.sent(),isNotificationShown=!0,_a$jscomp$0.label=3;case 3:if(!0===isNotificationShown&&!1===this.isOnBackgroundMessageUsed)return[2];\nif(this.bgMessageHandler){e_2=internalPayload$jscomp$0;data={from:e_2.from,collapseKey:e_2.collapse_key};if(e_2.notification){data.notification={};if(_a=e_2.notification.title)data.notification.title=_a;if(_a=e_2.notification.body)data.notification.body=_a;if(_a=e_2.notification.image)data.notification.image=_a}e_2.data&&(data.data=e_2.data);if(e_2.fcmOptions){data.fcmOptions={};if(_a=e_2.fcmOptions.link)data.fcmOptions.link=_a;if(e_2=e_2.fcmOptions.analytics_label)data.fcmOptions.analyticsLabel=\ne_2}payload=data;\"function\"===typeof this.bgMessageHandler?this.bgMessageHandler(payload):this.bgMessageHandler.next(payload)}return[4,sleep(1E3)];case 4:return _a$jscomp$0.sent(),[2]}})})};SwController.prototype.onSubChange=function(event){var _a,_b;return tslib.__awaiter(this,void 0,void 0,function(){var newSubscription,tokenDetails;return tslib.__generator(this,function(_c){switch(_c.label){case 0:return(newSubscription=event.newSubscription)?[3,2]:[4,deleteToken(this.firebaseDependencies,self.registration)];\ncase 1:return _c.sent(),[2];case 2:return[4,dbGet(this.firebaseDependencies)];case 3:return tokenDetails=_c.sent(),[4,deleteToken(this.firebaseDependencies,self.registration)];case 4:return _c.sent(),[4,getToken(this.firebaseDependencies,self.registration,null!==(_b=null===(_a=null===tokenDetails||void 0===tokenDetails?void 0:tokenDetails.subscriptionOptions)||void 0===_a?void 0:_a.vapidKey)&&void 0!==_b?_b:\"BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4\")];\ncase 5:return _c.sent(),[2]}})})};SwController.prototype.onNotificationClick=function(event){var _a$jscomp$0,_b$jscomp$0;return tslib.__awaiter(this,void 0,void 0,function(){var internalPayload,link,url,originUrl,client;return tslib.__generator(this,function(_c$jscomp$0){switch(_c$jscomp$0.label){case 0:internalPayload=null===(_b$jscomp$0=null===(_a$jscomp$0=event.notification)||void 0===_a$jscomp$0?void 0:_a$jscomp$0.data)||void 0===_b$jscomp$0?void 0:_b$jscomp$0.FCM_MSG;if(!internalPayload||event.action)return[2];\nevent.stopImmediatePropagation();event.notification.close();var _a,_b,_c;link=(_c$jscomp$0=null!==(_b=null===(_a=internalPayload.fcmOptions)||void 0===_a?void 0:_a.link)&&void 0!==_b?_b:null===(_c=internalPayload.notification)||void 0===_c?void 0:_c.click_action)?_c$jscomp$0:isConsoleMessage(internalPayload.data)?self.location.origin:null;if(!link)return[2];url=new URL(link,self.location.href);originUrl=new URL(self.location.origin);return url.host!==originUrl.host?[2]:[4,getWindowClient(url)];case 1:return(client=\n_c$jscomp$0.sent())?[3,4]:[4,self.clients.openWindow(link)];case 2:return client=_c$jscomp$0.sent(),[4,sleep(3E3)];case 3:return _c$jscomp$0.sent(),[3,6];case 4:return[4,client.focus()];case 5:client=_c$jscomp$0.sent(),_c$jscomp$0.label=6;case 6:if(!client)return[2];internalPayload.messageType=MessageType.NOTIFICATION_CLICKED;internalPayload.isFirebaseMessaging=!0;return[2,client.postMessage(internalPayload)]}})})};return SwController}(),WindowController=function(){function WindowController(firebaseDependencies){var _this=\nthis;this.firebaseDependencies=firebaseDependencies;this.onMessageCallback=this.vapidKey=null;navigator.serviceWorker.addEventListener(\"message\",function(e){return _this.messageEventListener(e)})}Object.defineProperty(WindowController.prototype,\"app\",{get:function(){return this.firebaseDependencies.app},enumerable:!1,configurable:!0});WindowController.prototype.messageEventListener=function(event){return tslib.__awaiter(this,void 0,void 0,function(){var internalPayload$jscomp$0,dataPayload;return tslib.__generator(this,\nfunction(_a){switch(_a.label){case 0:internalPayload$jscomp$0=event.data;if(!internalPayload$jscomp$0.isFirebaseMessaging)return[2];if(this.onMessageCallback&&internalPayload$jscomp$0.messageType===MessageType.PUSH_RECEIVED)if(\"function\"===typeof this.onMessageCallback){_a=this.onMessageCallback;var internalPayload=Object.assign({},internalPayload$jscomp$0);delete internalPayload.messageType;delete internalPayload.isFirebaseMessaging;_a.call(this,internalPayload)}else this.onMessageCallback.next(Object.assign({},\ninternalPayload$jscomp$0));dataPayload=internalPayload$jscomp$0.data;return isConsoleMessage(dataPayload)&&\"1\"===dataPayload[\"google.c.a.e\"]?[4,this.logEvent(internalPayload$jscomp$0.messageType,dataPayload)]:[3,2];case 1:_a.sent(),_a.label=2;case 2:return[2]}})})};WindowController.prototype.getVapidKey=function(){return this.vapidKey};WindowController.prototype.getSwReg=function(){return this.swRegistration};WindowController.prototype.getToken=function(options){return tslib.__awaiter(this,void 0,\nvoid 0,function(){return tslib.__generator(this,function(_a){switch(_a.label){case 0:return\"default\"!==Notification.permission?[3,2]:[4,Notification.requestPermission()];case 1:_a.sent(),_a.label=2;case 2:if(\"granted\"!==Notification.permission)throw ERROR_FACTORY.create(\"permission-blocked\");return[4,this.updateVapidKey(null===options||void 0===options?void 0:options.vapidKey)];case 3:return _a.sent(),[4,this.updateSwReg(null===options||void 0===options?void 0:options.serviceWorkerRegistration)];\ncase 4:return _a.sent(),[2,getToken(this.firebaseDependencies,this.swRegistration,this.vapidKey)]}})})};WindowController.prototype.updateVapidKey=function(vapidKey){return tslib.__awaiter(this,void 0,void 0,function(){return tslib.__generator(this,function(_a){vapidKey?this.vapidKey=vapidKey:this.vapidKey||(this.vapidKey=\"BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4\");return[2]})})};WindowController.prototype.updateSwReg=function(swRegistration){return tslib.__awaiter(this,\nvoid 0,void 0,function(){return tslib.__generator(this,function(_a){switch(_a.label){case 0:return swRegistration||this.swRegistration?[3,2]:[4,this.registerDefaultSw()];case 1:_a.sent(),_a.label=2;case 2:if(!swRegistration&&this.swRegistration)return[2];if(!(swRegistration instanceof ServiceWorkerRegistration))throw ERROR_FACTORY.create(\"invalid-sw-registration\");this.swRegistration=swRegistration;return[2]}})})};WindowController.prototype.registerDefaultSw=function(){return tslib.__awaiter(this,\nvoid 0,void 0,function(){var _a,e_1;return tslib.__generator(this,function(_b){switch(_b.label){case 0:return _b.trys.push([0,2,,3]),_a=this,[4,navigator.serviceWorker.register(\"/firebase-messaging-sw.js\",{scope:\"/firebase-cloud-messaging-push-scope\"})];case 1:return _a.swRegistration=_b.sent(),this.swRegistration.update().catch(function(){}),[3,3];case 2:throw e_1=_b.sent(),ERROR_FACTORY.create(\"failed-service-worker-registration\",{browserErrorMessage:e_1.message});case 3:return[2]}})})};WindowController.prototype.deleteToken=\nfunction(){return tslib.__awaiter(this,void 0,void 0,function(){return tslib.__generator(this,function(_a){switch(_a.label){case 0:return this.swRegistration?[3,2]:[4,this.registerDefaultSw()];case 1:_a.sent(),_a.label=2;case 2:return[2,deleteToken(this.firebaseDependencies,this.swRegistration)]}})})};WindowController.prototype.requestPermission=function(){return tslib.__awaiter(this,void 0,void 0,function(){var permissionResult;return tslib.__generator(this,function(_a){switch(_a.label){case 0:return\"granted\"===\nNotification.permission?[2]:[4,Notification.requestPermission()];case 1:permissionResult=_a.sent();if(\"granted\"===permissionResult)return[2];if(\"denied\"===permissionResult)throw ERROR_FACTORY.create(\"permission-blocked\");throw ERROR_FACTORY.create(\"permission-default\");}})})};WindowController.prototype.usePublicVapidKey=function(vapidKey){if(null!==this.vapidKey)throw ERROR_FACTORY.create(\"use-vapid-key-after-get-token\");if(\"string\"!==typeof vapidKey||0===vapidKey.length)throw ERROR_FACTORY.create(\"invalid-vapid-key\");\nthis.vapidKey=vapidKey};WindowController.prototype.useServiceWorker=function(swRegistration){if(!(swRegistration instanceof ServiceWorkerRegistration))throw ERROR_FACTORY.create(\"invalid-sw-registration\");if(this.swRegistration)throw ERROR_FACTORY.create(\"use-sw-after-get-token\");this.swRegistration=swRegistration};WindowController.prototype.onMessage=function(nextOrObserver){var _this=this;this.onMessageCallback=nextOrObserver;return function(){_this.onMessageCallback=null}};WindowController.prototype.setBackgroundMessageHandler=\nfunction(){throw ERROR_FACTORY.create(\"only-available-in-sw\");};WindowController.prototype.onBackgroundMessage=function(){throw ERROR_FACTORY.create(\"only-available-in-sw\");};WindowController.prototype.onTokenRefresh=function(){return function(){}};WindowController.prototype.logEvent=function(messageType,data){return tslib.__awaiter(this,void 0,void 0,function(){var eventType,analytics;return tslib.__generator(this,function(_a){switch(_a.label){case 0:a:switch(messageType){case MessageType.NOTIFICATION_CLICKED:eventType=\n\"notification_open\";break a;case MessageType.PUSH_RECEIVED:eventType=\"notification_foreground\";break a;default:throw Error();}return[4,this.firebaseDependencies.analyticsProvider.get()];case 1:return analytics=_a.sent(),analytics.logEvent(eventType,{message_id:data[\"google.c.a.c_id\"],message_name:data[\"google.c.a.c_l\"],message_time:data[\"google.c.a.ts\"],message_device_time:Math.floor(Date.now()/1E3)}),[2]}})})};return WindowController}();_a$jscomp$1={isSupported};require[\"default\"].INTERNAL.registerComponent((new global.Component(\"messaging\",\nfunction(container){var app=container.getProvider(\"app\").getImmediate(),_a;if(!app||!app.options)throw getMissingValueError(\"App Configuration Object\");if(!app.name)throw getMissingValueError(\"App Name\");var configKeys=[\"projectId\",\"apiKey\",\"appId\",\"messagingSenderId\"],options=app.options;try{for(var configKeys_1=tslib.__values(configKeys),configKeys_1_1=configKeys_1.next();!configKeys_1_1.done;configKeys_1_1=configKeys_1.next()){var keyName=configKeys_1_1.value;if(!options[keyName])throw getMissingValueError(keyName);\n}}catch(e_1_1){var appConfig={error:e_1_1}}finally{try{configKeys_1_1&&!configKeys_1_1.done&&(_a=configKeys_1.return)&&_a.call(configKeys_1)}finally{if(appConfig)throw appConfig.error;}}appConfig={appName:app.name,projectId:options.projectId,apiKey:options.apiKey,appId:options.appId,senderId:options.messagingSenderId};_a=container.getProvider(\"installations\").getImmediate();container=container.getProvider(\"analytics-internal\");app={app,appConfig,installations:_a,analyticsProvider:container};if(!isSupported())throw ERROR_FACTORY.create(\"unsupported-browser\");\nreturn self&&\"ServiceWorkerGlobalScope\"in self?new SwController(app):new WindowController(app)},\"PUBLIC\")).setServiceProps(_a$jscomp$1))}","~:source","shadow$provide[\"module$node_modules$$firebase$messaging$dist$index_cjs\"] = function(global,require,module,exports) {\n'use strict';\n\nrequire('@firebase/installations');\nvar component = require('@firebase/component');\nvar util = require('@firebase/util');\nvar tslib = require('tslib');\nvar idb = require('idb');\nvar firebase = require('@firebase/app');\n\nfunction _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }\n\nvar firebase__default = /*#__PURE__*/_interopDefaultLegacy(firebase);\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar _a;\r\nvar ERROR_MAP = (_a = {},\r\n    _a[\"missing-app-config-values\" /* MISSING_APP_CONFIG_VALUES */] = 'Missing App configuration value: \"{$valueName}\"',\r\n    _a[\"only-available-in-window\" /* AVAILABLE_IN_WINDOW */] = 'This method is available in a Window context.',\r\n    _a[\"only-available-in-sw\" /* AVAILABLE_IN_SW */] = 'This method is available in a service worker context.',\r\n    _a[\"permission-default\" /* PERMISSION_DEFAULT */] = 'The notification permission was not granted and dismissed instead.',\r\n    _a[\"permission-blocked\" /* PERMISSION_BLOCKED */] = 'The notification permission was not granted and blocked instead.',\r\n    _a[\"unsupported-browser\" /* UNSUPPORTED_BROWSER */] = \"This browser doesn't support the API's required to use the firebase SDK.\",\r\n    _a[\"failed-service-worker-registration\" /* FAILED_DEFAULT_REGISTRATION */] = 'We are unable to register the default service worker. {$browserErrorMessage}',\r\n    _a[\"token-subscribe-failed\" /* TOKEN_SUBSCRIBE_FAILED */] = 'A problem occurred while subscribing the user to FCM: {$errorInfo}',\r\n    _a[\"token-subscribe-no-token\" /* TOKEN_SUBSCRIBE_NO_TOKEN */] = 'FCM returned no token when subscribing the user to push.',\r\n    _a[\"token-unsubscribe-failed\" /* TOKEN_UNSUBSCRIBE_FAILED */] = 'A problem occurred while unsubscribing the ' +\r\n        'user from FCM: {$errorInfo}',\r\n    _a[\"token-update-failed\" /* TOKEN_UPDATE_FAILED */] = 'A problem occurred while updating the user from FCM: {$errorInfo}',\r\n    _a[\"token-update-no-token\" /* TOKEN_UPDATE_NO_TOKEN */] = 'FCM returned no token when updating the user to push.',\r\n    _a[\"use-sw-after-get-token\" /* USE_SW_AFTER_GET_TOKEN */] = 'The useServiceWorker() method may only be called once and must be ' +\r\n        'called before calling getToken() to ensure your service worker is used.',\r\n    _a[\"invalid-sw-registration\" /* INVALID_SW_REGISTRATION */] = 'The input to useServiceWorker() must be a ServiceWorkerRegistration.',\r\n    _a[\"invalid-bg-handler\" /* INVALID_BG_HANDLER */] = 'The input to setBackgroundMessageHandler() must be a function.',\r\n    _a[\"invalid-vapid-key\" /* INVALID_VAPID_KEY */] = 'The public VAPID key must be a string.',\r\n    _a[\"use-vapid-key-after-get-token\" /* USE_VAPID_KEY_AFTER_GET_TOKEN */] = 'The usePublicVapidKey() method may only be called once and must be ' +\r\n        'called before calling getToken() to ensure your VAPID key is used.',\r\n    _a);\r\nvar ERROR_FACTORY = new util.ErrorFactory('messaging', 'Messaging', ERROR_MAP);\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar DEFAULT_SW_PATH = '/firebase-messaging-sw.js';\r\nvar DEFAULT_SW_SCOPE = '/firebase-cloud-messaging-push-scope';\r\nvar DEFAULT_VAPID_KEY = 'BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4';\r\nvar ENDPOINT = 'https://fcmregistrations.googleapis.com/v1';\r\n// Key of FCM Payload in Notification's data field.\r\nvar FCM_MSG = 'FCM_MSG';\r\nvar TAG = 'FirebaseMessaging: ';\r\n// Set to '1' if Analytics is enabled for the campaign\r\nvar CONSOLE_CAMPAIGN_ANALYTICS_ENABLED = 'google.c.a.e';\r\nvar CONSOLE_CAMPAIGN_ID = 'google.c.a.c_id';\r\nvar CONSOLE_CAMPAIGN_TIME = 'google.c.a.ts';\r\nvar CONSOLE_CAMPAIGN_NAME = 'google.c.a.c_l';\r\n// Due to the fact that onBackgroundMessage can't be awaited (to support rxjs), a silent push\r\n// warning might be shown by the browser if the callback fails to completes by the end of onPush.\r\n// Experiments were ran to determine the majority onBackground message clock time. This brief\r\n// blocking time would allow majority of the onBackgroundMessage callback to finish.\r\nvar BACKGROUND_HANDLE_EXECUTION_TIME_LIMIT_MS = 1000;\r\n// Preparation time for client to initialize and set up the message handler.\r\nvar FOREGROUND_HANDLE_PREPARATION_TIME_MS = 3000;\n\n/**\r\n * @license\r\n * Copyright 2018 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except\r\n * in compliance with the License. You may obtain a copy of the License at\r\n *\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software distributed under the License\r\n * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\r\n * or implied. See the License for the specific language governing permissions and limitations under\r\n * the License.\r\n */\r\nvar MessageType;\r\n(function (MessageType) {\r\n    MessageType[\"PUSH_RECEIVED\"] = \"push-received\";\r\n    MessageType[\"NOTIFICATION_CLICKED\"] = \"notification-clicked\";\r\n})(MessageType || (MessageType = {}));\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction arrayToBase64(array) {\r\n    var uint8Array = new Uint8Array(array);\r\n    var base64String = btoa(String.fromCharCode.apply(String, tslib.__spreadArray([], tslib.__read(uint8Array))));\r\n    return base64String.replace(/=/g, '').replace(/\\+/g, '-').replace(/\\//g, '_');\r\n}\r\nfunction base64ToArray(base64String) {\r\n    var padding = '='.repeat((4 - (base64String.length % 4)) % 4);\r\n    var base64 = (base64String + padding)\r\n        .replace(/\\-/g, '+')\r\n        .replace(/_/g, '/');\r\n    var rawData = atob(base64);\r\n    var outputArray = new Uint8Array(rawData.length);\r\n    for (var i = 0; i < rawData.length; ++i) {\r\n        outputArray[i] = rawData.charCodeAt(i);\r\n    }\r\n    return outputArray;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar OLD_DB_NAME = 'fcm_token_details_db';\r\n/**\r\n * The last DB version of 'fcm_token_details_db' was 4. This is one higher, so that the upgrade\r\n * callback is called for all versions of the old DB.\r\n */\r\nvar OLD_DB_VERSION = 5;\r\nvar OLD_OBJECT_STORE_NAME = 'fcm_token_object_Store';\r\nfunction migrateOldDatabase(senderId) {\r\n    return tslib.__awaiter(this, void 0, void 0, function () {\r\n        var databases, dbNames, tokenDetails, db;\r\n        var _this = this;\r\n        return tslib.__generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    if (!('databases' in indexedDB)) return [3 /*break*/, 2];\r\n                    return [4 /*yield*/, indexedDB.databases()];\r\n                case 1:\r\n                    databases = _a.sent();\r\n                    dbNames = databases.map(function (db) { return db.name; });\r\n                    if (!dbNames.includes(OLD_DB_NAME)) {\r\n                        // old DB didn't exist, no need to open.\r\n                        return [2 /*return*/, null];\r\n                    }\r\n                    _a.label = 2;\r\n                case 2:\r\n                    tokenDetails = null;\r\n                    return [4 /*yield*/, idb.openDb(OLD_DB_NAME, OLD_DB_VERSION, function (db) { return tslib.__awaiter(_this, void 0, void 0, function () {\r\n                            var objectStore, value, oldDetails, oldDetails, oldDetails;\r\n                            var _a;\r\n                            return tslib.__generator(this, function (_b) {\r\n                                switch (_b.label) {\r\n                                    case 0:\r\n                                        if (db.oldVersion < 2) {\r\n                                            // Database too old, skip migration.\r\n                                            return [2 /*return*/];\r\n                                        }\r\n                                        if (!db.objectStoreNames.contains(OLD_OBJECT_STORE_NAME)) {\r\n                                            // Database did not exist. Nothing to do.\r\n                                            return [2 /*return*/];\r\n                                        }\r\n                                        objectStore = db.transaction.objectStore(OLD_OBJECT_STORE_NAME);\r\n                                        return [4 /*yield*/, objectStore.index('fcmSenderId').get(senderId)];\r\n                                    case 1:\r\n                                        value = _b.sent();\r\n                                        return [4 /*yield*/, objectStore.clear()];\r\n                                    case 2:\r\n                                        _b.sent();\r\n                                        if (!value) {\r\n                                            // No entry in the database, nothing to migrate.\r\n                                            return [2 /*return*/];\r\n                                        }\r\n                                        if (db.oldVersion === 2) {\r\n                                            oldDetails = value;\r\n                                            if (!oldDetails.auth || !oldDetails.p256dh || !oldDetails.endpoint) {\r\n                                                return [2 /*return*/];\r\n                                            }\r\n                                            tokenDetails = {\r\n                                                token: oldDetails.fcmToken,\r\n                                                createTime: (_a = oldDetails.createTime) !== null && _a !== void 0 ? _a : Date.now(),\r\n                                                subscriptionOptions: {\r\n                                                    auth: oldDetails.auth,\r\n                                                    p256dh: oldDetails.p256dh,\r\n                                                    endpoint: oldDetails.endpoint,\r\n                                                    swScope: oldDetails.swScope,\r\n                                                    vapidKey: typeof oldDetails.vapidKey === 'string'\r\n                                                        ? oldDetails.vapidKey\r\n                                                        : arrayToBase64(oldDetails.vapidKey)\r\n                                                }\r\n                                            };\r\n                                        }\r\n                                        else if (db.oldVersion === 3) {\r\n                                            oldDetails = value;\r\n                                            tokenDetails = {\r\n                                                token: oldDetails.fcmToken,\r\n                                                createTime: oldDetails.createTime,\r\n                                                subscriptionOptions: {\r\n                                                    auth: arrayToBase64(oldDetails.auth),\r\n                                                    p256dh: arrayToBase64(oldDetails.p256dh),\r\n                                                    endpoint: oldDetails.endpoint,\r\n                                                    swScope: oldDetails.swScope,\r\n                                                    vapidKey: arrayToBase64(oldDetails.vapidKey)\r\n                                                }\r\n                                            };\r\n                                        }\r\n                                        else if (db.oldVersion === 4) {\r\n                                            oldDetails = value;\r\n                                            tokenDetails = {\r\n                                                token: oldDetails.fcmToken,\r\n                                                createTime: oldDetails.createTime,\r\n                                                subscriptionOptions: {\r\n                                                    auth: arrayToBase64(oldDetails.auth),\r\n                                                    p256dh: arrayToBase64(oldDetails.p256dh),\r\n                                                    endpoint: oldDetails.endpoint,\r\n                                                    swScope: oldDetails.swScope,\r\n                                                    vapidKey: arrayToBase64(oldDetails.vapidKey)\r\n                                                }\r\n                                            };\r\n                                        }\r\n                                        return [2 /*return*/];\r\n                                }\r\n                            });\r\n                        }); })];\r\n                case 3:\r\n                    db = _a.sent();\r\n                    db.close();\r\n                    // Delete all old databases.\r\n                    return [4 /*yield*/, idb.deleteDb(OLD_DB_NAME)];\r\n                case 4:\r\n                    // Delete all old databases.\r\n                    _a.sent();\r\n                    return [4 /*yield*/, idb.deleteDb('fcm_vapid_details_db')];\r\n                case 5:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, idb.deleteDb('undefined')];\r\n                case 6:\r\n                    _a.sent();\r\n                    return [2 /*return*/, checkTokenDetails(tokenDetails) ? tokenDetails : null];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction checkTokenDetails(tokenDetails) {\r\n    if (!tokenDetails || !tokenDetails.subscriptionOptions) {\r\n        return false;\r\n    }\r\n    var subscriptionOptions = tokenDetails.subscriptionOptions;\r\n    return (typeof tokenDetails.createTime === 'number' &&\r\n        tokenDetails.createTime > 0 &&\r\n        typeof tokenDetails.token === 'string' &&\r\n        tokenDetails.token.length > 0 &&\r\n        typeof subscriptionOptions.auth === 'string' &&\r\n        subscriptionOptions.auth.length > 0 &&\r\n        typeof subscriptionOptions.p256dh === 'string' &&\r\n        subscriptionOptions.p256dh.length > 0 &&\r\n        typeof subscriptionOptions.endpoint === 'string' &&\r\n        subscriptionOptions.endpoint.length > 0 &&\r\n        typeof subscriptionOptions.swScope === 'string' &&\r\n        subscriptionOptions.swScope.length > 0 &&\r\n        typeof subscriptionOptions.vapidKey === 'string' &&\r\n        subscriptionOptions.vapidKey.length > 0);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n// Exported for tests.\r\nvar DATABASE_NAME = 'firebase-messaging-database';\r\nvar DATABASE_VERSION = 1;\r\nvar OBJECT_STORE_NAME = 'firebase-messaging-store';\r\nvar dbPromise = null;\r\nfunction getDbPromise() {\r\n    if (!dbPromise) {\r\n        dbPromise = idb.openDb(DATABASE_NAME, DATABASE_VERSION, function (upgradeDb) {\r\n            // We don't use 'break' in this switch statement, the fall-through behavior is what we want,\r\n            // because if there are multiple versions between the old version and the current version, we\r\n            // want ALL the migrations that correspond to those versions to run, not only the last one.\r\n            // eslint-disable-next-line default-case\r\n            switch (upgradeDb.oldVersion) {\r\n                case 0:\r\n                    upgradeDb.createObjectStore(OBJECT_STORE_NAME);\r\n            }\r\n        });\r\n    }\r\n    return dbPromise;\r\n}\r\n/** Gets record(s) from the objectStore that match the given key. */\r\nfunction dbGet(firebaseDependencies) {\r\n    return tslib.__awaiter(this, void 0, void 0, function () {\r\n        var key, db, tokenDetails, oldTokenDetails;\r\n        return tslib.__generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(firebaseDependencies);\r\n                    return [4 /*yield*/, getDbPromise()];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    return [4 /*yield*/, db\r\n                            .transaction(OBJECT_STORE_NAME)\r\n                            .objectStore(OBJECT_STORE_NAME)\r\n                            .get(key)];\r\n                case 2:\r\n                    tokenDetails = _a.sent();\r\n                    if (!tokenDetails) return [3 /*break*/, 3];\r\n                    return [2 /*return*/, tokenDetails];\r\n                case 3: return [4 /*yield*/, migrateOldDatabase(firebaseDependencies.appConfig.senderId)];\r\n                case 4:\r\n                    oldTokenDetails = _a.sent();\r\n                    if (!oldTokenDetails) return [3 /*break*/, 6];\r\n                    return [4 /*yield*/, dbSet(firebaseDependencies, oldTokenDetails)];\r\n                case 5:\r\n                    _a.sent();\r\n                    return [2 /*return*/, oldTokenDetails];\r\n                case 6: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/** Assigns or overwrites the record for the given key with the given value. */\r\nfunction dbSet(firebaseDependencies, tokenDetails) {\r\n    return tslib.__awaiter(this, void 0, void 0, function () {\r\n        var key, db, tx;\r\n        return tslib.__generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(firebaseDependencies);\r\n                    return [4 /*yield*/, getDbPromise()];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n                    return [4 /*yield*/, tx.objectStore(OBJECT_STORE_NAME).put(tokenDetails, key)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, tx.complete];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [2 /*return*/, tokenDetails];\r\n            }\r\n        });\r\n    });\r\n}\r\n/** Removes record(s) from the objectStore that match the given key. */\r\nfunction dbRemove(firebaseDependencies) {\r\n    return tslib.__awaiter(this, void 0, void 0, function () {\r\n        var key, db, tx;\r\n        return tslib.__generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(firebaseDependencies);\r\n                    return [4 /*yield*/, getDbPromise()];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n                    return [4 /*yield*/, tx.objectStore(OBJECT_STORE_NAME).delete(key)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, tx.complete];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getKey(_a) {\r\n    var appConfig = _a.appConfig;\r\n    return appConfig.appId;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction requestGetToken(firebaseDependencies, subscriptionOptions) {\r\n    return tslib.__awaiter(this, void 0, void 0, function () {\r\n        var headers, body, subscribeOptions, responseData, response, err_1, message;\r\n        return tslib.__generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, getHeaders(firebaseDependencies)];\r\n                case 1:\r\n                    headers = _a.sent();\r\n                    body = getBody(subscriptionOptions);\r\n                    subscribeOptions = {\r\n                        method: 'POST',\r\n                        headers: headers,\r\n                        body: JSON.stringify(body)\r\n                    };\r\n                    _a.label = 2;\r\n                case 2:\r\n                    _a.trys.push([2, 5, , 6]);\r\n                    return [4 /*yield*/, fetch(getEndpoint(firebaseDependencies.appConfig), subscribeOptions)];\r\n                case 3:\r\n                    response = _a.sent();\r\n                    return [4 /*yield*/, response.json()];\r\n                case 4:\r\n                    responseData = _a.sent();\r\n                    return [3 /*break*/, 6];\r\n                case 5:\r\n                    err_1 = _a.sent();\r\n                    throw ERROR_FACTORY.create(\"token-subscribe-failed\" /* TOKEN_SUBSCRIBE_FAILED */, {\r\n                        errorInfo: err_1\r\n                    });\r\n                case 6:\r\n                    if (responseData.error) {\r\n                        message = responseData.error.message;\r\n                        throw ERROR_FACTORY.create(\"token-subscribe-failed\" /* TOKEN_SUBSCRIBE_FAILED */, {\r\n                            errorInfo: message\r\n                        });\r\n                    }\r\n                    if (!responseData.token) {\r\n                        throw ERROR_FACTORY.create(\"token-subscribe-no-token\" /* TOKEN_SUBSCRIBE_NO_TOKEN */);\r\n                    }\r\n                    return [2 /*return*/, responseData.token];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction requestUpdateToken(firebaseDependencies, tokenDetails) {\r\n    return tslib.__awaiter(this, void 0, void 0, function () {\r\n        var headers, body, updateOptions, responseData, response, err_2, message;\r\n        return tslib.__generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, getHeaders(firebaseDependencies)];\r\n                case 1:\r\n                    headers = _a.sent();\r\n                    body = getBody(tokenDetails.subscriptionOptions);\r\n                    updateOptions = {\r\n                        method: 'PATCH',\r\n                        headers: headers,\r\n                        body: JSON.stringify(body)\r\n                    };\r\n                    _a.label = 2;\r\n                case 2:\r\n                    _a.trys.push([2, 5, , 6]);\r\n                    return [4 /*yield*/, fetch(getEndpoint(firebaseDependencies.appConfig) + \"/\" + tokenDetails.token, updateOptions)];\r\n                case 3:\r\n                    response = _a.sent();\r\n                    return [4 /*yield*/, response.json()];\r\n                case 4:\r\n                    responseData = _a.sent();\r\n                    return [3 /*break*/, 6];\r\n                case 5:\r\n                    err_2 = _a.sent();\r\n                    throw ERROR_FACTORY.create(\"token-update-failed\" /* TOKEN_UPDATE_FAILED */, {\r\n                        errorInfo: err_2\r\n                    });\r\n                case 6:\r\n                    if (responseData.error) {\r\n                        message = responseData.error.message;\r\n                        throw ERROR_FACTORY.create(\"token-update-failed\" /* TOKEN_UPDATE_FAILED */, {\r\n                            errorInfo: message\r\n                        });\r\n                    }\r\n                    if (!responseData.token) {\r\n                        throw ERROR_FACTORY.create(\"token-update-no-token\" /* TOKEN_UPDATE_NO_TOKEN */);\r\n                    }\r\n                    return [2 /*return*/, responseData.token];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction requestDeleteToken(firebaseDependencies, token) {\r\n    return tslib.__awaiter(this, void 0, void 0, function () {\r\n        var headers, unsubscribeOptions, response, responseData, message, err_3;\r\n        return tslib.__generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, getHeaders(firebaseDependencies)];\r\n                case 1:\r\n                    headers = _a.sent();\r\n                    unsubscribeOptions = {\r\n                        method: 'DELETE',\r\n                        headers: headers\r\n                    };\r\n                    _a.label = 2;\r\n                case 2:\r\n                    _a.trys.push([2, 5, , 6]);\r\n                    return [4 /*yield*/, fetch(getEndpoint(firebaseDependencies.appConfig) + \"/\" + token, unsubscribeOptions)];\r\n                case 3:\r\n                    response = _a.sent();\r\n                    return [4 /*yield*/, response.json()];\r\n                case 4:\r\n                    responseData = _a.sent();\r\n                    if (responseData.error) {\r\n                        message = responseData.error.message;\r\n                        throw ERROR_FACTORY.create(\"token-unsubscribe-failed\" /* TOKEN_UNSUBSCRIBE_FAILED */, {\r\n                            errorInfo: message\r\n                        });\r\n                    }\r\n                    return [3 /*break*/, 6];\r\n                case 5:\r\n                    err_3 = _a.sent();\r\n                    throw ERROR_FACTORY.create(\"token-unsubscribe-failed\" /* TOKEN_UNSUBSCRIBE_FAILED */, {\r\n                        errorInfo: err_3\r\n                    });\r\n                case 6: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getEndpoint(_a) {\r\n    var projectId = _a.projectId;\r\n    return ENDPOINT + \"/projects/\" + projectId + \"/registrations\";\r\n}\r\nfunction getHeaders(_a) {\r\n    var appConfig = _a.appConfig, installations = _a.installations;\r\n    return tslib.__awaiter(this, void 0, void 0, function () {\r\n        var authToken;\r\n        return tslib.__generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, installations.getToken()];\r\n                case 1:\r\n                    authToken = _b.sent();\r\n                    return [2 /*return*/, new Headers({\r\n                            'Content-Type': 'application/json',\r\n                            Accept: 'application/json',\r\n                            'x-goog-api-key': appConfig.apiKey,\r\n                            'x-goog-firebase-installations-auth': \"FIS \" + authToken\r\n                        })];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getBody(_a) {\r\n    var p256dh = _a.p256dh, auth = _a.auth, endpoint = _a.endpoint, vapidKey = _a.vapidKey;\r\n    var body = {\r\n        web: {\r\n            endpoint: endpoint,\r\n            auth: auth,\r\n            p256dh: p256dh\r\n        }\r\n    };\r\n    if (vapidKey !== DEFAULT_VAPID_KEY) {\r\n        body.web.applicationPubKey = vapidKey;\r\n    }\r\n    return body;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/** UpdateRegistration will be called once every week. */\r\nvar TOKEN_EXPIRATION_MS = 7 * 24 * 60 * 60 * 1000; // 7 days\r\nfunction getToken(firebaseDependencies, swRegistration, vapidKey) {\r\n    return tslib.__awaiter(this, void 0, void 0, function () {\r\n        var pushSubscription, tokenDetails, subscriptionOptions, e_1;\r\n        return tslib.__generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    if (Notification.permission !== 'granted') {\r\n                        throw ERROR_FACTORY.create(\"permission-blocked\" /* PERMISSION_BLOCKED */);\r\n                    }\r\n                    return [4 /*yield*/, getPushSubscription(swRegistration, vapidKey)];\r\n                case 1:\r\n                    pushSubscription = _a.sent();\r\n                    return [4 /*yield*/, dbGet(firebaseDependencies)];\r\n                case 2:\r\n                    tokenDetails = _a.sent();\r\n                    subscriptionOptions = {\r\n                        vapidKey: vapidKey,\r\n                        swScope: swRegistration.scope,\r\n                        endpoint: pushSubscription.endpoint,\r\n                        auth: arrayToBase64(pushSubscription.getKey('auth')),\r\n                        p256dh: arrayToBase64(pushSubscription.getKey('p256dh'))\r\n                    };\r\n                    if (!!tokenDetails) return [3 /*break*/, 3];\r\n                    // No token, get a new one.\r\n                    return [2 /*return*/, getNewToken(firebaseDependencies, subscriptionOptions)];\r\n                case 3:\r\n                    if (!!isTokenValid(tokenDetails.subscriptionOptions, subscriptionOptions)) return [3 /*break*/, 8];\r\n                    _a.label = 4;\r\n                case 4:\r\n                    _a.trys.push([4, 6, , 7]);\r\n                    return [4 /*yield*/, requestDeleteToken(firebaseDependencies, tokenDetails.token)];\r\n                case 5:\r\n                    _a.sent();\r\n                    return [3 /*break*/, 7];\r\n                case 6:\r\n                    e_1 = _a.sent();\r\n                    // Suppress errors because of #2364\r\n                    console.warn(e_1);\r\n                    return [3 /*break*/, 7];\r\n                case 7: return [2 /*return*/, getNewToken(firebaseDependencies, subscriptionOptions)];\r\n                case 8:\r\n                    if (Date.now() >= tokenDetails.createTime + TOKEN_EXPIRATION_MS) {\r\n                        // Weekly token refresh\r\n                        return [2 /*return*/, updateToken({\r\n                                token: tokenDetails.token,\r\n                                createTime: Date.now(),\r\n                                subscriptionOptions: subscriptionOptions\r\n                            }, firebaseDependencies, swRegistration)];\r\n                    }\r\n                    else {\r\n                        // Valid token, nothing to do.\r\n                        return [2 /*return*/, tokenDetails.token];\r\n                    }\r\n                case 9: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * This method deletes the token from the database, unsubscribes the token from FCM, and unregisters\r\n * the push subscription if it exists.\r\n */\r\nfunction deleteToken(firebaseDependencies, swRegistration) {\r\n    return tslib.__awaiter(this, void 0, void 0, function () {\r\n        var tokenDetails, pushSubscription;\r\n        return tslib.__generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, dbGet(firebaseDependencies)];\r\n                case 1:\r\n                    tokenDetails = _a.sent();\r\n                    if (!tokenDetails) return [3 /*break*/, 4];\r\n                    return [4 /*yield*/, requestDeleteToken(firebaseDependencies, tokenDetails.token)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, dbRemove(firebaseDependencies)];\r\n                case 3:\r\n                    _a.sent();\r\n                    _a.label = 4;\r\n                case 4: return [4 /*yield*/, swRegistration.pushManager.getSubscription()];\r\n                case 5:\r\n                    pushSubscription = _a.sent();\r\n                    if (pushSubscription) {\r\n                        return [2 /*return*/, pushSubscription.unsubscribe()];\r\n                    }\r\n                    // If there's no SW, consider it a success.\r\n                    return [2 /*return*/, true];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction updateToken(tokenDetails, firebaseDependencies, swRegistration) {\r\n    return tslib.__awaiter(this, void 0, void 0, function () {\r\n        var updatedToken, updatedTokenDetails, e_2;\r\n        return tslib.__generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    _a.trys.push([0, 3, , 5]);\r\n                    return [4 /*yield*/, requestUpdateToken(firebaseDependencies, tokenDetails)];\r\n                case 1:\r\n                    updatedToken = _a.sent();\r\n                    updatedTokenDetails = tslib.__assign(tslib.__assign({}, tokenDetails), { token: updatedToken, createTime: Date.now() });\r\n                    return [4 /*yield*/, dbSet(firebaseDependencies, updatedTokenDetails)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [2 /*return*/, updatedToken];\r\n                case 3:\r\n                    e_2 = _a.sent();\r\n                    return [4 /*yield*/, deleteToken(firebaseDependencies, swRegistration)];\r\n                case 4:\r\n                    _a.sent();\r\n                    throw e_2;\r\n                case 5: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getNewToken(firebaseDependencies, subscriptionOptions) {\r\n    return tslib.__awaiter(this, void 0, void 0, function () {\r\n        var token, tokenDetails;\r\n        return tslib.__generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, requestGetToken(firebaseDependencies, subscriptionOptions)];\r\n                case 1:\r\n                    token = _a.sent();\r\n                    tokenDetails = {\r\n                        token: token,\r\n                        createTime: Date.now(),\r\n                        subscriptionOptions: subscriptionOptions\r\n                    };\r\n                    return [4 /*yield*/, dbSet(firebaseDependencies, tokenDetails)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [2 /*return*/, tokenDetails.token];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Gets a PushSubscription for the current user.\r\n */\r\nfunction getPushSubscription(swRegistration, vapidKey) {\r\n    return tslib.__awaiter(this, void 0, void 0, function () {\r\n        var subscription;\r\n        return tslib.__generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, swRegistration.pushManager.getSubscription()];\r\n                case 1:\r\n                    subscription = _a.sent();\r\n                    if (subscription) {\r\n                        return [2 /*return*/, subscription];\r\n                    }\r\n                    return [2 /*return*/, swRegistration.pushManager.subscribe({\r\n                            userVisibleOnly: true,\r\n                            // Chrome <= 75 doesn't support base64-encoded VAPID key. For backward compatibility, VAPID key\r\n                            // submitted to pushManager#subscribe must be of type Uint8Array.\r\n                            applicationServerKey: base64ToArray(vapidKey)\r\n                        })];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Checks if the saved tokenDetails object matches the configuration provided.\r\n */\r\nfunction isTokenValid(dbOptions, currentOptions) {\r\n    var isVapidKeyEqual = currentOptions.vapidKey === dbOptions.vapidKey;\r\n    var isEndpointEqual = currentOptions.endpoint === dbOptions.endpoint;\r\n    var isAuthEqual = currentOptions.auth === dbOptions.auth;\r\n    var isP256dhEqual = currentOptions.p256dh === dbOptions.p256dh;\r\n    return isVapidKeyEqual && isEndpointEqual && isAuthEqual && isP256dhEqual;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction externalizePayload(internalPayload) {\r\n    var payload = {\r\n        from: internalPayload.from,\r\n        // eslint-disable-next-line camelcase\r\n        collapseKey: internalPayload.collapse_key\r\n    };\r\n    propagateNotificationPayload(payload, internalPayload);\r\n    propagateDataPayload(payload, internalPayload);\r\n    propagateFcmOptions(payload, internalPayload);\r\n    return payload;\r\n}\r\nfunction propagateNotificationPayload(payload, messagePayloadInternal) {\r\n    if (!messagePayloadInternal.notification) {\r\n        return;\r\n    }\r\n    payload.notification = {};\r\n    var title = messagePayloadInternal.notification.title;\r\n    if (!!title) {\r\n        payload.notification.title = title;\r\n    }\r\n    var body = messagePayloadInternal.notification.body;\r\n    if (!!body) {\r\n        payload.notification.body = body;\r\n    }\r\n    var image = messagePayloadInternal.notification.image;\r\n    if (!!image) {\r\n        payload.notification.image = image;\r\n    }\r\n}\r\nfunction propagateDataPayload(payload, messagePayloadInternal) {\r\n    if (!messagePayloadInternal.data) {\r\n        return;\r\n    }\r\n    payload.data = messagePayloadInternal.data;\r\n}\r\nfunction propagateFcmOptions(payload, messagePayloadInternal) {\r\n    if (!messagePayloadInternal.fcmOptions) {\r\n        return;\r\n    }\r\n    payload.fcmOptions = {};\r\n    var link = messagePayloadInternal.fcmOptions.link;\r\n    if (!!link) {\r\n        payload.fcmOptions.link = link;\r\n    }\r\n    // eslint-disable-next-line camelcase\r\n    var analyticsLabel = messagePayloadInternal.fcmOptions.analytics_label;\r\n    if (!!analyticsLabel) {\r\n        payload.fcmOptions.analyticsLabel = analyticsLabel;\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction isConsoleMessage(data) {\r\n    // This message has a campaign ID, meaning it was sent using the Firebase Console.\r\n    return typeof data === 'object' && !!data && CONSOLE_CAMPAIGN_ID in data;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/** Returns a promise that resolves after given time passes. */\r\nfunction sleep(ms) {\r\n    return new Promise(function (resolve) {\r\n        setTimeout(resolve, ms);\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar SwController = /** @class */ (function () {\r\n    function SwController(firebaseDependencies) {\r\n        var _this = this;\r\n        this.firebaseDependencies = firebaseDependencies;\r\n        // A boolean flag to determine wether an app is using onBackgroundMessage or\r\n        // setBackgroundMessageHandler. onBackgroundMessage will receive a MessagePayload regardless of if\r\n        // a notification is displayed. Whereas, setBackgroundMessageHandler will swallow the\r\n        // MessagePayload if a NotificationPayload is included.\r\n        this.isOnBackgroundMessageUsed = null;\r\n        this.vapidKey = null;\r\n        this.bgMessageHandler = null;\r\n        self.addEventListener('push', function (e) {\r\n            e.waitUntil(_this.onPush(e));\r\n        });\r\n        self.addEventListener('pushsubscriptionchange', function (e) {\r\n            e.waitUntil(_this.onSubChange(e));\r\n        });\r\n        self.addEventListener('notificationclick', function (e) {\r\n            e.waitUntil(_this.onNotificationClick(e));\r\n        });\r\n    }\r\n    Object.defineProperty(SwController.prototype, \"app\", {\r\n        get: function () {\r\n            return this.firebaseDependencies.app;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * @deprecated. Use onBackgroundMessage(nextOrObserver: NextFn<object> | Observer<object>):\r\n     * Unsubscribe instead.\r\n     *\r\n     * Calling setBackgroundMessageHandler will opt in to some specific behaviors.\r\n     *\r\n     * 1.) If a notification doesn't need to be shown due to a window already being visible, then push\r\n     * messages will be sent to the page. 2.) If a notification needs to be shown, and the message\r\n     * contains no notification data this method will be called and the promise it returns will be\r\n     * passed to event.waitUntil. If you do not set this callback then all push messages will let and\r\n     * the developer can handle them in a their own 'push' event callback\r\n     *\r\n     * @param callback The callback to be called when a push message is received and a notification\r\n     * must be shown. The callback will be given the data from the push message.\r\n     */\r\n    SwController.prototype.setBackgroundMessageHandler = function (callback) {\r\n        this.isOnBackgroundMessageUsed = false;\r\n        if (!callback || typeof callback !== 'function') {\r\n            throw ERROR_FACTORY.create(\"invalid-bg-handler\" /* INVALID_BG_HANDLER */);\r\n        }\r\n        this.bgMessageHandler = callback;\r\n    };\r\n    SwController.prototype.onBackgroundMessage = function (nextOrObserver) {\r\n        var _this = this;\r\n        this.isOnBackgroundMessageUsed = true;\r\n        this.bgMessageHandler = nextOrObserver;\r\n        return function () {\r\n            _this.bgMessageHandler = null;\r\n        };\r\n    };\r\n    // TODO: Remove getToken from SW Controller. Calling this from an old SW can cause all kinds of\r\n    // trouble.\r\n    SwController.prototype.getToken = function () {\r\n        var _a, _b;\r\n        return tslib.__awaiter(this, void 0, void 0, function () {\r\n            var tokenDetails;\r\n            return tslib.__generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        if (!!this.vapidKey) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, dbGet(this.firebaseDependencies)];\r\n                    case 1:\r\n                        tokenDetails = _c.sent();\r\n                        this.vapidKey =\r\n                            (_b = (_a = tokenDetails === null || tokenDetails === void 0 ? void 0 : tokenDetails.subscriptionOptions) === null || _a === void 0 ? void 0 : _a.vapidKey) !== null && _b !== void 0 ? _b : DEFAULT_VAPID_KEY;\r\n                        _c.label = 2;\r\n                    case 2: return [2 /*return*/, getToken(this.firebaseDependencies, self.registration, this.vapidKey)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    // TODO: Remove deleteToken from SW Controller. Calling this from an old SW can cause all kinds of\r\n    // trouble.\r\n    SwController.prototype.deleteToken = function () {\r\n        return deleteToken(this.firebaseDependencies, self.registration);\r\n    };\r\n    SwController.prototype.requestPermission = function () {\r\n        throw ERROR_FACTORY.create(\"only-available-in-window\" /* AVAILABLE_IN_WINDOW */);\r\n    };\r\n    // TODO: Remove this together with getToken from SW Controller.\r\n    SwController.prototype.usePublicVapidKey = function (vapidKey) {\r\n        if (this.vapidKey !== null) {\r\n            throw ERROR_FACTORY.create(\"use-vapid-key-after-get-token\" /* USE_VAPID_KEY_AFTER_GET_TOKEN */);\r\n        }\r\n        if (typeof vapidKey !== 'string' || vapidKey.length === 0) {\r\n            throw ERROR_FACTORY.create(\"invalid-vapid-key\" /* INVALID_VAPID_KEY */);\r\n        }\r\n        this.vapidKey = vapidKey;\r\n    };\r\n    SwController.prototype.useServiceWorker = function () {\r\n        throw ERROR_FACTORY.create(\"only-available-in-window\" /* AVAILABLE_IN_WINDOW */);\r\n    };\r\n    SwController.prototype.onMessage = function () {\r\n        throw ERROR_FACTORY.create(\"only-available-in-window\" /* AVAILABLE_IN_WINDOW */);\r\n    };\r\n    SwController.prototype.onTokenRefresh = function () {\r\n        throw ERROR_FACTORY.create(\"only-available-in-window\" /* AVAILABLE_IN_WINDOW */);\r\n    };\r\n    /**\r\n     * A handler for push events that shows notifications based on the content of the payload.\r\n     *\r\n     * The payload must be a JSON-encoded Object with a `notification` key. The value of the\r\n     * `notification` property will be used as the NotificationOptions object passed to\r\n     * showNotification. Additionally, the `title` property of the notification object will be used as\r\n     * the title.\r\n     *\r\n     * If there is no notification data in the payload then no notification will be shown.\r\n     */\r\n    SwController.prototype.onPush = function (event) {\r\n        return tslib.__awaiter(this, void 0, void 0, function () {\r\n            var internalPayload, clientList, isNotificationShown, payload;\r\n            return tslib.__generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        internalPayload = getMessagePayloadInternal(event);\r\n                        if (!internalPayload) {\r\n                            console.debug(TAG +\r\n                                'failed to get parsed MessagePayload from the PushEvent. Skip handling the push.');\r\n                            return [2 /*return*/];\r\n                        }\r\n                        return [4 /*yield*/, getClientList()];\r\n                    case 1:\r\n                        clientList = _a.sent();\r\n                        if (hasVisibleClients(clientList)) {\r\n                            return [2 /*return*/, sendMessagePayloadInternalToWindows(clientList, internalPayload)];\r\n                        }\r\n                        isNotificationShown = false;\r\n                        if (!!!internalPayload.notification) return [3 /*break*/, 3];\r\n                        return [4 /*yield*/, showNotification(wrapInternalPayload(internalPayload))];\r\n                    case 2:\r\n                        _a.sent();\r\n                        isNotificationShown = true;\r\n                        _a.label = 3;\r\n                    case 3:\r\n                        // MessagePayload is only passed to `onBackgroundMessage`. Skip passing MessagePayload for\r\n                        // the legacy `setBackgroundMessageHandler` to preserve the SDK behaviors.\r\n                        if (isNotificationShown === true &&\r\n                            this.isOnBackgroundMessageUsed === false) {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        if (!!this.bgMessageHandler) {\r\n                            payload = externalizePayload(internalPayload);\r\n                            if (typeof this.bgMessageHandler === 'function') {\r\n                                this.bgMessageHandler(payload);\r\n                            }\r\n                            else {\r\n                                this.bgMessageHandler.next(payload);\r\n                            }\r\n                        }\r\n                        // wait briefly to allow onBackgroundMessage to complete\r\n                        return [4 /*yield*/, sleep(BACKGROUND_HANDLE_EXECUTION_TIME_LIMIT_MS)];\r\n                    case 4:\r\n                        // wait briefly to allow onBackgroundMessage to complete\r\n                        _a.sent();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    SwController.prototype.onSubChange = function (event) {\r\n        var _a, _b;\r\n        return tslib.__awaiter(this, void 0, void 0, function () {\r\n            var newSubscription, tokenDetails;\r\n            return tslib.__generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        newSubscription = event.newSubscription;\r\n                        if (!!newSubscription) return [3 /*break*/, 2];\r\n                        // Subscription revoked, delete token\r\n                        return [4 /*yield*/, deleteToken(this.firebaseDependencies, self.registration)];\r\n                    case 1:\r\n                        // Subscription revoked, delete token\r\n                        _c.sent();\r\n                        return [2 /*return*/];\r\n                    case 2: return [4 /*yield*/, dbGet(this.firebaseDependencies)];\r\n                    case 3:\r\n                        tokenDetails = _c.sent();\r\n                        return [4 /*yield*/, deleteToken(this.firebaseDependencies, self.registration)];\r\n                    case 4:\r\n                        _c.sent();\r\n                        return [4 /*yield*/, getToken(this.firebaseDependencies, self.registration, (_b = (_a = tokenDetails === null || tokenDetails === void 0 ? void 0 : tokenDetails.subscriptionOptions) === null || _a === void 0 ? void 0 : _a.vapidKey) !== null && _b !== void 0 ? _b : DEFAULT_VAPID_KEY)];\r\n                    case 5:\r\n                        _c.sent();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    SwController.prototype.onNotificationClick = function (event) {\r\n        var _a, _b;\r\n        return tslib.__awaiter(this, void 0, void 0, function () {\r\n            var internalPayload, link, url, originUrl, client;\r\n            return tslib.__generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        internalPayload = (_b = (_a = event.notification) === null || _a === void 0 ? void 0 : _a.data) === null || _b === void 0 ? void 0 : _b[FCM_MSG];\r\n                        if (!internalPayload) {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        else if (event.action) {\r\n                            // User clicked on an action button. This will allow developers to act on action button clicks\r\n                            // by using a custom onNotificationClick listener that they define.\r\n                            return [2 /*return*/];\r\n                        }\r\n                        // Prevent other listeners from receiving the event\r\n                        event.stopImmediatePropagation();\r\n                        event.notification.close();\r\n                        link = getLink(internalPayload);\r\n                        if (!link) {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        url = new URL(link, self.location.href);\r\n                        originUrl = new URL(self.location.origin);\r\n                        if (url.host !== originUrl.host) {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        return [4 /*yield*/, getWindowClient(url)];\r\n                    case 1:\r\n                        client = _c.sent();\r\n                        if (!!client) return [3 /*break*/, 4];\r\n                        return [4 /*yield*/, self.clients.openWindow(link)];\r\n                    case 2:\r\n                        client = _c.sent();\r\n                        // Wait three seconds for the client to initialize and set up the message handler so that it\r\n                        // can receive the message.\r\n                        return [4 /*yield*/, sleep(FOREGROUND_HANDLE_PREPARATION_TIME_MS)];\r\n                    case 3:\r\n                        // Wait three seconds for the client to initialize and set up the message handler so that it\r\n                        // can receive the message.\r\n                        _c.sent();\r\n                        return [3 /*break*/, 6];\r\n                    case 4: return [4 /*yield*/, client.focus()];\r\n                    case 5:\r\n                        client = _c.sent();\r\n                        _c.label = 6;\r\n                    case 6:\r\n                        if (!client) {\r\n                            // Window Client will not be returned if it's for a third party origin.\r\n                            return [2 /*return*/];\r\n                        }\r\n                        internalPayload.messageType = MessageType.NOTIFICATION_CLICKED;\r\n                        internalPayload.isFirebaseMessaging = true;\r\n                        return [2 /*return*/, client.postMessage(internalPayload)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return SwController;\r\n}());\r\nfunction wrapInternalPayload(internalPayload) {\r\n    var _a;\r\n    var wrappedInternalPayload = tslib.__assign({}, internalPayload.notification);\r\n    // Put the message payload under FCM_MSG name so we can identify the notification as being an FCM\r\n    // notification vs a notification from somewhere else (i.e. normal web push or developer generated\r\n    // notification).\r\n    wrappedInternalPayload.data = (_a = {},\r\n        _a[FCM_MSG] = internalPayload,\r\n        _a);\r\n    return wrappedInternalPayload;\r\n}\r\nfunction getMessagePayloadInternal(_a) {\r\n    var data = _a.data;\r\n    if (!data) {\r\n        return null;\r\n    }\r\n    try {\r\n        return data.json();\r\n    }\r\n    catch (err) {\r\n        // Not JSON so not an FCM message.\r\n        return null;\r\n    }\r\n}\r\n/**\r\n * @param url The URL to look for when focusing a client.\r\n * @return Returns an existing window client or a newly opened WindowClient.\r\n */\r\nfunction getWindowClient(url) {\r\n    return tslib.__awaiter(this, void 0, void 0, function () {\r\n        var clientList, clientList_1, clientList_1_1, client, clientUrl;\r\n        var e_1, _a;\r\n        return tslib.__generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, getClientList()];\r\n                case 1:\r\n                    clientList = _b.sent();\r\n                    try {\r\n                        for (clientList_1 = tslib.__values(clientList), clientList_1_1 = clientList_1.next(); !clientList_1_1.done; clientList_1_1 = clientList_1.next()) {\r\n                            client = clientList_1_1.value;\r\n                            clientUrl = new URL(client.url, self.location.href);\r\n                            if (url.host === clientUrl.host) {\r\n                                return [2 /*return*/, client];\r\n                            }\r\n                        }\r\n                    }\r\n                    catch (e_1_1) { e_1 = { error: e_1_1 }; }\r\n                    finally {\r\n                        try {\r\n                            if (clientList_1_1 && !clientList_1_1.done && (_a = clientList_1.return)) _a.call(clientList_1);\r\n                        }\r\n                        finally { if (e_1) throw e_1.error; }\r\n                    }\r\n                    return [2 /*return*/, null];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * @returns If there is currently a visible WindowClient, this method will resolve to true,\r\n * otherwise false.\r\n */\r\nfunction hasVisibleClients(clientList) {\r\n    return clientList.some(function (client) {\r\n        return client.visibilityState === 'visible' &&\r\n            // Ignore chrome-extension clients as that matches the background pages of extensions, which\r\n            // are always considered visible for some reason.\r\n            !client.url.startsWith('chrome-extension://');\r\n    });\r\n}\r\nfunction sendMessagePayloadInternalToWindows(clientList, internalPayload) {\r\n    var e_2, _a;\r\n    internalPayload.isFirebaseMessaging = true;\r\n    internalPayload.messageType = MessageType.PUSH_RECEIVED;\r\n    try {\r\n        for (var clientList_2 = tslib.__values(clientList), clientList_2_1 = clientList_2.next(); !clientList_2_1.done; clientList_2_1 = clientList_2.next()) {\r\n            var client = clientList_2_1.value;\r\n            client.postMessage(internalPayload);\r\n        }\r\n    }\r\n    catch (e_2_1) { e_2 = { error: e_2_1 }; }\r\n    finally {\r\n        try {\r\n            if (clientList_2_1 && !clientList_2_1.done && (_a = clientList_2.return)) _a.call(clientList_2);\r\n        }\r\n        finally { if (e_2) throw e_2.error; }\r\n    }\r\n}\r\nfunction getClientList() {\r\n    return self.clients.matchAll({\r\n        type: 'window',\r\n        includeUncontrolled: true\r\n        // TS doesn't know that \"type: 'window'\" means it'll return WindowClient[]\r\n    });\r\n}\r\nfunction showNotification(notificationPayloadInternal) {\r\n    var _a;\r\n    // Note: Firefox does not support the maxActions property.\r\n    // https://developer.mozilla.org/en-US/docs/Web/API/notification/maxActions\r\n    var actions = notificationPayloadInternal.actions;\r\n    var maxActions = Notification.maxActions;\r\n    if (actions && maxActions && actions.length > maxActions) {\r\n        console.warn(\"This browser only supports \" + maxActions + \" actions. The remaining actions will not be displayed.\");\r\n    }\r\n    return self.registration.showNotification(\r\n    /* title= */ (_a = notificationPayloadInternal.title) !== null && _a !== void 0 ? _a : '', notificationPayloadInternal);\r\n}\r\nfunction getLink(payload) {\r\n    var _a, _b, _c;\r\n    // eslint-disable-next-line camelcase\r\n    var link = (_b = (_a = payload.fcmOptions) === null || _a === void 0 ? void 0 : _a.link) !== null && _b !== void 0 ? _b : (_c = payload.notification) === null || _c === void 0 ? void 0 : _c.click_action;\r\n    if (link) {\r\n        return link;\r\n    }\r\n    if (isConsoleMessage(payload.data)) {\r\n        // Notification created in the Firebase Console. Redirect to origin.\r\n        return self.location.origin;\r\n    }\r\n    else {\r\n        return null;\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar WindowController = /** @class */ (function () {\r\n    function WindowController(firebaseDependencies) {\r\n        var _this = this;\r\n        this.firebaseDependencies = firebaseDependencies;\r\n        this.vapidKey = null;\r\n        this.onMessageCallback = null;\r\n        navigator.serviceWorker.addEventListener('message', function (e) {\r\n            return _this.messageEventListener(e);\r\n        });\r\n    }\r\n    Object.defineProperty(WindowController.prototype, \"app\", {\r\n        get: function () {\r\n            return this.firebaseDependencies.app;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    WindowController.prototype.messageEventListener = function (event) {\r\n        return tslib.__awaiter(this, void 0, void 0, function () {\r\n            var internalPayload, dataPayload;\r\n            return tslib.__generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        internalPayload = event.data;\r\n                        if (!internalPayload.isFirebaseMessaging) {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        // onMessageCallback is either a function or observer/subscriber.\r\n                        // TODO: in the modularization release, have onMessage handle type MessagePayload as supposed to\r\n                        // the legacy payload where some fields are in snake cases.\r\n                        if (this.onMessageCallback &&\r\n                            internalPayload.messageType === MessageType.PUSH_RECEIVED) {\r\n                            if (typeof this.onMessageCallback === 'function') {\r\n                                this.onMessageCallback(stripInternalFields(Object.assign({}, internalPayload)));\r\n                            }\r\n                            else {\r\n                                this.onMessageCallback.next(Object.assign({}, internalPayload));\r\n                            }\r\n                        }\r\n                        dataPayload = internalPayload.data;\r\n                        if (!(isConsoleMessage(dataPayload) &&\r\n                            dataPayload[CONSOLE_CAMPAIGN_ANALYTICS_ENABLED] === '1')) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, this.logEvent(internalPayload.messageType, dataPayload)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    WindowController.prototype.getVapidKey = function () {\r\n        return this.vapidKey;\r\n    };\r\n    WindowController.prototype.getSwReg = function () {\r\n        return this.swRegistration;\r\n    };\r\n    WindowController.prototype.getToken = function (options) {\r\n        return tslib.__awaiter(this, void 0, void 0, function () {\r\n            return tslib.__generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!(Notification.permission === 'default')) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, Notification.requestPermission()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        if (Notification.permission !== 'granted') {\r\n                            throw ERROR_FACTORY.create(\"permission-blocked\" /* PERMISSION_BLOCKED */);\r\n                        }\r\n                        return [4 /*yield*/, this.updateVapidKey(options === null || options === void 0 ? void 0 : options.vapidKey)];\r\n                    case 3:\r\n                        _a.sent();\r\n                        return [4 /*yield*/, this.updateSwReg(options === null || options === void 0 ? void 0 : options.serviceWorkerRegistration)];\r\n                    case 4:\r\n                        _a.sent();\r\n                        return [2 /*return*/, getToken(this.firebaseDependencies, this.swRegistration, this.vapidKey)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    WindowController.prototype.updateVapidKey = function (vapidKey) {\r\n        return tslib.__awaiter(this, void 0, void 0, function () {\r\n            return tslib.__generator(this, function (_a) {\r\n                if (!!vapidKey) {\r\n                    this.vapidKey = vapidKey;\r\n                }\r\n                else if (!this.vapidKey) {\r\n                    this.vapidKey = DEFAULT_VAPID_KEY;\r\n                }\r\n                return [2 /*return*/];\r\n            });\r\n        });\r\n    };\r\n    WindowController.prototype.updateSwReg = function (swRegistration) {\r\n        return tslib.__awaiter(this, void 0, void 0, function () {\r\n            return tslib.__generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!(!swRegistration && !this.swRegistration)) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, this.registerDefaultSw()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        if (!swRegistration && !!this.swRegistration) {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        if (!(swRegistration instanceof ServiceWorkerRegistration)) {\r\n                            throw ERROR_FACTORY.create(\"invalid-sw-registration\" /* INVALID_SW_REGISTRATION */);\r\n                        }\r\n                        this.swRegistration = swRegistration;\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    WindowController.prototype.registerDefaultSw = function () {\r\n        return tslib.__awaiter(this, void 0, void 0, function () {\r\n            var _a, e_1;\r\n            return tslib.__generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        _b.trys.push([0, 2, , 3]);\r\n                        _a = this;\r\n                        return [4 /*yield*/, navigator.serviceWorker.register(DEFAULT_SW_PATH, {\r\n                                scope: DEFAULT_SW_SCOPE\r\n                            })];\r\n                    case 1:\r\n                        _a.swRegistration = _b.sent();\r\n                        // The timing when browser updates sw when sw has an update is unreliable by my experiment. It\r\n                        // leads to version conflict when the SDK upgrades to a newer version in the main page, but sw\r\n                        // is stuck with the old version. For example,\r\n                        // https://github.com/firebase/firebase-js-sdk/issues/2590 The following line reliably updates\r\n                        // sw if there was an update.\r\n                        this.swRegistration.update().catch(function () {\r\n                            /* it is non blocking and we don't care if it failed */\r\n                        });\r\n                        return [3 /*break*/, 3];\r\n                    case 2:\r\n                        e_1 = _b.sent();\r\n                        throw ERROR_FACTORY.create(\"failed-service-worker-registration\" /* FAILED_DEFAULT_REGISTRATION */, {\r\n                            browserErrorMessage: e_1.message\r\n                        });\r\n                    case 3: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    WindowController.prototype.deleteToken = function () {\r\n        return tslib.__awaiter(this, void 0, void 0, function () {\r\n            return tslib.__generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!!this.swRegistration) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, this.registerDefaultSw()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2: return [2 /*return*/, deleteToken(this.firebaseDependencies, this.swRegistration)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Request permission if it is not currently granted.\r\n     *\r\n     * @return Resolves if the permission was granted, rejects otherwise.\r\n     *\r\n     * @deprecated Use Notification.requestPermission() instead.\r\n     * https://developer.mozilla.org/en-US/docs/Web/API/Notification/requestPermission\r\n     */\r\n    WindowController.prototype.requestPermission = function () {\r\n        return tslib.__awaiter(this, void 0, void 0, function () {\r\n            var permissionResult;\r\n            return tslib.__generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (Notification.permission === 'granted') {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        return [4 /*yield*/, Notification.requestPermission()];\r\n                    case 1:\r\n                        permissionResult = _a.sent();\r\n                        if (permissionResult === 'granted') {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        else if (permissionResult === 'denied') {\r\n                            throw ERROR_FACTORY.create(\"permission-blocked\" /* PERMISSION_BLOCKED */);\r\n                        }\r\n                        else {\r\n                            throw ERROR_FACTORY.create(\"permission-default\" /* PERMISSION_DEFAULT */);\r\n                        }\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * @deprecated. Use getToken(options?: {vapidKey?: string; serviceWorkerRegistration?:\r\n     * ServiceWorkerRegistration;}): Promise<string> instead.\r\n     */\r\n    WindowController.prototype.usePublicVapidKey = function (vapidKey) {\r\n        if (this.vapidKey !== null) {\r\n            throw ERROR_FACTORY.create(\"use-vapid-key-after-get-token\" /* USE_VAPID_KEY_AFTER_GET_TOKEN */);\r\n        }\r\n        if (typeof vapidKey !== 'string' || vapidKey.length === 0) {\r\n            throw ERROR_FACTORY.create(\"invalid-vapid-key\" /* INVALID_VAPID_KEY */);\r\n        }\r\n        this.vapidKey = vapidKey;\r\n    };\r\n    /**\r\n     * @deprecated. Use getToken(options?: {vapidKey?: string; serviceWorkerRegistration?:\r\n     * ServiceWorkerRegistration;}): Promise<string> instead.\r\n     */\r\n    WindowController.prototype.useServiceWorker = function (swRegistration) {\r\n        if (!(swRegistration instanceof ServiceWorkerRegistration)) {\r\n            throw ERROR_FACTORY.create(\"invalid-sw-registration\" /* INVALID_SW_REGISTRATION */);\r\n        }\r\n        if (this.swRegistration) {\r\n            throw ERROR_FACTORY.create(\"use-sw-after-get-token\" /* USE_SW_AFTER_GET_TOKEN */);\r\n        }\r\n        this.swRegistration = swRegistration;\r\n    };\r\n    /**\r\n     * @param nextOrObserver An observer object or a function triggered on message.\r\n     *\r\n     * @return The unsubscribe function for the observer.\r\n     */\r\n    WindowController.prototype.onMessage = function (nextOrObserver) {\r\n        var _this = this;\r\n        this.onMessageCallback = nextOrObserver;\r\n        return function () {\r\n            _this.onMessageCallback = null;\r\n        };\r\n    };\r\n    WindowController.prototype.setBackgroundMessageHandler = function () {\r\n        throw ERROR_FACTORY.create(\"only-available-in-sw\" /* AVAILABLE_IN_SW */);\r\n    };\r\n    WindowController.prototype.onBackgroundMessage = function () {\r\n        throw ERROR_FACTORY.create(\"only-available-in-sw\" /* AVAILABLE_IN_SW */);\r\n    };\r\n    /**\r\n     * @deprecated No-op. It was initially designed with token rotation requests from server in mind.\r\n     * However, the plan to implement such feature was abandoned.\r\n     */\r\n    WindowController.prototype.onTokenRefresh = function () {\r\n        return function () { };\r\n    };\r\n    WindowController.prototype.logEvent = function (messageType, data) {\r\n        return tslib.__awaiter(this, void 0, void 0, function () {\r\n            var eventType, analytics;\r\n            return tslib.__generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        eventType = getEventType(messageType);\r\n                        return [4 /*yield*/, this.firebaseDependencies.analyticsProvider.get()];\r\n                    case 1:\r\n                        analytics = _a.sent();\r\n                        analytics.logEvent(eventType, {\r\n                            /* eslint-disable camelcase */\r\n                            message_id: data[CONSOLE_CAMPAIGN_ID],\r\n                            message_name: data[CONSOLE_CAMPAIGN_NAME],\r\n                            message_time: data[CONSOLE_CAMPAIGN_TIME],\r\n                            message_device_time: Math.floor(Date.now() / 1000)\r\n                            /* eslint-enable camelcase */\r\n                        });\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return WindowController;\r\n}());\r\nfunction getEventType(messageType) {\r\n    switch (messageType) {\r\n        case MessageType.NOTIFICATION_CLICKED:\r\n            return 'notification_open';\r\n        case MessageType.PUSH_RECEIVED:\r\n            return 'notification_foreground';\r\n        default:\r\n            throw new Error();\r\n    }\r\n}\r\nfunction stripInternalFields(internalPayload) {\r\n    delete internalPayload.messageType;\r\n    delete internalPayload.isFirebaseMessaging;\r\n    return internalPayload;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction extractAppConfig(app) {\r\n    var e_1, _a;\r\n    if (!app || !app.options) {\r\n        throw getMissingValueError('App Configuration Object');\r\n    }\r\n    if (!app.name) {\r\n        throw getMissingValueError('App Name');\r\n    }\r\n    // Required app config keys\r\n    var configKeys = [\r\n        'projectId',\r\n        'apiKey',\r\n        'appId',\r\n        'messagingSenderId'\r\n    ];\r\n    var options = app.options;\r\n    try {\r\n        for (var configKeys_1 = tslib.__values(configKeys), configKeys_1_1 = configKeys_1.next(); !configKeys_1_1.done; configKeys_1_1 = configKeys_1.next()) {\r\n            var keyName = configKeys_1_1.value;\r\n            if (!options[keyName]) {\r\n                throw getMissingValueError(keyName);\r\n            }\r\n        }\r\n    }\r\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\r\n    finally {\r\n        try {\r\n            if (configKeys_1_1 && !configKeys_1_1.done && (_a = configKeys_1.return)) _a.call(configKeys_1);\r\n        }\r\n        finally { if (e_1) throw e_1.error; }\r\n    }\r\n    return {\r\n        appName: app.name,\r\n        projectId: options.projectId,\r\n        apiKey: options.apiKey,\r\n        appId: options.appId,\r\n        senderId: options.messagingSenderId\r\n    };\r\n}\r\nfunction getMissingValueError(valueName) {\r\n    return ERROR_FACTORY.create(\"missing-app-config-values\" /* MISSING_APP_CONFIG_VALUES */, {\r\n        valueName: valueName\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar MESSAGING_NAME = 'messaging';\r\nfunction factoryMethod(container) {\r\n    // Dependencies.\r\n    var app = container.getProvider('app').getImmediate();\r\n    var appConfig = extractAppConfig(app);\r\n    var installations = container.getProvider('installations').getImmediate();\r\n    var analyticsProvider = container.getProvider('analytics-internal');\r\n    var firebaseDependencies = {\r\n        app: app,\r\n        appConfig: appConfig,\r\n        installations: installations,\r\n        analyticsProvider: analyticsProvider\r\n    };\r\n    if (!isSupported()) {\r\n        throw ERROR_FACTORY.create(\"unsupported-browser\" /* UNSUPPORTED_BROWSER */);\r\n    }\r\n    if (self && 'ServiceWorkerGlobalScope' in self) {\r\n        // Running in ServiceWorker context\r\n        return new SwController(firebaseDependencies);\r\n    }\r\n    else {\r\n        // Assume we are in the window context.\r\n        return new WindowController(firebaseDependencies);\r\n    }\r\n}\r\nvar NAMESPACE_EXPORTS = {\r\n    isSupported: isSupported\r\n};\r\nfirebase__default['default'].INTERNAL.registerComponent(new component.Component(MESSAGING_NAME, factoryMethod, \"PUBLIC\" /* PUBLIC */).setServiceProps(NAMESPACE_EXPORTS));\r\nfunction isSupported() {\r\n    if (self && 'ServiceWorkerGlobalScope' in self) {\r\n        // Running in ServiceWorker context\r\n        return isSWControllerSupported();\r\n    }\r\n    else {\r\n        // Assume we are in the window context.\r\n        return isWindowControllerSupported();\r\n    }\r\n}\r\n/**\r\n * Checks to see if the required APIs exist.\r\n */\r\nfunction isWindowControllerSupported() {\r\n    return ('indexedDB' in window &&\r\n        indexedDB !== null &&\r\n        navigator.cookieEnabled &&\r\n        'serviceWorker' in navigator &&\r\n        'PushManager' in window &&\r\n        'Notification' in window &&\r\n        'fetch' in window &&\r\n        ServiceWorkerRegistration.prototype.hasOwnProperty('showNotification') &&\r\n        PushSubscription.prototype.hasOwnProperty('getKey'));\r\n}\r\n/**\r\n * Checks to see if the required APIs exist within SW Context.\r\n */\r\nfunction isSWControllerSupported() {\r\n    return ('indexedDB' in self &&\r\n        indexedDB !== null &&\r\n        'PushManager' in self &&\r\n        'Notification' in self &&\r\n        ServiceWorkerRegistration.prototype.hasOwnProperty('showNotification') &&\r\n        PushSubscription.prototype.hasOwnProperty('getKey'));\r\n}\n//# sourceMappingURL=index.cjs.js.map\n\n};","~:removed-requires",["~#set",[]],"~:actual-requires",["^5",["~$module$node_modules$$firebase$util$dist$index_esm","~$module$node_modules$tslib$tslib","~$module$node_modules$idb$build$idb","~$shadow.js","~$module$node_modules$$firebase$installations$dist$index_cjs","~$module$node_modules$$firebase$app$dist$index_esm","~$module$node_modules$$firebase$component$dist$index_esm"]],"~:properties",["^5",["setBackgroundMessageHandler","onMessageCallback","browserErrorMessage","getSwReg","vapidKey","token","body","web","onTokenRefresh","swRegistration","userVisibleOnly","onSubChange","messageEventListener","onMessage","deleteToken","image","getVapidKey","logEvent","applicationServerKey","includeUncontrolled","label","method","applicationPubKey","errorInfo","auth","isOnBackgroundMessageUsed","onPush","registerDefaultSw","onBackgroundMessage","error","subscriptionOptions","analyticsLabel","analyticsProvider","message_name","appName","updateSwReg","configurable","createTime","usePublicVapidKey","enumerable","isFirebaseMessaging","installations","scope","appConfig","messageType","requestPermission","useServiceWorker","apiKey","title","link","firebaseDependencies","getToken","type","appId","app","bgMessageHandler","swScope","valueName","message_time","from","isSupported","endpoint","p256dh","projectId","senderId","notification","Accept","onNotificationClick","fcmOptions","data","get","message_device_time","collapseKey","updateVapidKey","message_id","headers"]],"~:compiled-at",1627830407985,"~:source-map-json","{\n\"version\":3,\n\"file\":\"module$node_modules$$firebase$messaging$dist$index_cjs.js\",\n\"lineCount\":63,\n\"mappings\":\"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\",\n\"sources\":[\"node_modules/@firebase/messaging/dist/index.cjs.js\"],\n\"sourcesContent\":[\"shadow$provide[\\\"module$node_modules$$firebase$messaging$dist$index_cjs\\\"] = function(global,require,module,exports) {\\n'use strict';\\n\\nrequire('@firebase/installations');\\nvar component = require('@firebase/component');\\nvar util = require('@firebase/util');\\nvar tslib = require('tslib');\\nvar idb = require('idb');\\nvar firebase = require('@firebase/app');\\n\\nfunction _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }\\n\\nvar firebase__default = /*#__PURE__*/_interopDefaultLegacy(firebase);\\n\\n/**\\r\\n * @license\\r\\n * Copyright 2017 Google LLC\\r\\n *\\r\\n * Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\\r\\n * you may not use this file except in compliance with the License.\\r\\n * You may obtain a copy of the License at\\r\\n *\\r\\n *   http://www.apache.org/licenses/LICENSE-2.0\\r\\n *\\r\\n * Unless required by applicable law or agreed to in writing, software\\r\\n * distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\r\\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\r\\n * See the License for the specific language governing permissions and\\r\\n * limitations under the License.\\r\\n */\\r\\nvar _a;\\r\\nvar ERROR_MAP = (_a = {},\\r\\n    _a[\\\"missing-app-config-values\\\" /* MISSING_APP_CONFIG_VALUES */] = 'Missing App configuration value: \\\"{$valueName}\\\"',\\r\\n    _a[\\\"only-available-in-window\\\" /* AVAILABLE_IN_WINDOW */] = 'This method is available in a Window context.',\\r\\n    _a[\\\"only-available-in-sw\\\" /* AVAILABLE_IN_SW */] = 'This method is available in a service worker context.',\\r\\n    _a[\\\"permission-default\\\" /* PERMISSION_DEFAULT */] = 'The notification permission was not granted and dismissed instead.',\\r\\n    _a[\\\"permission-blocked\\\" /* PERMISSION_BLOCKED */] = 'The notification permission was not granted and blocked instead.',\\r\\n    _a[\\\"unsupported-browser\\\" /* UNSUPPORTED_BROWSER */] = \\\"This browser doesn't support the API's required to use the firebase SDK.\\\",\\r\\n    _a[\\\"failed-service-worker-registration\\\" /* FAILED_DEFAULT_REGISTRATION */] = 'We are unable to register the default service worker. {$browserErrorMessage}',\\r\\n    _a[\\\"token-subscribe-failed\\\" /* TOKEN_SUBSCRIBE_FAILED */] = 'A problem occurred while subscribing the user to FCM: {$errorInfo}',\\r\\n    _a[\\\"token-subscribe-no-token\\\" /* TOKEN_SUBSCRIBE_NO_TOKEN */] = 'FCM returned no token when subscribing the user to push.',\\r\\n    _a[\\\"token-unsubscribe-failed\\\" /* TOKEN_UNSUBSCRIBE_FAILED */] = 'A problem occurred while unsubscribing the ' +\\r\\n        'user from FCM: {$errorInfo}',\\r\\n    _a[\\\"token-update-failed\\\" /* TOKEN_UPDATE_FAILED */] = 'A problem occurred while updating the user from FCM: {$errorInfo}',\\r\\n    _a[\\\"token-update-no-token\\\" /* TOKEN_UPDATE_NO_TOKEN */] = 'FCM returned no token when updating the user to push.',\\r\\n    _a[\\\"use-sw-after-get-token\\\" /* USE_SW_AFTER_GET_TOKEN */] = 'The useServiceWorker() method may only be called once and must be ' +\\r\\n        'called before calling getToken() to ensure your service worker is used.',\\r\\n    _a[\\\"invalid-sw-registration\\\" /* INVALID_SW_REGISTRATION */] = 'The input to useServiceWorker() must be a ServiceWorkerRegistration.',\\r\\n    _a[\\\"invalid-bg-handler\\\" /* INVALID_BG_HANDLER */] = 'The input to setBackgroundMessageHandler() must be a function.',\\r\\n    _a[\\\"invalid-vapid-key\\\" /* INVALID_VAPID_KEY */] = 'The public VAPID key must be a string.',\\r\\n    _a[\\\"use-vapid-key-after-get-token\\\" /* USE_VAPID_KEY_AFTER_GET_TOKEN */] = 'The usePublicVapidKey() method may only be called once and must be ' +\\r\\n        'called before calling getToken() to ensure your VAPID key is used.',\\r\\n    _a);\\r\\nvar ERROR_FACTORY = new util.ErrorFactory('messaging', 'Messaging', ERROR_MAP);\\n\\n/**\\r\\n * @license\\r\\n * Copyright 2019 Google LLC\\r\\n *\\r\\n * Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\\r\\n * you may not use this file except in compliance with the License.\\r\\n * You may obtain a copy of the License at\\r\\n *\\r\\n *   http://www.apache.org/licenses/LICENSE-2.0\\r\\n *\\r\\n * Unless required by applicable law or agreed to in writing, software\\r\\n * distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\r\\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\r\\n * See the License for the specific language governing permissions and\\r\\n * limitations under the License.\\r\\n */\\r\\nvar DEFAULT_SW_PATH = '/firebase-messaging-sw.js';\\r\\nvar DEFAULT_SW_SCOPE = '/firebase-cloud-messaging-push-scope';\\r\\nvar DEFAULT_VAPID_KEY = 'BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4';\\r\\nvar ENDPOINT = 'https://fcmregistrations.googleapis.com/v1';\\r\\n// Key of FCM Payload in Notification's data field.\\r\\nvar FCM_MSG = 'FCM_MSG';\\r\\nvar TAG = 'FirebaseMessaging: ';\\r\\n// Set to '1' if Analytics is enabled for the campaign\\r\\nvar CONSOLE_CAMPAIGN_ANALYTICS_ENABLED = 'google.c.a.e';\\r\\nvar CONSOLE_CAMPAIGN_ID = 'google.c.a.c_id';\\r\\nvar CONSOLE_CAMPAIGN_TIME = 'google.c.a.ts';\\r\\nvar CONSOLE_CAMPAIGN_NAME = 'google.c.a.c_l';\\r\\n// Due to the fact that onBackgroundMessage can't be awaited (to support rxjs), a silent push\\r\\n// warning might be shown by the browser if the callback fails to completes by the end of onPush.\\r\\n// Experiments were ran to determine the majority onBackground message clock time. This brief\\r\\n// blocking time would allow majority of the onBackgroundMessage callback to finish.\\r\\nvar BACKGROUND_HANDLE_EXECUTION_TIME_LIMIT_MS = 1000;\\r\\n// Preparation time for client to initialize and set up the message handler.\\r\\nvar FOREGROUND_HANDLE_PREPARATION_TIME_MS = 3000;\\n\\n/**\\r\\n * @license\\r\\n * Copyright 2018 Google LLC\\r\\n *\\r\\n * Licensed under the Apache License, Version 2.0 (the \\\"License\\\"); you may not use this file except\\r\\n * in compliance with the License. You may obtain a copy of the License at\\r\\n *\\r\\n * http://www.apache.org/licenses/LICENSE-2.0\\r\\n *\\r\\n * Unless required by applicable law or agreed to in writing, software distributed under the License\\r\\n * is distributed on an \\\"AS IS\\\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\\r\\n * or implied. See the License for the specific language governing permissions and limitations under\\r\\n * the License.\\r\\n */\\r\\nvar MessageType;\\r\\n(function (MessageType) {\\r\\n    MessageType[\\\"PUSH_RECEIVED\\\"] = \\\"push-received\\\";\\r\\n    MessageType[\\\"NOTIFICATION_CLICKED\\\"] = \\\"notification-clicked\\\";\\r\\n})(MessageType || (MessageType = {}));\\n\\n/**\\r\\n * @license\\r\\n * Copyright 2017 Google LLC\\r\\n *\\r\\n * Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\\r\\n * you may not use this file except in compliance with the License.\\r\\n * You may obtain a copy of the License at\\r\\n *\\r\\n *   http://www.apache.org/licenses/LICENSE-2.0\\r\\n *\\r\\n * Unless required by applicable law or agreed to in writing, software\\r\\n * distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\r\\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\r\\n * See the License for the specific language governing permissions and\\r\\n * limitations under the License.\\r\\n */\\r\\nfunction arrayToBase64(array) {\\r\\n    var uint8Array = new Uint8Array(array);\\r\\n    var base64String = btoa(String.fromCharCode.apply(String, tslib.__spreadArray([], tslib.__read(uint8Array))));\\r\\n    return base64String.replace(/=/g, '').replace(/\\\\+/g, '-').replace(/\\\\//g, '_');\\r\\n}\\r\\nfunction base64ToArray(base64String) {\\r\\n    var padding = '='.repeat((4 - (base64String.length % 4)) % 4);\\r\\n    var base64 = (base64String + padding)\\r\\n        .replace(/\\\\-/g, '+')\\r\\n        .replace(/_/g, '/');\\r\\n    var rawData = atob(base64);\\r\\n    var outputArray = new Uint8Array(rawData.length);\\r\\n    for (var i = 0; i < rawData.length; ++i) {\\r\\n        outputArray[i] = rawData.charCodeAt(i);\\r\\n    }\\r\\n    return outputArray;\\r\\n}\\n\\n/**\\r\\n * @license\\r\\n * Copyright 2019 Google LLC\\r\\n *\\r\\n * Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\\r\\n * you may not use this file except in compliance with the License.\\r\\n * You may obtain a copy of the License at\\r\\n *\\r\\n *   http://www.apache.org/licenses/LICENSE-2.0\\r\\n *\\r\\n * Unless required by applicable law or agreed to in writing, software\\r\\n * distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\r\\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\r\\n * See the License for the specific language governing permissions and\\r\\n * limitations under the License.\\r\\n */\\r\\nvar OLD_DB_NAME = 'fcm_token_details_db';\\r\\n/**\\r\\n * The last DB version of 'fcm_token_details_db' was 4. This is one higher, so that the upgrade\\r\\n * callback is called for all versions of the old DB.\\r\\n */\\r\\nvar OLD_DB_VERSION = 5;\\r\\nvar OLD_OBJECT_STORE_NAME = 'fcm_token_object_Store';\\r\\nfunction migrateOldDatabase(senderId) {\\r\\n    return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n        var databases, dbNames, tokenDetails, db;\\r\\n        var _this = this;\\r\\n        return tslib.__generator(this, function (_a) {\\r\\n            switch (_a.label) {\\r\\n                case 0:\\r\\n                    if (!('databases' in indexedDB)) return [3 /*break*/, 2];\\r\\n                    return [4 /*yield*/, indexedDB.databases()];\\r\\n                case 1:\\r\\n                    databases = _a.sent();\\r\\n                    dbNames = databases.map(function (db) { return db.name; });\\r\\n                    if (!dbNames.includes(OLD_DB_NAME)) {\\r\\n                        // old DB didn't exist, no need to open.\\r\\n                        return [2 /*return*/, null];\\r\\n                    }\\r\\n                    _a.label = 2;\\r\\n                case 2:\\r\\n                    tokenDetails = null;\\r\\n                    return [4 /*yield*/, idb.openDb(OLD_DB_NAME, OLD_DB_VERSION, function (db) { return tslib.__awaiter(_this, void 0, void 0, function () {\\r\\n                            var objectStore, value, oldDetails, oldDetails, oldDetails;\\r\\n                            var _a;\\r\\n                            return tslib.__generator(this, function (_b) {\\r\\n                                switch (_b.label) {\\r\\n                                    case 0:\\r\\n                                        if (db.oldVersion < 2) {\\r\\n                                            // Database too old, skip migration.\\r\\n                                            return [2 /*return*/];\\r\\n                                        }\\r\\n                                        if (!db.objectStoreNames.contains(OLD_OBJECT_STORE_NAME)) {\\r\\n                                            // Database did not exist. Nothing to do.\\r\\n                                            return [2 /*return*/];\\r\\n                                        }\\r\\n                                        objectStore = db.transaction.objectStore(OLD_OBJECT_STORE_NAME);\\r\\n                                        return [4 /*yield*/, objectStore.index('fcmSenderId').get(senderId)];\\r\\n                                    case 1:\\r\\n                                        value = _b.sent();\\r\\n                                        return [4 /*yield*/, objectStore.clear()];\\r\\n                                    case 2:\\r\\n                                        _b.sent();\\r\\n                                        if (!value) {\\r\\n                                            // No entry in the database, nothing to migrate.\\r\\n                                            return [2 /*return*/];\\r\\n                                        }\\r\\n                                        if (db.oldVersion === 2) {\\r\\n                                            oldDetails = value;\\r\\n                                            if (!oldDetails.auth || !oldDetails.p256dh || !oldDetails.endpoint) {\\r\\n                                                return [2 /*return*/];\\r\\n                                            }\\r\\n                                            tokenDetails = {\\r\\n                                                token: oldDetails.fcmToken,\\r\\n                                                createTime: (_a = oldDetails.createTime) !== null && _a !== void 0 ? _a : Date.now(),\\r\\n                                                subscriptionOptions: {\\r\\n                                                    auth: oldDetails.auth,\\r\\n                                                    p256dh: oldDetails.p256dh,\\r\\n                                                    endpoint: oldDetails.endpoint,\\r\\n                                                    swScope: oldDetails.swScope,\\r\\n                                                    vapidKey: typeof oldDetails.vapidKey === 'string'\\r\\n                                                        ? oldDetails.vapidKey\\r\\n                                                        : arrayToBase64(oldDetails.vapidKey)\\r\\n                                                }\\r\\n                                            };\\r\\n                                        }\\r\\n                                        else if (db.oldVersion === 3) {\\r\\n                                            oldDetails = value;\\r\\n                                            tokenDetails = {\\r\\n                                                token: oldDetails.fcmToken,\\r\\n                                                createTime: oldDetails.createTime,\\r\\n                                                subscriptionOptions: {\\r\\n                                                    auth: arrayToBase64(oldDetails.auth),\\r\\n                                                    p256dh: arrayToBase64(oldDetails.p256dh),\\r\\n                                                    endpoint: oldDetails.endpoint,\\r\\n                                                    swScope: oldDetails.swScope,\\r\\n                                                    vapidKey: arrayToBase64(oldDetails.vapidKey)\\r\\n                                                }\\r\\n                                            };\\r\\n                                        }\\r\\n                                        else if (db.oldVersion === 4) {\\r\\n                                            oldDetails = value;\\r\\n                                            tokenDetails = {\\r\\n                                                token: oldDetails.fcmToken,\\r\\n                                                createTime: oldDetails.createTime,\\r\\n                                                subscriptionOptions: {\\r\\n                                                    auth: arrayToBase64(oldDetails.auth),\\r\\n                                                    p256dh: arrayToBase64(oldDetails.p256dh),\\r\\n                                                    endpoint: oldDetails.endpoint,\\r\\n                                                    swScope: oldDetails.swScope,\\r\\n                                                    vapidKey: arrayToBase64(oldDetails.vapidKey)\\r\\n                                                }\\r\\n                                            };\\r\\n                                        }\\r\\n                                        return [2 /*return*/];\\r\\n                                }\\r\\n                            });\\r\\n                        }); })];\\r\\n                case 3:\\r\\n                    db = _a.sent();\\r\\n                    db.close();\\r\\n                    // Delete all old databases.\\r\\n                    return [4 /*yield*/, idb.deleteDb(OLD_DB_NAME)];\\r\\n                case 4:\\r\\n                    // Delete all old databases.\\r\\n                    _a.sent();\\r\\n                    return [4 /*yield*/, idb.deleteDb('fcm_vapid_details_db')];\\r\\n                case 5:\\r\\n                    _a.sent();\\r\\n                    return [4 /*yield*/, idb.deleteDb('undefined')];\\r\\n                case 6:\\r\\n                    _a.sent();\\r\\n                    return [2 /*return*/, checkTokenDetails(tokenDetails) ? tokenDetails : null];\\r\\n            }\\r\\n        });\\r\\n    });\\r\\n}\\r\\nfunction checkTokenDetails(tokenDetails) {\\r\\n    if (!tokenDetails || !tokenDetails.subscriptionOptions) {\\r\\n        return false;\\r\\n    }\\r\\n    var subscriptionOptions = tokenDetails.subscriptionOptions;\\r\\n    return (typeof tokenDetails.createTime === 'number' &&\\r\\n        tokenDetails.createTime > 0 &&\\r\\n        typeof tokenDetails.token === 'string' &&\\r\\n        tokenDetails.token.length > 0 &&\\r\\n        typeof subscriptionOptions.auth === 'string' &&\\r\\n        subscriptionOptions.auth.length > 0 &&\\r\\n        typeof subscriptionOptions.p256dh === 'string' &&\\r\\n        subscriptionOptions.p256dh.length > 0 &&\\r\\n        typeof subscriptionOptions.endpoint === 'string' &&\\r\\n        subscriptionOptions.endpoint.length > 0 &&\\r\\n        typeof subscriptionOptions.swScope === 'string' &&\\r\\n        subscriptionOptions.swScope.length > 0 &&\\r\\n        typeof subscriptionOptions.vapidKey === 'string' &&\\r\\n        subscriptionOptions.vapidKey.length > 0);\\r\\n}\\n\\n/**\\r\\n * @license\\r\\n * Copyright 2019 Google LLC\\r\\n *\\r\\n * Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\\r\\n * you may not use this file except in compliance with the License.\\r\\n * You may obtain a copy of the License at\\r\\n *\\r\\n *   http://www.apache.org/licenses/LICENSE-2.0\\r\\n *\\r\\n * Unless required by applicable law or agreed to in writing, software\\r\\n * distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\r\\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\r\\n * See the License for the specific language governing permissions and\\r\\n * limitations under the License.\\r\\n */\\r\\n// Exported for tests.\\r\\nvar DATABASE_NAME = 'firebase-messaging-database';\\r\\nvar DATABASE_VERSION = 1;\\r\\nvar OBJECT_STORE_NAME = 'firebase-messaging-store';\\r\\nvar dbPromise = null;\\r\\nfunction getDbPromise() {\\r\\n    if (!dbPromise) {\\r\\n        dbPromise = idb.openDb(DATABASE_NAME, DATABASE_VERSION, function (upgradeDb) {\\r\\n            // We don't use 'break' in this switch statement, the fall-through behavior is what we want,\\r\\n            // because if there are multiple versions between the old version and the current version, we\\r\\n            // want ALL the migrations that correspond to those versions to run, not only the last one.\\r\\n            // eslint-disable-next-line default-case\\r\\n            switch (upgradeDb.oldVersion) {\\r\\n                case 0:\\r\\n                    upgradeDb.createObjectStore(OBJECT_STORE_NAME);\\r\\n            }\\r\\n        });\\r\\n    }\\r\\n    return dbPromise;\\r\\n}\\r\\n/** Gets record(s) from the objectStore that match the given key. */\\r\\nfunction dbGet(firebaseDependencies) {\\r\\n    return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n        var key, db, tokenDetails, oldTokenDetails;\\r\\n        return tslib.__generator(this, function (_a) {\\r\\n            switch (_a.label) {\\r\\n                case 0:\\r\\n                    key = getKey(firebaseDependencies);\\r\\n                    return [4 /*yield*/, getDbPromise()];\\r\\n                case 1:\\r\\n                    db = _a.sent();\\r\\n                    return [4 /*yield*/, db\\r\\n                            .transaction(OBJECT_STORE_NAME)\\r\\n                            .objectStore(OBJECT_STORE_NAME)\\r\\n                            .get(key)];\\r\\n                case 2:\\r\\n                    tokenDetails = _a.sent();\\r\\n                    if (!tokenDetails) return [3 /*break*/, 3];\\r\\n                    return [2 /*return*/, tokenDetails];\\r\\n                case 3: return [4 /*yield*/, migrateOldDatabase(firebaseDependencies.appConfig.senderId)];\\r\\n                case 4:\\r\\n                    oldTokenDetails = _a.sent();\\r\\n                    if (!oldTokenDetails) return [3 /*break*/, 6];\\r\\n                    return [4 /*yield*/, dbSet(firebaseDependencies, oldTokenDetails)];\\r\\n                case 5:\\r\\n                    _a.sent();\\r\\n                    return [2 /*return*/, oldTokenDetails];\\r\\n                case 6: return [2 /*return*/];\\r\\n            }\\r\\n        });\\r\\n    });\\r\\n}\\r\\n/** Assigns or overwrites the record for the given key with the given value. */\\r\\nfunction dbSet(firebaseDependencies, tokenDetails) {\\r\\n    return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n        var key, db, tx;\\r\\n        return tslib.__generator(this, function (_a) {\\r\\n            switch (_a.label) {\\r\\n                case 0:\\r\\n                    key = getKey(firebaseDependencies);\\r\\n                    return [4 /*yield*/, getDbPromise()];\\r\\n                case 1:\\r\\n                    db = _a.sent();\\r\\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\\r\\n                    return [4 /*yield*/, tx.objectStore(OBJECT_STORE_NAME).put(tokenDetails, key)];\\r\\n                case 2:\\r\\n                    _a.sent();\\r\\n                    return [4 /*yield*/, tx.complete];\\r\\n                case 3:\\r\\n                    _a.sent();\\r\\n                    return [2 /*return*/, tokenDetails];\\r\\n            }\\r\\n        });\\r\\n    });\\r\\n}\\r\\n/** Removes record(s) from the objectStore that match the given key. */\\r\\nfunction dbRemove(firebaseDependencies) {\\r\\n    return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n        var key, db, tx;\\r\\n        return tslib.__generator(this, function (_a) {\\r\\n            switch (_a.label) {\\r\\n                case 0:\\r\\n                    key = getKey(firebaseDependencies);\\r\\n                    return [4 /*yield*/, getDbPromise()];\\r\\n                case 1:\\r\\n                    db = _a.sent();\\r\\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\\r\\n                    return [4 /*yield*/, tx.objectStore(OBJECT_STORE_NAME).delete(key)];\\r\\n                case 2:\\r\\n                    _a.sent();\\r\\n                    return [4 /*yield*/, tx.complete];\\r\\n                case 3:\\r\\n                    _a.sent();\\r\\n                    return [2 /*return*/];\\r\\n            }\\r\\n        });\\r\\n    });\\r\\n}\\r\\nfunction getKey(_a) {\\r\\n    var appConfig = _a.appConfig;\\r\\n    return appConfig.appId;\\r\\n}\\n\\n/**\\r\\n * @license\\r\\n * Copyright 2019 Google LLC\\r\\n *\\r\\n * Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\\r\\n * you may not use this file except in compliance with the License.\\r\\n * You may obtain a copy of the License at\\r\\n *\\r\\n *   http://www.apache.org/licenses/LICENSE-2.0\\r\\n *\\r\\n * Unless required by applicable law or agreed to in writing, software\\r\\n * distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\r\\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\r\\n * See the License for the specific language governing permissions and\\r\\n * limitations under the License.\\r\\n */\\r\\nfunction requestGetToken(firebaseDependencies, subscriptionOptions) {\\r\\n    return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n        var headers, body, subscribeOptions, responseData, response, err_1, message;\\r\\n        return tslib.__generator(this, function (_a) {\\r\\n            switch (_a.label) {\\r\\n                case 0: return [4 /*yield*/, getHeaders(firebaseDependencies)];\\r\\n                case 1:\\r\\n                    headers = _a.sent();\\r\\n                    body = getBody(subscriptionOptions);\\r\\n                    subscribeOptions = {\\r\\n                        method: 'POST',\\r\\n                        headers: headers,\\r\\n                        body: JSON.stringify(body)\\r\\n                    };\\r\\n                    _a.label = 2;\\r\\n                case 2:\\r\\n                    _a.trys.push([2, 5, , 6]);\\r\\n                    return [4 /*yield*/, fetch(getEndpoint(firebaseDependencies.appConfig), subscribeOptions)];\\r\\n                case 3:\\r\\n                    response = _a.sent();\\r\\n                    return [4 /*yield*/, response.json()];\\r\\n                case 4:\\r\\n                    responseData = _a.sent();\\r\\n                    return [3 /*break*/, 6];\\r\\n                case 5:\\r\\n                    err_1 = _a.sent();\\r\\n                    throw ERROR_FACTORY.create(\\\"token-subscribe-failed\\\" /* TOKEN_SUBSCRIBE_FAILED */, {\\r\\n                        errorInfo: err_1\\r\\n                    });\\r\\n                case 6:\\r\\n                    if (responseData.error) {\\r\\n                        message = responseData.error.message;\\r\\n                        throw ERROR_FACTORY.create(\\\"token-subscribe-failed\\\" /* TOKEN_SUBSCRIBE_FAILED */, {\\r\\n                            errorInfo: message\\r\\n                        });\\r\\n                    }\\r\\n                    if (!responseData.token) {\\r\\n                        throw ERROR_FACTORY.create(\\\"token-subscribe-no-token\\\" /* TOKEN_SUBSCRIBE_NO_TOKEN */);\\r\\n                    }\\r\\n                    return [2 /*return*/, responseData.token];\\r\\n            }\\r\\n        });\\r\\n    });\\r\\n}\\r\\nfunction requestUpdateToken(firebaseDependencies, tokenDetails) {\\r\\n    return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n        var headers, body, updateOptions, responseData, response, err_2, message;\\r\\n        return tslib.__generator(this, function (_a) {\\r\\n            switch (_a.label) {\\r\\n                case 0: return [4 /*yield*/, getHeaders(firebaseDependencies)];\\r\\n                case 1:\\r\\n                    headers = _a.sent();\\r\\n                    body = getBody(tokenDetails.subscriptionOptions);\\r\\n                    updateOptions = {\\r\\n                        method: 'PATCH',\\r\\n                        headers: headers,\\r\\n                        body: JSON.stringify(body)\\r\\n                    };\\r\\n                    _a.label = 2;\\r\\n                case 2:\\r\\n                    _a.trys.push([2, 5, , 6]);\\r\\n                    return [4 /*yield*/, fetch(getEndpoint(firebaseDependencies.appConfig) + \\\"/\\\" + tokenDetails.token, updateOptions)];\\r\\n                case 3:\\r\\n                    response = _a.sent();\\r\\n                    return [4 /*yield*/, response.json()];\\r\\n                case 4:\\r\\n                    responseData = _a.sent();\\r\\n                    return [3 /*break*/, 6];\\r\\n                case 5:\\r\\n                    err_2 = _a.sent();\\r\\n                    throw ERROR_FACTORY.create(\\\"token-update-failed\\\" /* TOKEN_UPDATE_FAILED */, {\\r\\n                        errorInfo: err_2\\r\\n                    });\\r\\n                case 6:\\r\\n                    if (responseData.error) {\\r\\n                        message = responseData.error.message;\\r\\n                        throw ERROR_FACTORY.create(\\\"token-update-failed\\\" /* TOKEN_UPDATE_FAILED */, {\\r\\n                            errorInfo: message\\r\\n                        });\\r\\n                    }\\r\\n                    if (!responseData.token) {\\r\\n                        throw ERROR_FACTORY.create(\\\"token-update-no-token\\\" /* TOKEN_UPDATE_NO_TOKEN */);\\r\\n                    }\\r\\n                    return [2 /*return*/, responseData.token];\\r\\n            }\\r\\n        });\\r\\n    });\\r\\n}\\r\\nfunction requestDeleteToken(firebaseDependencies, token) {\\r\\n    return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n        var headers, unsubscribeOptions, response, responseData, message, err_3;\\r\\n        return tslib.__generator(this, function (_a) {\\r\\n            switch (_a.label) {\\r\\n                case 0: return [4 /*yield*/, getHeaders(firebaseDependencies)];\\r\\n                case 1:\\r\\n                    headers = _a.sent();\\r\\n                    unsubscribeOptions = {\\r\\n                        method: 'DELETE',\\r\\n                        headers: headers\\r\\n                    };\\r\\n                    _a.label = 2;\\r\\n                case 2:\\r\\n                    _a.trys.push([2, 5, , 6]);\\r\\n                    return [4 /*yield*/, fetch(getEndpoint(firebaseDependencies.appConfig) + \\\"/\\\" + token, unsubscribeOptions)];\\r\\n                case 3:\\r\\n                    response = _a.sent();\\r\\n                    return [4 /*yield*/, response.json()];\\r\\n                case 4:\\r\\n                    responseData = _a.sent();\\r\\n                    if (responseData.error) {\\r\\n                        message = responseData.error.message;\\r\\n                        throw ERROR_FACTORY.create(\\\"token-unsubscribe-failed\\\" /* TOKEN_UNSUBSCRIBE_FAILED */, {\\r\\n                            errorInfo: message\\r\\n                        });\\r\\n                    }\\r\\n                    return [3 /*break*/, 6];\\r\\n                case 5:\\r\\n                    err_3 = _a.sent();\\r\\n                    throw ERROR_FACTORY.create(\\\"token-unsubscribe-failed\\\" /* TOKEN_UNSUBSCRIBE_FAILED */, {\\r\\n                        errorInfo: err_3\\r\\n                    });\\r\\n                case 6: return [2 /*return*/];\\r\\n            }\\r\\n        });\\r\\n    });\\r\\n}\\r\\nfunction getEndpoint(_a) {\\r\\n    var projectId = _a.projectId;\\r\\n    return ENDPOINT + \\\"/projects/\\\" + projectId + \\\"/registrations\\\";\\r\\n}\\r\\nfunction getHeaders(_a) {\\r\\n    var appConfig = _a.appConfig, installations = _a.installations;\\r\\n    return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n        var authToken;\\r\\n        return tslib.__generator(this, function (_b) {\\r\\n            switch (_b.label) {\\r\\n                case 0: return [4 /*yield*/, installations.getToken()];\\r\\n                case 1:\\r\\n                    authToken = _b.sent();\\r\\n                    return [2 /*return*/, new Headers({\\r\\n                            'Content-Type': 'application/json',\\r\\n                            Accept: 'application/json',\\r\\n                            'x-goog-api-key': appConfig.apiKey,\\r\\n                            'x-goog-firebase-installations-auth': \\\"FIS \\\" + authToken\\r\\n                        })];\\r\\n            }\\r\\n        });\\r\\n    });\\r\\n}\\r\\nfunction getBody(_a) {\\r\\n    var p256dh = _a.p256dh, auth = _a.auth, endpoint = _a.endpoint, vapidKey = _a.vapidKey;\\r\\n    var body = {\\r\\n        web: {\\r\\n            endpoint: endpoint,\\r\\n            auth: auth,\\r\\n            p256dh: p256dh\\r\\n        }\\r\\n    };\\r\\n    if (vapidKey !== DEFAULT_VAPID_KEY) {\\r\\n        body.web.applicationPubKey = vapidKey;\\r\\n    }\\r\\n    return body;\\r\\n}\\n\\n/**\\r\\n * @license\\r\\n * Copyright 2019 Google LLC\\r\\n *\\r\\n * Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\\r\\n * you may not use this file except in compliance with the License.\\r\\n * You may obtain a copy of the License at\\r\\n *\\r\\n *   http://www.apache.org/licenses/LICENSE-2.0\\r\\n *\\r\\n * Unless required by applicable law or agreed to in writing, software\\r\\n * distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\r\\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\r\\n * See the License for the specific language governing permissions and\\r\\n * limitations under the License.\\r\\n */\\r\\n/** UpdateRegistration will be called once every week. */\\r\\nvar TOKEN_EXPIRATION_MS = 7 * 24 * 60 * 60 * 1000; // 7 days\\r\\nfunction getToken(firebaseDependencies, swRegistration, vapidKey) {\\r\\n    return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n        var pushSubscription, tokenDetails, subscriptionOptions, e_1;\\r\\n        return tslib.__generator(this, function (_a) {\\r\\n            switch (_a.label) {\\r\\n                case 0:\\r\\n                    if (Notification.permission !== 'granted') {\\r\\n                        throw ERROR_FACTORY.create(\\\"permission-blocked\\\" /* PERMISSION_BLOCKED */);\\r\\n                    }\\r\\n                    return [4 /*yield*/, getPushSubscription(swRegistration, vapidKey)];\\r\\n                case 1:\\r\\n                    pushSubscription = _a.sent();\\r\\n                    return [4 /*yield*/, dbGet(firebaseDependencies)];\\r\\n                case 2:\\r\\n                    tokenDetails = _a.sent();\\r\\n                    subscriptionOptions = {\\r\\n                        vapidKey: vapidKey,\\r\\n                        swScope: swRegistration.scope,\\r\\n                        endpoint: pushSubscription.endpoint,\\r\\n                        auth: arrayToBase64(pushSubscription.getKey('auth')),\\r\\n                        p256dh: arrayToBase64(pushSubscription.getKey('p256dh'))\\r\\n                    };\\r\\n                    if (!!tokenDetails) return [3 /*break*/, 3];\\r\\n                    // No token, get a new one.\\r\\n                    return [2 /*return*/, getNewToken(firebaseDependencies, subscriptionOptions)];\\r\\n                case 3:\\r\\n                    if (!!isTokenValid(tokenDetails.subscriptionOptions, subscriptionOptions)) return [3 /*break*/, 8];\\r\\n                    _a.label = 4;\\r\\n                case 4:\\r\\n                    _a.trys.push([4, 6, , 7]);\\r\\n                    return [4 /*yield*/, requestDeleteToken(firebaseDependencies, tokenDetails.token)];\\r\\n                case 5:\\r\\n                    _a.sent();\\r\\n                    return [3 /*break*/, 7];\\r\\n                case 6:\\r\\n                    e_1 = _a.sent();\\r\\n                    // Suppress errors because of #2364\\r\\n                    console.warn(e_1);\\r\\n                    return [3 /*break*/, 7];\\r\\n                case 7: return [2 /*return*/, getNewToken(firebaseDependencies, subscriptionOptions)];\\r\\n                case 8:\\r\\n                    if (Date.now() >= tokenDetails.createTime + TOKEN_EXPIRATION_MS) {\\r\\n                        // Weekly token refresh\\r\\n                        return [2 /*return*/, updateToken({\\r\\n                                token: tokenDetails.token,\\r\\n                                createTime: Date.now(),\\r\\n                                subscriptionOptions: subscriptionOptions\\r\\n                            }, firebaseDependencies, swRegistration)];\\r\\n                    }\\r\\n                    else {\\r\\n                        // Valid token, nothing to do.\\r\\n                        return [2 /*return*/, tokenDetails.token];\\r\\n                    }\\r\\n                case 9: return [2 /*return*/];\\r\\n            }\\r\\n        });\\r\\n    });\\r\\n}\\r\\n/**\\r\\n * This method deletes the token from the database, unsubscribes the token from FCM, and unregisters\\r\\n * the push subscription if it exists.\\r\\n */\\r\\nfunction deleteToken(firebaseDependencies, swRegistration) {\\r\\n    return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n        var tokenDetails, pushSubscription;\\r\\n        return tslib.__generator(this, function (_a) {\\r\\n            switch (_a.label) {\\r\\n                case 0: return [4 /*yield*/, dbGet(firebaseDependencies)];\\r\\n                case 1:\\r\\n                    tokenDetails = _a.sent();\\r\\n                    if (!tokenDetails) return [3 /*break*/, 4];\\r\\n                    return [4 /*yield*/, requestDeleteToken(firebaseDependencies, tokenDetails.token)];\\r\\n                case 2:\\r\\n                    _a.sent();\\r\\n                    return [4 /*yield*/, dbRemove(firebaseDependencies)];\\r\\n                case 3:\\r\\n                    _a.sent();\\r\\n                    _a.label = 4;\\r\\n                case 4: return [4 /*yield*/, swRegistration.pushManager.getSubscription()];\\r\\n                case 5:\\r\\n                    pushSubscription = _a.sent();\\r\\n                    if (pushSubscription) {\\r\\n                        return [2 /*return*/, pushSubscription.unsubscribe()];\\r\\n                    }\\r\\n                    // If there's no SW, consider it a success.\\r\\n                    return [2 /*return*/, true];\\r\\n            }\\r\\n        });\\r\\n    });\\r\\n}\\r\\nfunction updateToken(tokenDetails, firebaseDependencies, swRegistration) {\\r\\n    return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n        var updatedToken, updatedTokenDetails, e_2;\\r\\n        return tslib.__generator(this, function (_a) {\\r\\n            switch (_a.label) {\\r\\n                case 0:\\r\\n                    _a.trys.push([0, 3, , 5]);\\r\\n                    return [4 /*yield*/, requestUpdateToken(firebaseDependencies, tokenDetails)];\\r\\n                case 1:\\r\\n                    updatedToken = _a.sent();\\r\\n                    updatedTokenDetails = tslib.__assign(tslib.__assign({}, tokenDetails), { token: updatedToken, createTime: Date.now() });\\r\\n                    return [4 /*yield*/, dbSet(firebaseDependencies, updatedTokenDetails)];\\r\\n                case 2:\\r\\n                    _a.sent();\\r\\n                    return [2 /*return*/, updatedToken];\\r\\n                case 3:\\r\\n                    e_2 = _a.sent();\\r\\n                    return [4 /*yield*/, deleteToken(firebaseDependencies, swRegistration)];\\r\\n                case 4:\\r\\n                    _a.sent();\\r\\n                    throw e_2;\\r\\n                case 5: return [2 /*return*/];\\r\\n            }\\r\\n        });\\r\\n    });\\r\\n}\\r\\nfunction getNewToken(firebaseDependencies, subscriptionOptions) {\\r\\n    return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n        var token, tokenDetails;\\r\\n        return tslib.__generator(this, function (_a) {\\r\\n            switch (_a.label) {\\r\\n                case 0: return [4 /*yield*/, requestGetToken(firebaseDependencies, subscriptionOptions)];\\r\\n                case 1:\\r\\n                    token = _a.sent();\\r\\n                    tokenDetails = {\\r\\n                        token: token,\\r\\n                        createTime: Date.now(),\\r\\n                        subscriptionOptions: subscriptionOptions\\r\\n                    };\\r\\n                    return [4 /*yield*/, dbSet(firebaseDependencies, tokenDetails)];\\r\\n                case 2:\\r\\n                    _a.sent();\\r\\n                    return [2 /*return*/, tokenDetails.token];\\r\\n            }\\r\\n        });\\r\\n    });\\r\\n}\\r\\n/**\\r\\n * Gets a PushSubscription for the current user.\\r\\n */\\r\\nfunction getPushSubscription(swRegistration, vapidKey) {\\r\\n    return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n        var subscription;\\r\\n        return tslib.__generator(this, function (_a) {\\r\\n            switch (_a.label) {\\r\\n                case 0: return [4 /*yield*/, swRegistration.pushManager.getSubscription()];\\r\\n                case 1:\\r\\n                    subscription = _a.sent();\\r\\n                    if (subscription) {\\r\\n                        return [2 /*return*/, subscription];\\r\\n                    }\\r\\n                    return [2 /*return*/, swRegistration.pushManager.subscribe({\\r\\n                            userVisibleOnly: true,\\r\\n                            // Chrome <= 75 doesn't support base64-encoded VAPID key. For backward compatibility, VAPID key\\r\\n                            // submitted to pushManager#subscribe must be of type Uint8Array.\\r\\n                            applicationServerKey: base64ToArray(vapidKey)\\r\\n                        })];\\r\\n            }\\r\\n        });\\r\\n    });\\r\\n}\\r\\n/**\\r\\n * Checks if the saved tokenDetails object matches the configuration provided.\\r\\n */\\r\\nfunction isTokenValid(dbOptions, currentOptions) {\\r\\n    var isVapidKeyEqual = currentOptions.vapidKey === dbOptions.vapidKey;\\r\\n    var isEndpointEqual = currentOptions.endpoint === dbOptions.endpoint;\\r\\n    var isAuthEqual = currentOptions.auth === dbOptions.auth;\\r\\n    var isP256dhEqual = currentOptions.p256dh === dbOptions.p256dh;\\r\\n    return isVapidKeyEqual && isEndpointEqual && isAuthEqual && isP256dhEqual;\\r\\n}\\n\\n/**\\r\\n * @license\\r\\n * Copyright 2020 Google LLC\\r\\n *\\r\\n * Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\\r\\n * you may not use this file except in compliance with the License.\\r\\n * You may obtain a copy of the License at\\r\\n *\\r\\n *   http://www.apache.org/licenses/LICENSE-2.0\\r\\n *\\r\\n * Unless required by applicable law or agreed to in writing, software\\r\\n * distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\r\\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\r\\n * See the License for the specific language governing permissions and\\r\\n * limitations under the License.\\r\\n */\\r\\nfunction externalizePayload(internalPayload) {\\r\\n    var payload = {\\r\\n        from: internalPayload.from,\\r\\n        // eslint-disable-next-line camelcase\\r\\n        collapseKey: internalPayload.collapse_key\\r\\n    };\\r\\n    propagateNotificationPayload(payload, internalPayload);\\r\\n    propagateDataPayload(payload, internalPayload);\\r\\n    propagateFcmOptions(payload, internalPayload);\\r\\n    return payload;\\r\\n}\\r\\nfunction propagateNotificationPayload(payload, messagePayloadInternal) {\\r\\n    if (!messagePayloadInternal.notification) {\\r\\n        return;\\r\\n    }\\r\\n    payload.notification = {};\\r\\n    var title = messagePayloadInternal.notification.title;\\r\\n    if (!!title) {\\r\\n        payload.notification.title = title;\\r\\n    }\\r\\n    var body = messagePayloadInternal.notification.body;\\r\\n    if (!!body) {\\r\\n        payload.notification.body = body;\\r\\n    }\\r\\n    var image = messagePayloadInternal.notification.image;\\r\\n    if (!!image) {\\r\\n        payload.notification.image = image;\\r\\n    }\\r\\n}\\r\\nfunction propagateDataPayload(payload, messagePayloadInternal) {\\r\\n    if (!messagePayloadInternal.data) {\\r\\n        return;\\r\\n    }\\r\\n    payload.data = messagePayloadInternal.data;\\r\\n}\\r\\nfunction propagateFcmOptions(payload, messagePayloadInternal) {\\r\\n    if (!messagePayloadInternal.fcmOptions) {\\r\\n        return;\\r\\n    }\\r\\n    payload.fcmOptions = {};\\r\\n    var link = messagePayloadInternal.fcmOptions.link;\\r\\n    if (!!link) {\\r\\n        payload.fcmOptions.link = link;\\r\\n    }\\r\\n    // eslint-disable-next-line camelcase\\r\\n    var analyticsLabel = messagePayloadInternal.fcmOptions.analytics_label;\\r\\n    if (!!analyticsLabel) {\\r\\n        payload.fcmOptions.analyticsLabel = analyticsLabel;\\r\\n    }\\r\\n}\\n\\n/**\\r\\n * @license\\r\\n * Copyright 2019 Google LLC\\r\\n *\\r\\n * Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\\r\\n * you may not use this file except in compliance with the License.\\r\\n * You may obtain a copy of the License at\\r\\n *\\r\\n *   http://www.apache.org/licenses/LICENSE-2.0\\r\\n *\\r\\n * Unless required by applicable law or agreed to in writing, software\\r\\n * distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\r\\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\r\\n * See the License for the specific language governing permissions and\\r\\n * limitations under the License.\\r\\n */\\r\\nfunction isConsoleMessage(data) {\\r\\n    // This message has a campaign ID, meaning it was sent using the Firebase Console.\\r\\n    return typeof data === 'object' && !!data && CONSOLE_CAMPAIGN_ID in data;\\r\\n}\\n\\n/**\\r\\n * @license\\r\\n * Copyright 2019 Google LLC\\r\\n *\\r\\n * Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\\r\\n * you may not use this file except in compliance with the License.\\r\\n * You may obtain a copy of the License at\\r\\n *\\r\\n *   http://www.apache.org/licenses/LICENSE-2.0\\r\\n *\\r\\n * Unless required by applicable law or agreed to in writing, software\\r\\n * distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\r\\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\r\\n * See the License for the specific language governing permissions and\\r\\n * limitations under the License.\\r\\n */\\r\\n/** Returns a promise that resolves after given time passes. */\\r\\nfunction sleep(ms) {\\r\\n    return new Promise(function (resolve) {\\r\\n        setTimeout(resolve, ms);\\r\\n    });\\r\\n}\\n\\n/**\\r\\n * @license\\r\\n * Copyright 2017 Google LLC\\r\\n *\\r\\n * Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\\r\\n * you may not use this file except in compliance with the License.\\r\\n * You may obtain a copy of the License at\\r\\n *\\r\\n *   http://www.apache.org/licenses/LICENSE-2.0\\r\\n *\\r\\n * Unless required by applicable law or agreed to in writing, software\\r\\n * distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\r\\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\r\\n * See the License for the specific language governing permissions and\\r\\n * limitations under the License.\\r\\n */\\r\\nvar SwController = /** @class */ (function () {\\r\\n    function SwController(firebaseDependencies) {\\r\\n        var _this = this;\\r\\n        this.firebaseDependencies = firebaseDependencies;\\r\\n        // A boolean flag to determine wether an app is using onBackgroundMessage or\\r\\n        // setBackgroundMessageHandler. onBackgroundMessage will receive a MessagePayload regardless of if\\r\\n        // a notification is displayed. Whereas, setBackgroundMessageHandler will swallow the\\r\\n        // MessagePayload if a NotificationPayload is included.\\r\\n        this.isOnBackgroundMessageUsed = null;\\r\\n        this.vapidKey = null;\\r\\n        this.bgMessageHandler = null;\\r\\n        self.addEventListener('push', function (e) {\\r\\n            e.waitUntil(_this.onPush(e));\\r\\n        });\\r\\n        self.addEventListener('pushsubscriptionchange', function (e) {\\r\\n            e.waitUntil(_this.onSubChange(e));\\r\\n        });\\r\\n        self.addEventListener('notificationclick', function (e) {\\r\\n            e.waitUntil(_this.onNotificationClick(e));\\r\\n        });\\r\\n    }\\r\\n    Object.defineProperty(SwController.prototype, \\\"app\\\", {\\r\\n        get: function () {\\r\\n            return this.firebaseDependencies.app;\\r\\n        },\\r\\n        enumerable: false,\\r\\n        configurable: true\\r\\n    });\\r\\n    /**\\r\\n     * @deprecated. Use onBackgroundMessage(nextOrObserver: NextFn<object> | Observer<object>):\\r\\n     * Unsubscribe instead.\\r\\n     *\\r\\n     * Calling setBackgroundMessageHandler will opt in to some specific behaviors.\\r\\n     *\\r\\n     * 1.) If a notification doesn't need to be shown due to a window already being visible, then push\\r\\n     * messages will be sent to the page. 2.) If a notification needs to be shown, and the message\\r\\n     * contains no notification data this method will be called and the promise it returns will be\\r\\n     * passed to event.waitUntil. If you do not set this callback then all push messages will let and\\r\\n     * the developer can handle them in a their own 'push' event callback\\r\\n     *\\r\\n     * @param callback The callback to be called when a push message is received and a notification\\r\\n     * must be shown. The callback will be given the data from the push message.\\r\\n     */\\r\\n    SwController.prototype.setBackgroundMessageHandler = function (callback) {\\r\\n        this.isOnBackgroundMessageUsed = false;\\r\\n        if (!callback || typeof callback !== 'function') {\\r\\n            throw ERROR_FACTORY.create(\\\"invalid-bg-handler\\\" /* INVALID_BG_HANDLER */);\\r\\n        }\\r\\n        this.bgMessageHandler = callback;\\r\\n    };\\r\\n    SwController.prototype.onBackgroundMessage = function (nextOrObserver) {\\r\\n        var _this = this;\\r\\n        this.isOnBackgroundMessageUsed = true;\\r\\n        this.bgMessageHandler = nextOrObserver;\\r\\n        return function () {\\r\\n            _this.bgMessageHandler = null;\\r\\n        };\\r\\n    };\\r\\n    // TODO: Remove getToken from SW Controller. Calling this from an old SW can cause all kinds of\\r\\n    // trouble.\\r\\n    SwController.prototype.getToken = function () {\\r\\n        var _a, _b;\\r\\n        return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n            var tokenDetails;\\r\\n            return tslib.__generator(this, function (_c) {\\r\\n                switch (_c.label) {\\r\\n                    case 0:\\r\\n                        if (!!this.vapidKey) return [3 /*break*/, 2];\\r\\n                        return [4 /*yield*/, dbGet(this.firebaseDependencies)];\\r\\n                    case 1:\\r\\n                        tokenDetails = _c.sent();\\r\\n                        this.vapidKey =\\r\\n                            (_b = (_a = tokenDetails === null || tokenDetails === void 0 ? void 0 : tokenDetails.subscriptionOptions) === null || _a === void 0 ? void 0 : _a.vapidKey) !== null && _b !== void 0 ? _b : DEFAULT_VAPID_KEY;\\r\\n                        _c.label = 2;\\r\\n                    case 2: return [2 /*return*/, getToken(this.firebaseDependencies, self.registration, this.vapidKey)];\\r\\n                }\\r\\n            });\\r\\n        });\\r\\n    };\\r\\n    // TODO: Remove deleteToken from SW Controller. Calling this from an old SW can cause all kinds of\\r\\n    // trouble.\\r\\n    SwController.prototype.deleteToken = function () {\\r\\n        return deleteToken(this.firebaseDependencies, self.registration);\\r\\n    };\\r\\n    SwController.prototype.requestPermission = function () {\\r\\n        throw ERROR_FACTORY.create(\\\"only-available-in-window\\\" /* AVAILABLE_IN_WINDOW */);\\r\\n    };\\r\\n    // TODO: Remove this together with getToken from SW Controller.\\r\\n    SwController.prototype.usePublicVapidKey = function (vapidKey) {\\r\\n        if (this.vapidKey !== null) {\\r\\n            throw ERROR_FACTORY.create(\\\"use-vapid-key-after-get-token\\\" /* USE_VAPID_KEY_AFTER_GET_TOKEN */);\\r\\n        }\\r\\n        if (typeof vapidKey !== 'string' || vapidKey.length === 0) {\\r\\n            throw ERROR_FACTORY.create(\\\"invalid-vapid-key\\\" /* INVALID_VAPID_KEY */);\\r\\n        }\\r\\n        this.vapidKey = vapidKey;\\r\\n    };\\r\\n    SwController.prototype.useServiceWorker = function () {\\r\\n        throw ERROR_FACTORY.create(\\\"only-available-in-window\\\" /* AVAILABLE_IN_WINDOW */);\\r\\n    };\\r\\n    SwController.prototype.onMessage = function () {\\r\\n        throw ERROR_FACTORY.create(\\\"only-available-in-window\\\" /* AVAILABLE_IN_WINDOW */);\\r\\n    };\\r\\n    SwController.prototype.onTokenRefresh = function () {\\r\\n        throw ERROR_FACTORY.create(\\\"only-available-in-window\\\" /* AVAILABLE_IN_WINDOW */);\\r\\n    };\\r\\n    /**\\r\\n     * A handler for push events that shows notifications based on the content of the payload.\\r\\n     *\\r\\n     * The payload must be a JSON-encoded Object with a `notification` key. The value of the\\r\\n     * `notification` property will be used as the NotificationOptions object passed to\\r\\n     * showNotification. Additionally, the `title` property of the notification object will be used as\\r\\n     * the title.\\r\\n     *\\r\\n     * If there is no notification data in the payload then no notification will be shown.\\r\\n     */\\r\\n    SwController.prototype.onPush = function (event) {\\r\\n        return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n            var internalPayload, clientList, isNotificationShown, payload;\\r\\n            return tslib.__generator(this, function (_a) {\\r\\n                switch (_a.label) {\\r\\n                    case 0:\\r\\n                        internalPayload = getMessagePayloadInternal(event);\\r\\n                        if (!internalPayload) {\\r\\n                            console.debug(TAG +\\r\\n                                'failed to get parsed MessagePayload from the PushEvent. Skip handling the push.');\\r\\n                            return [2 /*return*/];\\r\\n                        }\\r\\n                        return [4 /*yield*/, getClientList()];\\r\\n                    case 1:\\r\\n                        clientList = _a.sent();\\r\\n                        if (hasVisibleClients(clientList)) {\\r\\n                            return [2 /*return*/, sendMessagePayloadInternalToWindows(clientList, internalPayload)];\\r\\n                        }\\r\\n                        isNotificationShown = false;\\r\\n                        if (!!!internalPayload.notification) return [3 /*break*/, 3];\\r\\n                        return [4 /*yield*/, showNotification(wrapInternalPayload(internalPayload))];\\r\\n                    case 2:\\r\\n                        _a.sent();\\r\\n                        isNotificationShown = true;\\r\\n                        _a.label = 3;\\r\\n                    case 3:\\r\\n                        // MessagePayload is only passed to `onBackgroundMessage`. Skip passing MessagePayload for\\r\\n                        // the legacy `setBackgroundMessageHandler` to preserve the SDK behaviors.\\r\\n                        if (isNotificationShown === true &&\\r\\n                            this.isOnBackgroundMessageUsed === false) {\\r\\n                            return [2 /*return*/];\\r\\n                        }\\r\\n                        if (!!this.bgMessageHandler) {\\r\\n                            payload = externalizePayload(internalPayload);\\r\\n                            if (typeof this.bgMessageHandler === 'function') {\\r\\n                                this.bgMessageHandler(payload);\\r\\n                            }\\r\\n                            else {\\r\\n                                this.bgMessageHandler.next(payload);\\r\\n                            }\\r\\n                        }\\r\\n                        // wait briefly to allow onBackgroundMessage to complete\\r\\n                        return [4 /*yield*/, sleep(BACKGROUND_HANDLE_EXECUTION_TIME_LIMIT_MS)];\\r\\n                    case 4:\\r\\n                        // wait briefly to allow onBackgroundMessage to complete\\r\\n                        _a.sent();\\r\\n                        return [2 /*return*/];\\r\\n                }\\r\\n            });\\r\\n        });\\r\\n    };\\r\\n    SwController.prototype.onSubChange = function (event) {\\r\\n        var _a, _b;\\r\\n        return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n            var newSubscription, tokenDetails;\\r\\n            return tslib.__generator(this, function (_c) {\\r\\n                switch (_c.label) {\\r\\n                    case 0:\\r\\n                        newSubscription = event.newSubscription;\\r\\n                        if (!!newSubscription) return [3 /*break*/, 2];\\r\\n                        // Subscription revoked, delete token\\r\\n                        return [4 /*yield*/, deleteToken(this.firebaseDependencies, self.registration)];\\r\\n                    case 1:\\r\\n                        // Subscription revoked, delete token\\r\\n                        _c.sent();\\r\\n                        return [2 /*return*/];\\r\\n                    case 2: return [4 /*yield*/, dbGet(this.firebaseDependencies)];\\r\\n                    case 3:\\r\\n                        tokenDetails = _c.sent();\\r\\n                        return [4 /*yield*/, deleteToken(this.firebaseDependencies, self.registration)];\\r\\n                    case 4:\\r\\n                        _c.sent();\\r\\n                        return [4 /*yield*/, getToken(this.firebaseDependencies, self.registration, (_b = (_a = tokenDetails === null || tokenDetails === void 0 ? void 0 : tokenDetails.subscriptionOptions) === null || _a === void 0 ? void 0 : _a.vapidKey) !== null && _b !== void 0 ? _b : DEFAULT_VAPID_KEY)];\\r\\n                    case 5:\\r\\n                        _c.sent();\\r\\n                        return [2 /*return*/];\\r\\n                }\\r\\n            });\\r\\n        });\\r\\n    };\\r\\n    SwController.prototype.onNotificationClick = function (event) {\\r\\n        var _a, _b;\\r\\n        return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n            var internalPayload, link, url, originUrl, client;\\r\\n            return tslib.__generator(this, function (_c) {\\r\\n                switch (_c.label) {\\r\\n                    case 0:\\r\\n                        internalPayload = (_b = (_a = event.notification) === null || _a === void 0 ? void 0 : _a.data) === null || _b === void 0 ? void 0 : _b[FCM_MSG];\\r\\n                        if (!internalPayload) {\\r\\n                            return [2 /*return*/];\\r\\n                        }\\r\\n                        else if (event.action) {\\r\\n                            // User clicked on an action button. This will allow developers to act on action button clicks\\r\\n                            // by using a custom onNotificationClick listener that they define.\\r\\n                            return [2 /*return*/];\\r\\n                        }\\r\\n                        // Prevent other listeners from receiving the event\\r\\n                        event.stopImmediatePropagation();\\r\\n                        event.notification.close();\\r\\n                        link = getLink(internalPayload);\\r\\n                        if (!link) {\\r\\n                            return [2 /*return*/];\\r\\n                        }\\r\\n                        url = new URL(link, self.location.href);\\r\\n                        originUrl = new URL(self.location.origin);\\r\\n                        if (url.host !== originUrl.host) {\\r\\n                            return [2 /*return*/];\\r\\n                        }\\r\\n                        return [4 /*yield*/, getWindowClient(url)];\\r\\n                    case 1:\\r\\n                        client = _c.sent();\\r\\n                        if (!!client) return [3 /*break*/, 4];\\r\\n                        return [4 /*yield*/, self.clients.openWindow(link)];\\r\\n                    case 2:\\r\\n                        client = _c.sent();\\r\\n                        // Wait three seconds for the client to initialize and set up the message handler so that it\\r\\n                        // can receive the message.\\r\\n                        return [4 /*yield*/, sleep(FOREGROUND_HANDLE_PREPARATION_TIME_MS)];\\r\\n                    case 3:\\r\\n                        // Wait three seconds for the client to initialize and set up the message handler so that it\\r\\n                        // can receive the message.\\r\\n                        _c.sent();\\r\\n                        return [3 /*break*/, 6];\\r\\n                    case 4: return [4 /*yield*/, client.focus()];\\r\\n                    case 5:\\r\\n                        client = _c.sent();\\r\\n                        _c.label = 6;\\r\\n                    case 6:\\r\\n                        if (!client) {\\r\\n                            // Window Client will not be returned if it's for a third party origin.\\r\\n                            return [2 /*return*/];\\r\\n                        }\\r\\n                        internalPayload.messageType = MessageType.NOTIFICATION_CLICKED;\\r\\n                        internalPayload.isFirebaseMessaging = true;\\r\\n                        return [2 /*return*/, client.postMessage(internalPayload)];\\r\\n                }\\r\\n            });\\r\\n        });\\r\\n    };\\r\\n    return SwController;\\r\\n}());\\r\\nfunction wrapInternalPayload(internalPayload) {\\r\\n    var _a;\\r\\n    var wrappedInternalPayload = tslib.__assign({}, internalPayload.notification);\\r\\n    // Put the message payload under FCM_MSG name so we can identify the notification as being an FCM\\r\\n    // notification vs a notification from somewhere else (i.e. normal web push or developer generated\\r\\n    // notification).\\r\\n    wrappedInternalPayload.data = (_a = {},\\r\\n        _a[FCM_MSG] = internalPayload,\\r\\n        _a);\\r\\n    return wrappedInternalPayload;\\r\\n}\\r\\nfunction getMessagePayloadInternal(_a) {\\r\\n    var data = _a.data;\\r\\n    if (!data) {\\r\\n        return null;\\r\\n    }\\r\\n    try {\\r\\n        return data.json();\\r\\n    }\\r\\n    catch (err) {\\r\\n        // Not JSON so not an FCM message.\\r\\n        return null;\\r\\n    }\\r\\n}\\r\\n/**\\r\\n * @param url The URL to look for when focusing a client.\\r\\n * @return Returns an existing window client or a newly opened WindowClient.\\r\\n */\\r\\nfunction getWindowClient(url) {\\r\\n    return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n        var clientList, clientList_1, clientList_1_1, client, clientUrl;\\r\\n        var e_1, _a;\\r\\n        return tslib.__generator(this, function (_b) {\\r\\n            switch (_b.label) {\\r\\n                case 0: return [4 /*yield*/, getClientList()];\\r\\n                case 1:\\r\\n                    clientList = _b.sent();\\r\\n                    try {\\r\\n                        for (clientList_1 = tslib.__values(clientList), clientList_1_1 = clientList_1.next(); !clientList_1_1.done; clientList_1_1 = clientList_1.next()) {\\r\\n                            client = clientList_1_1.value;\\r\\n                            clientUrl = new URL(client.url, self.location.href);\\r\\n                            if (url.host === clientUrl.host) {\\r\\n                                return [2 /*return*/, client];\\r\\n                            }\\r\\n                        }\\r\\n                    }\\r\\n                    catch (e_1_1) { e_1 = { error: e_1_1 }; }\\r\\n                    finally {\\r\\n                        try {\\r\\n                            if (clientList_1_1 && !clientList_1_1.done && (_a = clientList_1.return)) _a.call(clientList_1);\\r\\n                        }\\r\\n                        finally { if (e_1) throw e_1.error; }\\r\\n                    }\\r\\n                    return [2 /*return*/, null];\\r\\n            }\\r\\n        });\\r\\n    });\\r\\n}\\r\\n/**\\r\\n * @returns If there is currently a visible WindowClient, this method will resolve to true,\\r\\n * otherwise false.\\r\\n */\\r\\nfunction hasVisibleClients(clientList) {\\r\\n    return clientList.some(function (client) {\\r\\n        return client.visibilityState === 'visible' &&\\r\\n            // Ignore chrome-extension clients as that matches the background pages of extensions, which\\r\\n            // are always considered visible for some reason.\\r\\n            !client.url.startsWith('chrome-extension://');\\r\\n    });\\r\\n}\\r\\nfunction sendMessagePayloadInternalToWindows(clientList, internalPayload) {\\r\\n    var e_2, _a;\\r\\n    internalPayload.isFirebaseMessaging = true;\\r\\n    internalPayload.messageType = MessageType.PUSH_RECEIVED;\\r\\n    try {\\r\\n        for (var clientList_2 = tslib.__values(clientList), clientList_2_1 = clientList_2.next(); !clientList_2_1.done; clientList_2_1 = clientList_2.next()) {\\r\\n            var client = clientList_2_1.value;\\r\\n            client.postMessage(internalPayload);\\r\\n        }\\r\\n    }\\r\\n    catch (e_2_1) { e_2 = { error: e_2_1 }; }\\r\\n    finally {\\r\\n        try {\\r\\n            if (clientList_2_1 && !clientList_2_1.done && (_a = clientList_2.return)) _a.call(clientList_2);\\r\\n        }\\r\\n        finally { if (e_2) throw e_2.error; }\\r\\n    }\\r\\n}\\r\\nfunction getClientList() {\\r\\n    return self.clients.matchAll({\\r\\n        type: 'window',\\r\\n        includeUncontrolled: true\\r\\n        // TS doesn't know that \\\"type: 'window'\\\" means it'll return WindowClient[]\\r\\n    });\\r\\n}\\r\\nfunction showNotification(notificationPayloadInternal) {\\r\\n    var _a;\\r\\n    // Note: Firefox does not support the maxActions property.\\r\\n    // https://developer.mozilla.org/en-US/docs/Web/API/notification/maxActions\\r\\n    var actions = notificationPayloadInternal.actions;\\r\\n    var maxActions = Notification.maxActions;\\r\\n    if (actions && maxActions && actions.length > maxActions) {\\r\\n        console.warn(\\\"This browser only supports \\\" + maxActions + \\\" actions. The remaining actions will not be displayed.\\\");\\r\\n    }\\r\\n    return self.registration.showNotification(\\r\\n    /* title= */ (_a = notificationPayloadInternal.title) !== null && _a !== void 0 ? _a : '', notificationPayloadInternal);\\r\\n}\\r\\nfunction getLink(payload) {\\r\\n    var _a, _b, _c;\\r\\n    // eslint-disable-next-line camelcase\\r\\n    var link = (_b = (_a = payload.fcmOptions) === null || _a === void 0 ? void 0 : _a.link) !== null && _b !== void 0 ? _b : (_c = payload.notification) === null || _c === void 0 ? void 0 : _c.click_action;\\r\\n    if (link) {\\r\\n        return link;\\r\\n    }\\r\\n    if (isConsoleMessage(payload.data)) {\\r\\n        // Notification created in the Firebase Console. Redirect to origin.\\r\\n        return self.location.origin;\\r\\n    }\\r\\n    else {\\r\\n        return null;\\r\\n    }\\r\\n}\\n\\n/**\\r\\n * @license\\r\\n * Copyright 2017 Google LLC\\r\\n *\\r\\n * Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\\r\\n * you may not use this file except in compliance with the License.\\r\\n * You may obtain a copy of the License at\\r\\n *\\r\\n *   http://www.apache.org/licenses/LICENSE-2.0\\r\\n *\\r\\n * Unless required by applicable law or agreed to in writing, software\\r\\n * distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\r\\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\r\\n * See the License for the specific language governing permissions and\\r\\n * limitations under the License.\\r\\n */\\r\\nvar WindowController = /** @class */ (function () {\\r\\n    function WindowController(firebaseDependencies) {\\r\\n        var _this = this;\\r\\n        this.firebaseDependencies = firebaseDependencies;\\r\\n        this.vapidKey = null;\\r\\n        this.onMessageCallback = null;\\r\\n        navigator.serviceWorker.addEventListener('message', function (e) {\\r\\n            return _this.messageEventListener(e);\\r\\n        });\\r\\n    }\\r\\n    Object.defineProperty(WindowController.prototype, \\\"app\\\", {\\r\\n        get: function () {\\r\\n            return this.firebaseDependencies.app;\\r\\n        },\\r\\n        enumerable: false,\\r\\n        configurable: true\\r\\n    });\\r\\n    WindowController.prototype.messageEventListener = function (event) {\\r\\n        return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n            var internalPayload, dataPayload;\\r\\n            return tslib.__generator(this, function (_a) {\\r\\n                switch (_a.label) {\\r\\n                    case 0:\\r\\n                        internalPayload = event.data;\\r\\n                        if (!internalPayload.isFirebaseMessaging) {\\r\\n                            return [2 /*return*/];\\r\\n                        }\\r\\n                        // onMessageCallback is either a function or observer/subscriber.\\r\\n                        // TODO: in the modularization release, have onMessage handle type MessagePayload as supposed to\\r\\n                        // the legacy payload where some fields are in snake cases.\\r\\n                        if (this.onMessageCallback &&\\r\\n                            internalPayload.messageType === MessageType.PUSH_RECEIVED) {\\r\\n                            if (typeof this.onMessageCallback === 'function') {\\r\\n                                this.onMessageCallback(stripInternalFields(Object.assign({}, internalPayload)));\\r\\n                            }\\r\\n                            else {\\r\\n                                this.onMessageCallback.next(Object.assign({}, internalPayload));\\r\\n                            }\\r\\n                        }\\r\\n                        dataPayload = internalPayload.data;\\r\\n                        if (!(isConsoleMessage(dataPayload) &&\\r\\n                            dataPayload[CONSOLE_CAMPAIGN_ANALYTICS_ENABLED] === '1')) return [3 /*break*/, 2];\\r\\n                        return [4 /*yield*/, this.logEvent(internalPayload.messageType, dataPayload)];\\r\\n                    case 1:\\r\\n                        _a.sent();\\r\\n                        _a.label = 2;\\r\\n                    case 2: return [2 /*return*/];\\r\\n                }\\r\\n            });\\r\\n        });\\r\\n    };\\r\\n    WindowController.prototype.getVapidKey = function () {\\r\\n        return this.vapidKey;\\r\\n    };\\r\\n    WindowController.prototype.getSwReg = function () {\\r\\n        return this.swRegistration;\\r\\n    };\\r\\n    WindowController.prototype.getToken = function (options) {\\r\\n        return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n            return tslib.__generator(this, function (_a) {\\r\\n                switch (_a.label) {\\r\\n                    case 0:\\r\\n                        if (!(Notification.permission === 'default')) return [3 /*break*/, 2];\\r\\n                        return [4 /*yield*/, Notification.requestPermission()];\\r\\n                    case 1:\\r\\n                        _a.sent();\\r\\n                        _a.label = 2;\\r\\n                    case 2:\\r\\n                        if (Notification.permission !== 'granted') {\\r\\n                            throw ERROR_FACTORY.create(\\\"permission-blocked\\\" /* PERMISSION_BLOCKED */);\\r\\n                        }\\r\\n                        return [4 /*yield*/, this.updateVapidKey(options === null || options === void 0 ? void 0 : options.vapidKey)];\\r\\n                    case 3:\\r\\n                        _a.sent();\\r\\n                        return [4 /*yield*/, this.updateSwReg(options === null || options === void 0 ? void 0 : options.serviceWorkerRegistration)];\\r\\n                    case 4:\\r\\n                        _a.sent();\\r\\n                        return [2 /*return*/, getToken(this.firebaseDependencies, this.swRegistration, this.vapidKey)];\\r\\n                }\\r\\n            });\\r\\n        });\\r\\n    };\\r\\n    WindowController.prototype.updateVapidKey = function (vapidKey) {\\r\\n        return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n            return tslib.__generator(this, function (_a) {\\r\\n                if (!!vapidKey) {\\r\\n                    this.vapidKey = vapidKey;\\r\\n                }\\r\\n                else if (!this.vapidKey) {\\r\\n                    this.vapidKey = DEFAULT_VAPID_KEY;\\r\\n                }\\r\\n                return [2 /*return*/];\\r\\n            });\\r\\n        });\\r\\n    };\\r\\n    WindowController.prototype.updateSwReg = function (swRegistration) {\\r\\n        return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n            return tslib.__generator(this, function (_a) {\\r\\n                switch (_a.label) {\\r\\n                    case 0:\\r\\n                        if (!(!swRegistration && !this.swRegistration)) return [3 /*break*/, 2];\\r\\n                        return [4 /*yield*/, this.registerDefaultSw()];\\r\\n                    case 1:\\r\\n                        _a.sent();\\r\\n                        _a.label = 2;\\r\\n                    case 2:\\r\\n                        if (!swRegistration && !!this.swRegistration) {\\r\\n                            return [2 /*return*/];\\r\\n                        }\\r\\n                        if (!(swRegistration instanceof ServiceWorkerRegistration)) {\\r\\n                            throw ERROR_FACTORY.create(\\\"invalid-sw-registration\\\" /* INVALID_SW_REGISTRATION */);\\r\\n                        }\\r\\n                        this.swRegistration = swRegistration;\\r\\n                        return [2 /*return*/];\\r\\n                }\\r\\n            });\\r\\n        });\\r\\n    };\\r\\n    WindowController.prototype.registerDefaultSw = function () {\\r\\n        return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n            var _a, e_1;\\r\\n            return tslib.__generator(this, function (_b) {\\r\\n                switch (_b.label) {\\r\\n                    case 0:\\r\\n                        _b.trys.push([0, 2, , 3]);\\r\\n                        _a = this;\\r\\n                        return [4 /*yield*/, navigator.serviceWorker.register(DEFAULT_SW_PATH, {\\r\\n                                scope: DEFAULT_SW_SCOPE\\r\\n                            })];\\r\\n                    case 1:\\r\\n                        _a.swRegistration = _b.sent();\\r\\n                        // The timing when browser updates sw when sw has an update is unreliable by my experiment. It\\r\\n                        // leads to version conflict when the SDK upgrades to a newer version in the main page, but sw\\r\\n                        // is stuck with the old version. For example,\\r\\n                        // https://github.com/firebase/firebase-js-sdk/issues/2590 The following line reliably updates\\r\\n                        // sw if there was an update.\\r\\n                        this.swRegistration.update().catch(function () {\\r\\n                            /* it is non blocking and we don't care if it failed */\\r\\n                        });\\r\\n                        return [3 /*break*/, 3];\\r\\n                    case 2:\\r\\n                        e_1 = _b.sent();\\r\\n                        throw ERROR_FACTORY.create(\\\"failed-service-worker-registration\\\" /* FAILED_DEFAULT_REGISTRATION */, {\\r\\n                            browserErrorMessage: e_1.message\\r\\n                        });\\r\\n                    case 3: return [2 /*return*/];\\r\\n                }\\r\\n            });\\r\\n        });\\r\\n    };\\r\\n    WindowController.prototype.deleteToken = function () {\\r\\n        return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n            return tslib.__generator(this, function (_a) {\\r\\n                switch (_a.label) {\\r\\n                    case 0:\\r\\n                        if (!!this.swRegistration) return [3 /*break*/, 2];\\r\\n                        return [4 /*yield*/, this.registerDefaultSw()];\\r\\n                    case 1:\\r\\n                        _a.sent();\\r\\n                        _a.label = 2;\\r\\n                    case 2: return [2 /*return*/, deleteToken(this.firebaseDependencies, this.swRegistration)];\\r\\n                }\\r\\n            });\\r\\n        });\\r\\n    };\\r\\n    /**\\r\\n     * Request permission if it is not currently granted.\\r\\n     *\\r\\n     * @return Resolves if the permission was granted, rejects otherwise.\\r\\n     *\\r\\n     * @deprecated Use Notification.requestPermission() instead.\\r\\n     * https://developer.mozilla.org/en-US/docs/Web/API/Notification/requestPermission\\r\\n     */\\r\\n    WindowController.prototype.requestPermission = function () {\\r\\n        return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n            var permissionResult;\\r\\n            return tslib.__generator(this, function (_a) {\\r\\n                switch (_a.label) {\\r\\n                    case 0:\\r\\n                        if (Notification.permission === 'granted') {\\r\\n                            return [2 /*return*/];\\r\\n                        }\\r\\n                        return [4 /*yield*/, Notification.requestPermission()];\\r\\n                    case 1:\\r\\n                        permissionResult = _a.sent();\\r\\n                        if (permissionResult === 'granted') {\\r\\n                            return [2 /*return*/];\\r\\n                        }\\r\\n                        else if (permissionResult === 'denied') {\\r\\n                            throw ERROR_FACTORY.create(\\\"permission-blocked\\\" /* PERMISSION_BLOCKED */);\\r\\n                        }\\r\\n                        else {\\r\\n                            throw ERROR_FACTORY.create(\\\"permission-default\\\" /* PERMISSION_DEFAULT */);\\r\\n                        }\\r\\n                }\\r\\n            });\\r\\n        });\\r\\n    };\\r\\n    /**\\r\\n     * @deprecated. Use getToken(options?: {vapidKey?: string; serviceWorkerRegistration?:\\r\\n     * ServiceWorkerRegistration;}): Promise<string> instead.\\r\\n     */\\r\\n    WindowController.prototype.usePublicVapidKey = function (vapidKey) {\\r\\n        if (this.vapidKey !== null) {\\r\\n            throw ERROR_FACTORY.create(\\\"use-vapid-key-after-get-token\\\" /* USE_VAPID_KEY_AFTER_GET_TOKEN */);\\r\\n        }\\r\\n        if (typeof vapidKey !== 'string' || vapidKey.length === 0) {\\r\\n            throw ERROR_FACTORY.create(\\\"invalid-vapid-key\\\" /* INVALID_VAPID_KEY */);\\r\\n        }\\r\\n        this.vapidKey = vapidKey;\\r\\n    };\\r\\n    /**\\r\\n     * @deprecated. Use getToken(options?: {vapidKey?: string; serviceWorkerRegistration?:\\r\\n     * ServiceWorkerRegistration;}): Promise<string> instead.\\r\\n     */\\r\\n    WindowController.prototype.useServiceWorker = function (swRegistration) {\\r\\n        if (!(swRegistration instanceof ServiceWorkerRegistration)) {\\r\\n            throw ERROR_FACTORY.create(\\\"invalid-sw-registration\\\" /* INVALID_SW_REGISTRATION */);\\r\\n        }\\r\\n        if (this.swRegistration) {\\r\\n            throw ERROR_FACTORY.create(\\\"use-sw-after-get-token\\\" /* USE_SW_AFTER_GET_TOKEN */);\\r\\n        }\\r\\n        this.swRegistration = swRegistration;\\r\\n    };\\r\\n    /**\\r\\n     * @param nextOrObserver An observer object or a function triggered on message.\\r\\n     *\\r\\n     * @return The unsubscribe function for the observer.\\r\\n     */\\r\\n    WindowController.prototype.onMessage = function (nextOrObserver) {\\r\\n        var _this = this;\\r\\n        this.onMessageCallback = nextOrObserver;\\r\\n        return function () {\\r\\n            _this.onMessageCallback = null;\\r\\n        };\\r\\n    };\\r\\n    WindowController.prototype.setBackgroundMessageHandler = function () {\\r\\n        throw ERROR_FACTORY.create(\\\"only-available-in-sw\\\" /* AVAILABLE_IN_SW */);\\r\\n    };\\r\\n    WindowController.prototype.onBackgroundMessage = function () {\\r\\n        throw ERROR_FACTORY.create(\\\"only-available-in-sw\\\" /* AVAILABLE_IN_SW */);\\r\\n    };\\r\\n    /**\\r\\n     * @deprecated No-op. It was initially designed with token rotation requests from server in mind.\\r\\n     * However, the plan to implement such feature was abandoned.\\r\\n     */\\r\\n    WindowController.prototype.onTokenRefresh = function () {\\r\\n        return function () { };\\r\\n    };\\r\\n    WindowController.prototype.logEvent = function (messageType, data) {\\r\\n        return tslib.__awaiter(this, void 0, void 0, function () {\\r\\n            var eventType, analytics;\\r\\n            return tslib.__generator(this, function (_a) {\\r\\n                switch (_a.label) {\\r\\n                    case 0:\\r\\n                        eventType = getEventType(messageType);\\r\\n                        return [4 /*yield*/, this.firebaseDependencies.analyticsProvider.get()];\\r\\n                    case 1:\\r\\n                        analytics = _a.sent();\\r\\n                        analytics.logEvent(eventType, {\\r\\n                            /* eslint-disable camelcase */\\r\\n                            message_id: data[CONSOLE_CAMPAIGN_ID],\\r\\n                            message_name: data[CONSOLE_CAMPAIGN_NAME],\\r\\n                            message_time: data[CONSOLE_CAMPAIGN_TIME],\\r\\n                            message_device_time: Math.floor(Date.now() / 1000)\\r\\n                            /* eslint-enable camelcase */\\r\\n                        });\\r\\n                        return [2 /*return*/];\\r\\n                }\\r\\n            });\\r\\n        });\\r\\n    };\\r\\n    return WindowController;\\r\\n}());\\r\\nfunction getEventType(messageType) {\\r\\n    switch (messageType) {\\r\\n        case MessageType.NOTIFICATION_CLICKED:\\r\\n            return 'notification_open';\\r\\n        case MessageType.PUSH_RECEIVED:\\r\\n            return 'notification_foreground';\\r\\n        default:\\r\\n            throw new Error();\\r\\n    }\\r\\n}\\r\\nfunction stripInternalFields(internalPayload) {\\r\\n    delete internalPayload.messageType;\\r\\n    delete internalPayload.isFirebaseMessaging;\\r\\n    return internalPayload;\\r\\n}\\n\\n/**\\r\\n * @license\\r\\n * Copyright 2019 Google LLC\\r\\n *\\r\\n * Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\\r\\n * you may not use this file except in compliance with the License.\\r\\n * You may obtain a copy of the License at\\r\\n *\\r\\n *   http://www.apache.org/licenses/LICENSE-2.0\\r\\n *\\r\\n * Unless required by applicable law or agreed to in writing, software\\r\\n * distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\r\\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\r\\n * See the License for the specific language governing permissions and\\r\\n * limitations under the License.\\r\\n */\\r\\nfunction extractAppConfig(app) {\\r\\n    var e_1, _a;\\r\\n    if (!app || !app.options) {\\r\\n        throw getMissingValueError('App Configuration Object');\\r\\n    }\\r\\n    if (!app.name) {\\r\\n        throw getMissingValueError('App Name');\\r\\n    }\\r\\n    // Required app config keys\\r\\n    var configKeys = [\\r\\n        'projectId',\\r\\n        'apiKey',\\r\\n        'appId',\\r\\n        'messagingSenderId'\\r\\n    ];\\r\\n    var options = app.options;\\r\\n    try {\\r\\n        for (var configKeys_1 = tslib.__values(configKeys), configKeys_1_1 = configKeys_1.next(); !configKeys_1_1.done; configKeys_1_1 = configKeys_1.next()) {\\r\\n            var keyName = configKeys_1_1.value;\\r\\n            if (!options[keyName]) {\\r\\n                throw getMissingValueError(keyName);\\r\\n            }\\r\\n        }\\r\\n    }\\r\\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\\r\\n    finally {\\r\\n        try {\\r\\n            if (configKeys_1_1 && !configKeys_1_1.done && (_a = configKeys_1.return)) _a.call(configKeys_1);\\r\\n        }\\r\\n        finally { if (e_1) throw e_1.error; }\\r\\n    }\\r\\n    return {\\r\\n        appName: app.name,\\r\\n        projectId: options.projectId,\\r\\n        apiKey: options.apiKey,\\r\\n        appId: options.appId,\\r\\n        senderId: options.messagingSenderId\\r\\n    };\\r\\n}\\r\\nfunction getMissingValueError(valueName) {\\r\\n    return ERROR_FACTORY.create(\\\"missing-app-config-values\\\" /* MISSING_APP_CONFIG_VALUES */, {\\r\\n        valueName: valueName\\r\\n    });\\r\\n}\\n\\n/**\\r\\n * @license\\r\\n * Copyright 2017 Google LLC\\r\\n *\\r\\n * Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\\r\\n * you may not use this file except in compliance with the License.\\r\\n * You may obtain a copy of the License at\\r\\n *\\r\\n *   http://www.apache.org/licenses/LICENSE-2.0\\r\\n *\\r\\n * Unless required by applicable law or agreed to in writing, software\\r\\n * distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\r\\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\r\\n * See the License for the specific language governing permissions and\\r\\n * limitations under the License.\\r\\n */\\r\\nvar MESSAGING_NAME = 'messaging';\\r\\nfunction factoryMethod(container) {\\r\\n    // Dependencies.\\r\\n    var app = container.getProvider('app').getImmediate();\\r\\n    var appConfig = extractAppConfig(app);\\r\\n    var installations = container.getProvider('installations').getImmediate();\\r\\n    var analyticsProvider = container.getProvider('analytics-internal');\\r\\n    var firebaseDependencies = {\\r\\n        app: app,\\r\\n        appConfig: appConfig,\\r\\n        installations: installations,\\r\\n        analyticsProvider: analyticsProvider\\r\\n    };\\r\\n    if (!isSupported()) {\\r\\n        throw ERROR_FACTORY.create(\\\"unsupported-browser\\\" /* UNSUPPORTED_BROWSER */);\\r\\n    }\\r\\n    if (self && 'ServiceWorkerGlobalScope' in self) {\\r\\n        // Running in ServiceWorker context\\r\\n        return new SwController(firebaseDependencies);\\r\\n    }\\r\\n    else {\\r\\n        // Assume we are in the window context.\\r\\n        return new WindowController(firebaseDependencies);\\r\\n    }\\r\\n}\\r\\nvar NAMESPACE_EXPORTS = {\\r\\n    isSupported: isSupported\\r\\n};\\r\\nfirebase__default['default'].INTERNAL.registerComponent(new component.Component(MESSAGING_NAME, factoryMethod, \\\"PUBLIC\\\" /* PUBLIC */).setServiceProps(NAMESPACE_EXPORTS));\\r\\nfunction isSupported() {\\r\\n    if (self && 'ServiceWorkerGlobalScope' in self) {\\r\\n        // Running in ServiceWorker context\\r\\n        return isSWControllerSupported();\\r\\n    }\\r\\n    else {\\r\\n        // Assume we are in the window context.\\r\\n        return isWindowControllerSupported();\\r\\n    }\\r\\n}\\r\\n/**\\r\\n * Checks to see if the required APIs exist.\\r\\n */\\r\\nfunction isWindowControllerSupported() {\\r\\n    return ('indexedDB' in window &&\\r\\n        indexedDB !== null &&\\r\\n        navigator.cookieEnabled &&\\r\\n        'serviceWorker' in navigator &&\\r\\n        'PushManager' in window &&\\r\\n        'Notification' in window &&\\r\\n        'fetch' in window &&\\r\\n        ServiceWorkerRegistration.prototype.hasOwnProperty('showNotification') &&\\r\\n        PushSubscription.prototype.hasOwnProperty('getKey'));\\r\\n}\\r\\n/**\\r\\n * Checks to see if the required APIs exist within SW Context.\\r\\n */\\r\\nfunction isSWControllerSupported() {\\r\\n    return ('indexedDB' in self &&\\r\\n        indexedDB !== null &&\\r\\n        'PushManager' in self &&\\r\\n        'Notification' in self &&\\r\\n        ServiceWorkerRegistration.prototype.hasOwnProperty('showNotification') &&\\r\\n        PushSubscription.prototype.hasOwnProperty('getKey'));\\r\\n}\\n//# sourceMappingURL=index.cjs.js.map\\n\\n};\"],\n\"names\":[\"shadow$provide\",\"global\",\"require\",\"module\",\"exports\",\"arrayToBase64\",\"array\",\"uint8Array\",\"Uint8Array\",\"btoa\",\"base64String\",\"String\",\"fromCharCode\",\"apply\",\"tslib\",\"__spreadArray\",\"__read\",\"replace\",\"migrateOldDatabase\",\"senderId\",\"__awaiter\",\"databases\",\"dbNames\",\"tokenDetails\",\"db\",\"_this\",\"__generator\",\"_a\",\"label\",\"indexedDB\",\"sent\",\"map\",\"name\",\"includes\",\"OLD_DB_NAME\",\"idb\",\"openDb\",\"OLD_DB_VERSION\",\"objectStore\",\"value\",\"oldDetails\",\"_b\",\"oldVersion\",\"objectStoreNames\",\"contains\",\"OLD_OBJECT_STORE_NAME\",\"transaction\",\"index\",\"get\",\"clear\",\"auth\",\"p256dh\",\"endpoint\",\"token\",\"fcmToken\",\"createTime\",\"Date\",\"now\",\"subscriptionOptions\",\"swScope\",\"vapidKey\",\"close\",\"deleteDb\",\"checkTokenDetails\",\"length\",\"getDbPromise\",\"dbPromise\",\"DATABASE_NAME\",\"DATABASE_VERSION\",\"upgradeDb\",\"createObjectStore\",\"OBJECT_STORE_NAME\",\"dbGet\",\"firebaseDependencies\",\"key\",\"oldTokenDetails\",\"appConfig\",\"appId\",\"dbSet\",\"tx\",\"put\",\"complete\",\"dbRemove\",\"delete\",\"requestGetToken\",\"headers\",\"body\",\"subscribeOptions\",\"responseData\",\"response\",\"err_1\",\"message\",\"getHeaders\",\"getBody\",\"method\",\"JSON\",\"stringify\",\"trys\",\"push\",\"fetch\",\"getEndpoint\",\"json\",\"ERROR_FACTORY\",\"create\",\"errorInfo\",\"error\",\"requestUpdateToken\",\"updateOptions\",\"err_2\",\"requestDeleteToken\",\"unsubscribeOptions\",\"err_3\",\"projectId\",\"installations\",\"authToken\",\"getToken\",\"Headers\",\"Accept\",\"apiKey\",\"web\",\"DEFAULT_VAPID_KEY\",\"applicationPubKey\",\"swRegistration\",\"pushSubscription\",\"e_1\",\"Notification\",\"permission\",\"getPushSubscription\",\"scope\",\"getKey\",\"getNewToken\",\"isEndpointEqual\",\"dbOptions\",\"isAuthEqual\",\"isP256dhEqual\",\"console\",\"warn\",\"TOKEN_EXPIRATION_MS\",\"updateToken\",\"deleteToken\",\"pushManager\",\"getSubscription\",\"unsubscribe\",\"updatedToken\",\"updatedTokenDetails\",\"e_2\",\"__assign\",\"subscription\",\"subscribe\",\"padding\",\"repeat\",\"base64\",\"rawData\",\"atob\",\"outputArray\",\"i\",\"charCodeAt\",\"userVisibleOnly\",\"applicationServerKey\",\"isConsoleMessage\",\"data\",\"CONSOLE_CAMPAIGN_ID\",\"sleep\",\"ms\",\"Promise\",\"resolve\",\"setTimeout\",\"getWindowClient\",\"url\",\"clientList\",\"clientList_1\",\"clientList_1_1\",\"client\",\"clientUrl\",\"getClientList\",\"__values\",\"next\",\"done\",\"URL\",\"self\",\"location\",\"href\",\"host\",\"e_1_1\",\"return\",\"call\",\"hasVisibleClients\",\"some\",\"visibilityState\",\"startsWith\",\"clients\",\"matchAll\",\"type\",\"includeUncontrolled\",\"getMissingValueError\",\"valueName\",\"isSupported\",\"ServiceWorkerRegistration\",\"prototype\",\"hasOwnProperty\",\"PushSubscription\",\"window\",\"navigator\",\"cookieEnabled\",\"component\",\"util\",\"firebase__default\",\"firebase\",\"ERROR_MAP\",\"ErrorFactory\",\"MessageType\",\"SwController\",\"bgMessageHandler\",\"isOnBackgroundMessageUsed\",\"addEventListener\",\"e\",\"waitUntil\",\"onPush\",\"onSubChange\",\"onNotificationClick\",\"Object\",\"defineProperty\",\"app\",\"enumerable\",\"configurable\",\"setBackgroundMessageHandler\",\"SwController.prototype.setBackgroundMessageHandler\",\"callback\",\"onBackgroundMessage\",\"SwController.prototype.onBackgroundMessage\",\"nextOrObserver\",\"SwController.prototype.getToken\",\"_c\",\"registration\",\"SwController.prototype.deleteToken\",\"requestPermission\",\"SwController.prototype.requestPermission\",\"usePublicVapidKey\",\"SwController.prototype.usePublicVapidKey\",\"useServiceWorker\",\"SwController.prototype.useServiceWorker\",\"onMessage\",\"SwController.prototype.onMessage\",\"onTokenRefresh\",\"SwController.prototype.onTokenRefresh\",\"SwController.prototype.onPush\",\"event\",\"internalPayload\",\"isNotificationShown\",\"payload\",\"err\",\"debug\",\"isFirebaseMessaging\",\"messageType\",\"PUSH_RECEIVED\",\"clientList_2\",\"clientList_2_1\",\"postMessage\",\"e_2_1\",\"notification\",\"wrappedInternalPayload\",\"actions\",\"maxActions\",\"showNotification\",\"title\",\"from\",\"collapseKey\",\"collapse_key\",\"image\",\"fcmOptions\",\"link\",\"analyticsLabel\",\"analytics_label\",\"BACKGROUND_HANDLE_EXECUTION_TIME_LIMIT_MS\",\"SwController.prototype.onSubChange\",\"newSubscription\",\"SwController.prototype.onNotificationClick\",\"originUrl\",\"action\",\"stopImmediatePropagation\",\"click_action\",\"origin\",\"openWindow\",\"FOREGROUND_HANDLE_PREPARATION_TIME_MS\",\"focus\",\"NOTIFICATION_CLICKED\",\"WindowController\",\"onMessageCallback\",\"serviceWorker\",\"messageEventListener\",\"WindowController.prototype.messageEventListener\",\"dataPayload\",\"assign\",\"CONSOLE_CAMPAIGN_ANALYTICS_ENABLED\",\"logEvent\",\"getVapidKey\",\"WindowController.prototype.getVapidKey\",\"getSwReg\",\"WindowController.prototype.getSwReg\",\"WindowController.prototype.getToken\",\"options\",\"updateVapidKey\",\"updateSwReg\",\"serviceWorkerRegistration\",\"WindowController.prototype.updateVapidKey\",\"WindowController.prototype.updateSwReg\",\"registerDefaultSw\",\"WindowController.prototype.registerDefaultSw\",\"register\",\"DEFAULT_SW_PATH\",\"DEFAULT_SW_SCOPE\",\"update\",\"catch\",\"browserErrorMessage\",\"WindowController.prototype.deleteToken\",\"WindowController.prototype.requestPermission\",\"permissionResult\",\"WindowController.prototype.usePublicVapidKey\",\"WindowController.prototype.useServiceWorker\",\"WindowController.prototype.onMessage\",\"WindowController.prototype.setBackgroundMessageHandler\",\"WindowController.prototype.onBackgroundMessage\",\"WindowController.prototype.onTokenRefresh\",\"WindowController.prototype.logEvent\",\"eventType\",\"analytics\",\"Error\",\"analyticsProvider\",\"message_id\",\"message_name\",\"CONSOLE_CAMPAIGN_NAME\",\"message_time\",\"CONSOLE_CAMPAIGN_TIME\",\"message_device_time\",\"Math\",\"floor\",\"NAMESPACE_EXPORTS\",\"INTERNAL\",\"registerComponent\",\"setServiceProps\",\"Component\",\"MESSAGING_NAME\",\"factoryMethod\",\"container\",\"getProvider\",\"getImmediate\",\"configKeys\",\"configKeys_1\",\"configKeys_1_1\",\"keyName\",\"appName\",\"messagingSenderId\"]\n}\n"]